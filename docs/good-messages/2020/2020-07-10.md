# [<](2020-07-09.md) 2020-07-10 [>](2020-07-11.md)

2,393,399 events, 1,202,972 push events, 1,904,559 commit messages, 142,531,927 characters


## [Chris-plus-alphanumericgibberish/dNAO](https://github.com/Chris-plus-alphanumericgibberish/dNAO)@[9dce8b4095...](https://github.com/Chris-plus-alphanumericgibberish/dNAO/commit/9dce8b4095729e24fddf184c378e4a798b5f364e)
#### Friday 2020-07-10 00:39:15 by RikerW

Add 4 new god_gives_benefit options, adjust existing

The list now has 6 options total, chosen by rn2(6):
- uncursed restore ability & uncursed gain ability
- (old) +1 to wielded weapon, up to a max of +9. (new) if can't enchant uwep, enchants uswapwep as well
- identify an item that's worn/wielded, first down the list of uwep/uswapwep/uamul/uleft/uright/uarmc/uarm/uarmu/uarmh/uarmg/uarmf
- gives a random resistance for rn1(1000, 500) (only one that you don't have). first of poison (which is perma instead), sleep/fire/cold/shock.
- repairs an item, choosing the most damaged. in case of ties, follows uwep/uswapwep/uarmc/uarm/uarmu/uarmh/uarmg/uarmf
- (old) bless an item, going uwep/uswapwep/uarmg/uarms/uarmc/uarm/uarmh/uarmf/uarmu/uleft/uright/uamul. (new) adjusted to do amulets before rings. instead of always blessing, will now try to make it a BUC you don't dislike. if you hate both holy/unholy (polyselfed auton, rilmani), makes it uncursed. if you hate holy (vampire PC), makes it cursed. if you hate unholy (polyselfed angel), makes it blessed. if none of the above, makes it blessed. (it's assumed anybody who hates holy is either weldproof or doesn't care about curses for some other reason)

---
## [RyanTimmons91/Dragonspire-Tech](https://github.com/RyanTimmons91/Dragonspire-Tech)@[07ec302130...](https://github.com/RyanTimmons91/Dragonspire-Tech/commit/07ec302130350bd2573166b3095cf9d79fb59caa)
#### Friday 2020-07-10 04:52:35 by Ryan

Content Mods (Generation and Structures)

Added Mods:

Dimensions:
• Aether Legacy / Continuation / Lost Content
    o New dimension above the clouds, a whole new world to explore, a dangerous paradise
• Atum
    o Explore the egyptian style sands with this desert themed dimension
• The Beneath
    o A dangerous mining dimension, explore this large underground area at your own peril
• The Midnight
    o A new mysterious world, dark and lit by crystals adn biolumenescent life.
• Defiled Lands
    o Cursed lands full of treasures that await a brave adventurer
• Twilight Forest
    o A woodland themed progressive adventure, unique and expansive

QOL:
• Inventory Tweaks
    o Organize and handle your inventories with ease!
• Ding
    o Plays a sound when minecraft has finished loading

Performance / Stability:
• Vanilla Fix
    o Performance improvements regarding texture ticks

World Generation / Character
• Battle Towers
    o Towers of pain! Battle your way to the top!
• Doomlike Dungeons
    o Generated dungeons, highly varied with mutliple rooms
• Dungeons 2
    o Multi layered procedurally generated dungeons
• Recurrent Complex
    o Tons of structures, randomized loot,
• Rex's Additional Structures
    o Exactly what it says on the tin! Variety for days!
• Roguelike Dungeons
    o Random procedural dungeons, random loot, what could be better?
• Ruins
    o EVEN MORE STRUCTURES! This time mostly ruins, even more variety!
• Serene Seasons
    o Give the world some character with changing seasons!

Core Mods:
• Baubles
• gottschcore
• ivtoolkit

---
## [triagon-games/ezMP](https://github.com/triagon-games/ezMP)@[cccb418885...](https://github.com/triagon-games/ezMP/commit/cccb418885a4822eed673c6bf4df46201c1c53d3)
#### Friday 2020-07-10 08:10:33 by Nikita Cheblokov

Copious amounts of cum pourage fucking hell, I only need 1 module

why do i need to import the whole library holy shit this is retarded.
4449 warnings fuck me

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[b85770504b...](https://github.com/mrakgr/The-Spiral-Language/commit/b85770504b39b30ae2bc426c61ce00763bbe3908)
#### Friday 2020-07-10 08:22:26 by Marko Grdinić

"8:50am. Let me chill just a bit and then I will start.

8:55am.

```fs
| RawModuleOpen of string * (OpenKind * string option) list option * on_succ: RawExpr
```

I am going to get rid of renaming from module open as it would complicate things too much.

```fs
| RawModuleOpen of string * on_succ: RawExpr
```

Let me just do this and it will import both the types and the values.

```fs
    | RawTConstraint of RawTExpr * RawTExpr
    | RawTDepConstraint of RawTExpr * RawTExpr
```

Let me get rid of these. I can't differentiate between constraints and everything else in the type expressions.

Instead I really should just add type operators.

I could add pattern operators and make that thing I did yesterday a real pattern.

```
match x with
| a .+ b -> a + b
```

Why not.

Hmmm, you know how unary operators like `+x` get transformed into `(~+) x` during parsing? For pattern operators I could do something like, well, why don't I do something like `+` to `+p` which is not something that is possible to write out on the value level?

...No, that is not good.

It needs to be the same.

```
union Arith a =
    | +# * a * a
    | -# * a * a
    | *# * a * a
    | /# * a * a

inl f _ = 1 +# 2 *# 3
```

Yeah, this is ugly but is the way thing should go.

Actually rather than that...

```
union Arith a =
    | (+) * a * a
    | (-) * a * a
    | (*) * a * a
    | (/) * a * a

inl f _ = 1 + 2 * 3
```

It is actually rather tedious have to write out `+#` instead of `+`.

There is another problem in that it is difficult to differentiate between the tuple `*` and regular operators in types...

No wait. That makes no sense. You can't use `-` and such in types.

9:10am. No forget this. Forget this useless extra work. You can always put more stuff into the language.

9:15am. What about type operators?

Forget them too for the time being. I'll put them in when I start working on the typechecker and have everything else in order. I won't even do a parser for constraints right now.

```fs
let top_nominal s = failwith "TODO" s
let top_proto s = failwith "TODO" s
let top_union s = failwith "TODO" s
```

Forget prototypes, nominals and unions. Forget that for now.

I need to redo the prototype so it is incremental and with the fixed prepass. Get the basic things done. I do not have the patience to fool around for months with the typechecker before I've even touched the later parts.

It would be far easier to redo the prototype - have something usable from VS Code - and then put in typechecking and all those missing features.

That is the winning move. Remember while I was doing the config parser that I had the idea of plugging in the prototype and decided against it because it was not incremental? I need to work on that.

9:25am. Since v0.2 is so complex, literally the only way it will get done is if I can manage it in small usable steps. I need something tangible that I can evolve. Design is one thing, but even I at this point do not have the will to fiddle with typechecking, confident that I will be able to do the later parts.

I am weak, weak.

On paper I should be able to do it, but I am desperate. Since the past 5 years were so unfruitful to me, I cannot help but want to take anything I can get.

9:50am. Had to take a short break.

10:10am. Had to take another break.

You know what, how about I step away from the screen yet again. So it will be another day of that.

In the past two days I've really gone over all of Spiral repeatedly, but today what I should do is let all of that go. Forget typechecking, forget constraints - just do the bottom up language much like I did in January. Try lifting that weight.

Once I have that mastered - both implemented to completeness and having editor support - then I will be ready to do the typechecking parts.

It is ironic - the typechecking parts aren't actually as difficult as everything else, but since they are the part I am least familiar with, I should hold it off for as long as possible.

There are 5.5 month left till the end of the year. If I spend a few of those on just the bottom up stuff, and a few of those on typechecking, I will have it all done.

At any rate, just one more day away from the screen and all the distractions, the days spent thinking in bed like that won't hurt me.

The best kind of programming aren't hugely ambitious, long winded efforts for some far off goal - they are just pushing a button and having the result you want come out.

10:15am. I am thinking that just for the sake of simplifying things in the near term, I should imagine that there are two kinds of files `.spi` and `.spir`, and that I am doing the parser for the later ones which are for the real segment.

Since I do not have typechecking, it would be too complicated to just keep adding those `real` keywords everywhere. The language syntax I had in mind does not actually make sense when the typechecking is absent.

So rather than a wholly new language, I should work on an extension to v0.1 first. Though I say extension, in many ways it will be a reduction.

10:20am. Ok, enough. Let me just step away otherwise I will waste my time on /a/.

When you get away from everything, the thoughts have a way of honing on what is really important."

---
## [dpere316/recipeApp](https://github.com/dpere316/recipeApp)@[091b52961b...](https://github.com/dpere316/recipeApp/commit/091b52961b59e81c34eb05bb745650688c0590cb)
#### Friday 2020-07-10 15:46:25 by Daniel Perz

Breakfast, Lunch, Dinner, Components are finshed need CSS, Added Val Ethinic Foods, RandomFood and Cocktails

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[4c34ae61f4...](https://github.com/mrakgr/The-Spiral-Language/commit/4c34ae61f455ca462229419283f72072753574d9)
#### Friday 2020-07-10 18:01:42 by Marko Grdinić

"11:40am. It is so heavy. Let me get breakfast.

12:50pm. Now let me go back to bed. Seriously, I thought that the partial evaluator would be easy, but I have some psychological issues to deal with. I'll talk about it later.

6:35pm. I was wondering how long I'd been in bed. Given that I've started feeling hungry I thought it would be late, but this is quite something.

I've been thinking about the language this whole time.

I've came to a few design decisions.

```fs
| FunctionT of Expr * StackSize * Ty [] * StackSize * Ty [] * is_forall : bool // TODO: Remove this. Disallow raw functions being returned from JPs and if statements.
```

I am going to do what the TODO says. I am also going to kick out reified join points from the language as they won't be useful where I want to go. Merely discovering them in the first place was so difficult, but now they will be gone. It is no wonder I feel so stressed.

When I start work on the partial evaluator again, closure conversion will be one of my top priorities.

On the plus side, getting rid of `FunctionT` and forcing closure conversion of inlineables on every branch and join point return will give me a guarantee that every variables gets `dyn`ed only when it is made explicit. It won't be possible to do it accidentally. This will increase the integrity of the language.

Some other changes:

```
inl f x : i32 = ...
```

I am going to disallow this kind of return annotation in either statements (like the above) or in `fun`. Everything that is on the pattern side will be a pattern.

Furthermore

```
let f = real (fun x -> x) : i32 -> i32
```

In addition to providing the return type of join points like they already do. I am going to make use of value scope annotation to give functions their type.

```fs
| TyFunction of Expr * StackSize * Ty [] * StackSize * Data [] * is_forall : bool
```

Right now this is its structure, but I will split this into `TyFunction` and `TyForall` and have the first one have an optional type field. This is what will be used for closure conversion. Regular primitives do not need explicit annotations, but functions do, and I am going to make use of this mechanism.

This was one of the problems in January. Back then I was not really prepared to relagate most of the work that I did to a support role, but now I am steeling my mind for this.

6:45pm. There are some other changes I will do to the syntax surrounding union types.

```
union T =
    | A
    | B: i32
    | C: i32 * i32
```

Previously, that `A` would have been converted to just a solitary symbol, but now I've decided - to make things symetric, all of these cases will be pairs. That means that `A` will be parsed as `.A * unit`. `.A, ()` is what pattern matching will look for as well by the way.

And I am not going to do any special parsing to get this effect. I thought I would do it like F#, and do a special parser just for union types, but as I am going to have `A` be converted to `.A * unit` in the type scope. Big lettered variables will get special treatment.

Furthermore, this will have an interesting implication for statements like...

```
inl A = 1
```

I've been busting my head how to get good syntax for top level constants. I've decided that all top level statements should either be functions or type definitions, but there is always the temptation to relax this requirement a little in order to allow things like top level constant. But if you do that, you start to want pairs, records, easy branches...there is no end to it. You start to want everything the partial evaluator would allow.

But compiling...

```
inl A = 1
```

as...

```
inl A () = 1
```

...would solve everything and is consistent with how 'pairless' unions would work.

I've already decided that I would compile paired symbol patterns such as ...

```
inl (Left: right:) = left + right
```

into...

```
inl left_right_ (left, right) = left + right
```

...so this is a natural fit.

Actually, I've also decided that the first letter would be lowered and now I see why.

Actually, let me compromise...

```
inl Left_right_ (left, right) = left + right
```

How about I just do not uncapitalize the name?

7pm. Back in January I've already decided that I would uncapitalize the symbol as well, but I do not see the point of that.

Ah, yes, now I remember why I decided that. I should uncapitalize the symbol as well.

The reason is so that I can easily switch when fetching from modules.

For example.

```
Range (from: 1 near_to: 2)
```

If I did not uncapitalize the symbols, then I would need to write that above as...

```
Range (.From_near_to_, 1, 2)
```

Quite ugly isn't it.

Then I'll also compile `A` as `.a * unit` on the type expressions, `.a, ()` in patterns and `a ()` in value expressions.

7:05pm. This is a magificent solution to the question of constants. It eliminates all the extra work I'd need to do to parse union types otherwise, and plays so well with everything else.

I've also elaborated the nominal type syntax in my head.

I meant to split it into real and regular nominals..

```
nominal T x = x * x
nominal real Q x = x, x, x
```

Sometihng like that. The later one would start off as a value expression. Instead of doing that I will just do.

```
nominal Tensor el l = `(tensor_init `el `l ``el ``l)
```

In type expressions I will just write the grave character to switch to the value level. Then on the value level I will use grave again to get the type `el` and `l` type variables. Then after that the double grave operator will serve as `type_to_var` operation. Rather than just get the type it will convert it to a variable as well.

This will work really well I can feel it now.

On the value level if I want to fetch the type of an expression, now that types and values are segregated, what I will do is.

```
inl array_map f l =
    inl ar = array_create `(`(f (array_elem_type l))) (array_size l)
```

I feel this meshes quite naturally with the way the new language works. I admit, I've also been thinking of completely getting rid of type get before I realized how much this sort of scheme would simplify nominal types.

It is simply divine. Obviously, I'll disallow scope switching in union type definitions, but I'll asume nominal types are type definitions in the real segment. And scope switching will be allowed there if not in the top-down segment.

7:35pm. Done with lunch. Let me talk about it a bit more.

I've been thinking a lot of how to do serialization. Remember that encoding thing of poker states to n-hot vectors? That is still a significant problem in my mind.

Thinking about it in that context made me realize just how much of a problem pairless union cases would be. And that is what led to the great idea.

One thing I am also thinking about are GADTs. I think they would not be hard to implement in the partial evaluator. But the typechecking stage there is that awkwardness of a forall suddently becoming live. I do not know how to deal with this.

They are cool as they would add a bit of extra type safety in the context of serialization, but it is not like they are needed. Rather than type safety in the usual sense, at most I'd push that type safety a little out of the real segment and into the typechecking stage.

7:50am. But I am in a restrictive mood, so I won't bend myself here to deal with GADTs.

It is already a huge psychological blow to dump reified join points (layout types) and also to force closure convertion on bottlenecks.

One thing I've thought about, but decided against is to unify the two environments, the value and the type one. I realized that once I force closure conversion that I would no longer have issues with leaks, but still I feel there are benefits to keeping them separate on their own.

7:55pm. It is just kind of strange compared to what I've been used to, but the segregation will be better than keeping them united, but then having to add checks on a case by case basis. This way is cleaner.

Let me call it a day here.

It is going to be like this it seems. I will think and think and think until I've built up enough internally to feel confident about starting. v0.2 is going to be awesome when it is done, but it is going to be strenous to get there.

Well I'll do my best. I'll continue brain storming tomorrow if needed."

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[3bb4404615...](https://github.com/petre-symfony/modern-react-udemy/commit/3bb4404615aa748b7ed5152c8e82060bf9d74239)
#### Friday 2020-07-10 18:02:47 by petrero

347. Edit Form Submission(Section 24: REST-Based React Apps)

Blessing we do around editing.

A stream is making sure that inside of stream edit Whenever on Samit right here gets called with our

brand new title and description inside that form Bally's object rather than doing that console log.

We need to call some appropriate action creator.

Now recall that we already wired up the edit stream action creator to our stream edit form.

So inside of an submit all we really have to do here is call that action creator before we do I want

to very quickly pull up the edit stream action creator itself and just get a quick reminder on how it

works.

So if I open up my actions index not just file heres at it Stream right here.

So take a look at the different arguments.

The first argument is actually going to be the ID of the stream that we are trying to edit.

Remember when we make a request to our API the expectation if we are following restful conventions is

that we are going to make a put request to the API specifically to the route streams slash and then

the idea of the stream that we're trying to update.

So that's why we need to pass and the idea of the stream we're trying to update as the first argument

right here.

And then the second argument is going to be the new changed values that we want to update our stream

with.

Remember that prior to the last video we accidentally had a form belly's object that had the ID and

the user id of the stream as well.

Foreign values is really just supposed to be the change properties of the stream.

And so that's why the last video we had that long discussion around making sure that we only set up

title and description inside the form so form values should contain only title and description.

All right.

So let's go back over to our component and we're going to make sure that we call it with our ID and

form formalities.

So back inside the stream at it I'm going to remove the console log we have in there and then I will

call this stop Propp start at it Stream.

Now is the first argument we need to pass in our ID.

Remember we've already got access to our id very easily as this prop's not matched up pro-ams ID will

say easily because.

Yeah that's a pretty long little thing right there but whatever.

So we're going to pass on that idea first.

And then as the second argument we're going to pass in the change form value.

So it's going to be the form values object right there.

Right.

And that is pretty much it.

Now before we test this I want to point out one thing very quickly that's going to save us just a little

bit of time.

Remember after we submit a form the expectation is that we're going to make a request and then hopefully

give our users some feedback.

Essentially you don't tell them that something just changed or maybe transition them or navigate them

to some other page inside of our application.

We already went over this topic in great detail which creates dream up year remember with great stream

we said that after we made our request and dispatch in action we were then going to forcibly navigate

our user back to the main list of streams.

So I think that we should probably definitely do the same thing with added stream as well.

So back inside of it it Stream after we make our request successfully after we then dispatch an action

I'm then going to call history push

and forcibly navigate our user back to the root route of our application write their history push.

OK let's save this and then we'll flip back over to the browser and we'll do a quick test.

So going to first refresh the page just in case and then I'll make a change to how about just my description

right here.

I'll say this stream is about refactoring.

And then I will submit that now as soon as I submit it you'll notice that I get this dream is about

refactoring right here.

But you'll also notice that I've now lost my edit and my delete buttons over here as well which is pretty

darn interesting.

So the input or the update took hold.

That's good.

But the fact that I don't see edit and delete any more even though that is a string that was created

by me is a little bit disconcerting.

So let's take a quick pause right here.

When we come back the next section will figure out why edit and delete decided to up and disappear.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[826431d31d...](https://github.com/petre-symfony/modern-react-udemy/commit/826431d31d12fb89bcd749f31a032767e313c876)
#### Friday 2020-07-10 18:02:47 by petrero

346.1. Avoiding Changes to Properties(Section 24: REST-Based React Apps)

In the last video we got some good work done on our stream component.

I'm back in my stream list.

I'm going to click on edit again so I see my initial values for my Stream right here.

I'm going to again change those very quickly to some jibberish.

And when I click on submit I see the same console log as what we had at the end of the last video.

Now I had said that there was something a little bit off with the console log right here.

So this is kind of a technicality.

And technically our application would work just fine as is.

But it's something I want to throw out there because this is something that might get you in trouble

when you start working on your own projects and it really comes down to how your back and server is

set up.

So take a look at the console log right here.

Notice how we've got the description and the title which is totally expected.

However we also have the I.D. and a user ID in here as well.

Now why is that an issue.

Well remember our edits stream form right here is about only allowing a user to change a title and a

description.

When we eventually call this on Samit callback right here in site of stream edit we're getting some

object that contains what are supposed to be updates to our stream object.

In other words form values right there is only supposed to contain properties that are supposed to change

on our form so form values is supposed to tell us about the set of changes we want to make to the form

we're going to eventually take that object and push it up to our API and where he essentially telling

our API hey here are some change properties that you should use to update some given Stream.

Now the issue with this is that when we pass in the ID a for a year and the user id it kind of makes

it seem as though we have changed the ID or the user ID.

And those are both properties that we do not at all ever want to change.

Well maybe the user id but we probably don't want to change the idea of the stream at any point.

So again this is really a technicality.

It's not going to cause an issue with the API that we're making use of right now.

But if you ever start to use some other back and server where they expect to receive a put request or

a request to update a record they might do some validation and expect that the change set not contain

an ID or not contain something like user ID.

In other words we don't really want to push up values inside this change object of sorts.

That did not actually change because your back and server you might eventually work with an API that's

going to complain about that and say hey you can't tell me that like you have some different idea here

or something like that.

So essentially all I'm saying here is that we want to kind of trim down the properties that we see inside

the subject.

Now the real question here is why is the ID and the user ID showing up in the first place at all if

we're only supposed to show change properties like description and title.

Well the real issue here is that inside of stream edit when we set up those initial values we put in

the entire stream object right here.

So essentially when we pass in that entire object every property inside there is used as some initial

value for the form.

So even though we don't see inputs for those other properties they are still loaded up in the form or

inside of redux form as some initial values for the form.

I can actually kind of prove that to you if we go back over here to our application on stream and we

open up redux dev tools and select states you can then look at form open up stream form and then you'll

take a look at values values right here is an object that contains all the different current values

for the stream form.

And inside there you'll see that we not only have the title and description we also have the user id

and the ID.

So redux form thinks that our form is supposed to have a field for user ID and for ID as well.

And when we submit this form redux form is going to pass along that user ID and the ID which again not

the worst thing for the application but is just really not appropriate to try to eventually Smet to

some back end API.

So we're only seeing user ID and ID right here because we are passing them in as some initial values.

So long story short long story short here kind of a long section.

Talk about a very small thing.

Essentially we only want to pass in an object here with a title and a description just the properties

we are trying to change.

Now there is more than one way we could do this.

The first way we could do it would be to put an object back in here again as we had previously.

So two sets of curly braces on either side and then we can say the title is coming from this dot prop's

dots Dreamcoat title.

And then we can duplicate that same thing for our description property as well.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[95133a0f85...](https://github.com/petre-symfony/modern-react-udemy/commit/95133a0f8587e03ce6628ad28b7ce19523602ce9)
#### Friday 2020-07-10 18:02:47 by petrero

344. Refactoring Stream Creation(Section 24: REST-Based React Apps)

In the last video we created a new stream form component that's going to be used between stream create

and stream at it.

So we're not going to go back over to string create string create now needs to show an instance of stream

form pass down on submit and do basically nothing else.

So it's going to be a very straightforward component moving forward.

So I'm going to open up my stream create file please.

Triple check please make sure you are inside of stream create make sure you are not making changes to

stream form stream form is fine as is now inside of here.

We're going to do a tremendous amount of cleanup so we'll go through this step by step.

But please do try to watch somewhat closely because we're going to be doing a lot of little refactoring

inside of here.

All right.

So first off this stream create is no longer going to be showing a form.

So we don't need a field or redux form anymore so I'm gonna delete that import.

We do want connect and we do want create stream because eventually stream create is going to need to

call an action Creator in an in an attempt to create this new strain.

We also need to import the stream form component that was just created.

So I will import stream form from stream form then inside of your we dont need to render an air any

more.

So I can delete that we don't need to render any inputs any more so I can delete that but we do need

to have some on Samit callback like the one you see right here.

Now this doesnt have to be called on Samit per se.

We could bring him this.

Anything we want.

Remember we're just going to pass it down as a prop named on Samit.

I think that leaving it cool or calling it on Samit right here is fine.

However some is going to leave it as is now inside of my render method.

We're not going to show a form anymore.

We're not showing any fields anymore and we also don't need to show any buttons anymore.

So the entire render method can be removed to all the geas x inside there and then we will replace that

with just enough to show the form and a header at the top because remember the Create stream.

Or mean the stream form component does not actually show a header.

So inside of my render method I'm going to place a div in place how about a h three.

Let's do an H3 I think that's reasonable and I'll say create a stream and then after that we can place

our stream form component and pass an on submit.

And that's going to be this dot on submit like so we fix that up.

There we go.

So now stream create is going to add in a little bit of GSX of its own.

It's also going to show the appropriate form and pass down the callback to be called any time that the

form gets submitted.

Now we're not done just yet.

Little bit more clean up and side of stream create.

So we don't need a Validate function inside of your anymore.

The validation is being handled by our form.

So I'm going to delete the validate.

We also are not doing any wrapping with redux form anymore so we can delete all that and we're left

with just our export default statement right here.

We don't need a form wrapped anymore because we don't have that kind of like two stage wrapping process.

Instead I'm going to pass in that stream create like the.

All right so that is it for the reactor.

Now I got to ask you please please please take a look at your screen create and make sure it looks very

similar to mine.

So we've got the four import statements we've got on Samit we've got the render method and then we've

got export default.

We did a big refactor here so I just want to make sure that you did not miss any of those steps because

if you miss a step here yeah you're probably going to see the air pretty quickly as you might guess.

All right so once you're happy with what you have we will save this file will flip backwards the browser

interface.

Just gonna make sure we don't see any error messages so no errors around syntax or anything like that

so I think I'm in a good spot.

So now the next thing I want to do is test out the stream creation form because we've not yet done anything

for the edit side.

So I going to go back to my list of streams by clicking on my logo up here and I'll navigate to my Create

stream form.

I still see the form as I saw it before and it looks fantastic.

So now I should be able to enter in some title here.

Let's say me streaming component reuse because that's kind of what we're doing here.

Watch me refactor some components.

I'm going to open up my network tab just to make sure I see the requests go through.

I remember after we successfully create the stream we will get automatically navigated back to the streamlets

component.

So I click on submit.

I see the post request for creating the new stream.

It looks like it was successful.

And now on my stream list I see the new stream that I just created.

Awesome.

So that's pretty much it for the stream create side of things.

We've now got a component that uses this reusable form.

So now we can pivot our attention back over to stream edit.

We're going to do essentially the same exact thing we just did.

There's just going to be one tiny difference here in the fact that we need to make sure that stream

edits form is going to show the title and description of the current stream.

So let's take a quick pause and we'll start working on stream edit in the next video.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[aa65634691...](https://github.com/petre-symfony/modern-react-udemy/commit/aa656346911db2e4b40fb3df96a9f9ffd46cdde4)
#### Friday 2020-07-10 18:02:47 by petrero

351. Creating a Portal(Section 25: Using React Portals)

In the last video we spoke about why we use portals so any time that we want to kind of get a element

not rendered as a direct descendant of some component we can use a portal to instead place that component

as a descendant of some other element inside of our T.M. structure.

The most common uses for this are to make modal windows or any that we want to work with some third

party library or use react to render some content into some third party element or something like that.

So let's try creating a new modal element.

We're going to build this as a reusable component where we can show any content inside of it that we

want to show.

So let's get to it.

I'm going to flip back over to my code editor.

I'm going to close down that motile HTL file.

You can delete it if you want to but I would recommend just keep it around as a quick example.

Then inside of my components directory I'm going to make a new file called modal dot G-S and then inside

of here we're going to put together a little bit of boilerplate for a functional component.

So I'll say import re-act from react.

I'll say import react Dom from re-act dash Dom.

Notice how we are importing react Dom inside of your which we normally do not do except inside of our

root component file.

Usually the index not G-S file.

Then after that I'll defined my functional component so say Konst modal is going to receive some number

of props we're going to use that in just a little bit and then right now I'll just very quickly export

default modal at the bottom.

All right so now at this point I know that you are very much used to always returning some GSX from

all of our components like so right we return some GSX have some techs inside of it or reference to

another element or something like that.

When we create a portal the return value of our component is going to change just a little bit.

So here's what we're going to do.

We're going to say react Dom don't create portal.

Now this function is going to take two separate elements or submit arguments the first argument is going

to be some blob of GSX something that we want to show on the screen.

So in this case I'm going to put in as the first argument a div with a class name.

Of UI dimmer modals visible active like so.

Now that seems like a very specific class name.

While the class name is coming from semantic UI remember we have semantic UI wired up to this project.

So these are all the class names that are required to get a modal or the background to be precise to

display on the screen.

Then inside that div I'm going to place another div with the class name of UI standard modal visible

active and then finally inside of there I'll just place a little bit of jibberish for right now.

So this should get a modal to show up.

Now the only issue is that we need to make sure that this modal or these two divs right here are rendered

directly on our body element as opposed to being deeply nested underneath like stream delete or something

like that.

So in order to make sure that we attach that modal or that did those two divs appropriately to the body

element we're going to provide a second argument to create portal.

So I going to put a comma right there.

And then as the second argument I'm going to provide a reference to the element that I want to render

this portal into.

Now I know that I've been saying oh yeah we're going to attach it to the body attached to the body.

Well if we try to attach this to the body or give a direct reference to the body then that portal is

going to actually replace all the current content in the body.

So instead what we usually do when we create a portal is we will go into our index each file and we'll

create a new div with some ID and the will target that div to place our render.

I mean our mode our modals has me into going to flip back over to my index.

HTL file instead of my public directory.

So this time index dot H.M. not the modal dot HTL file.

Then inside if you're going to scroll down to our div with idea of root and as a sibling to that I'll

place a div with an ID of motile like so.

So now we're going to provide a reference to this div right here to that create portal call so going

to save the HMO file I'll close it.

I'm going to go back over to my motile dot J.S. file and I'll provide a selector for that or a reference

to that div by saying document Dom query selector pounde modal like so.

And that's pretty much it.

So now anytime that we render our modal component on the screen rather than showing up as a direct child

of the parent component Ill be rendered into the div with an idea of modal.

Now if this div does not exist inside of our HMO document we're going to very quickly see an error message.

So just be aware of that.

Now last we have do is attempt to actually show this component on the screen so I'm going to open up

my stream delete component stream delete at the top.

I'm going to import motile from up one directory modal and then I'm going to turn this into a multi-line

GSX expression.

Make sure you take care of that semicolon right there and then as a child or a sibling to stream delete

right here the plain text.

I'm going to place my modal component like so.

So now anytime that we show stream delete we're going to render modal modal is going to take this GSX

right here and attempt to insert it as a child to that div with the ID of modal.

So let's now save this.

Well flip back over to our browser and see how it works.

So I'm going to flip back over to my application at localhost 3000 and then we need to get that delete

component to appear on the screen as a quick reminder we can find out that you are l or the path to

use to access that component.

If we open up our app component.

So here's app right here.

Here are our routing rules.

So if we just go to stream slash delete we should see that component appear.

So I'm going to go to local those three thousand streams.

Slash delete.

And now I see my motile appear on the screen successfully.

I know it's really ugly but it is technically working.

We've got our text inside of your.

We've got the gray background.

And I can kind of see the elements behind it but not quite.

So the model is definitely working as expected.

OK so that's pretty much it.

That's not what we use these portal things for any time we want to create a portal.

We return a reference or a call to react on.

Create portal.

The first argument is going to be some GSX.

The second argument is going to be a reference to a DML element.

Usually we're going to get that reference by using Document query selector.

Now the only time that you're going to want to create a portal is anytime that you are doing something

like say creating a modal obvious case or any time that you are trying to render some re-act component

into some DML that was not created by your application or by your re-act application to be more specific.

The most common case in which you will use something like create portal in that in that type of scenario

is if you're trying to introduce re-act into a server side rendered application maybe like a Java application

that renders HTL on the back end or maybe a Ruby on Rails application or Django or something like that.

OK.

Now we've got our modal component put together.

Let's take a quick pause right here.

When we come back the next section we're going to start to customize this thing so that it looks a little

bit better a little bit closer to what you see it right here.

So quick pause and I'll see you in just a minute.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[3f25d19795...](https://github.com/petre-symfony/modern-react-udemy/commit/3f25d197955121ad546894e04c4d615d64b12207)
#### Friday 2020-07-10 18:02:47 by petrero

343. Real Code Reuse! (Section 24: REST-Based React Apps)

Now that we've got some initial stream loaded to show inside of these inputs of the title and description

Remember we want to show the current title and description side there.

We can now start to think about putting together the actual edit stream form now before we do I want

to point out something kind of interesting here.

I want to look at the mockup for create stream an edit stream at the same time.

When you look at these two mockups you start to kind of get the sense that these are really really similar

like just two forms.

Visually are just about identical.

There's just a couple of very small differences between the two.

First off you'll notice that this one over here has a header of create a stream.

The other one has added a stream.

The next big difference is that between the two that create streamed does not have an initial title

whereas edit stream is going to put the current title into the input so that a user can change it in

some fashion and then find the same thing with description as well.

So with the create form description starts out as empty with edit.

We have the current description inside there so that the user can change it and there's one other difference

between these two forms.

That's not quite visible inside these mockups.

And the other difference is essentially what action creator gets called when the user presses that submit

button.

In the case of creating a stream.

So this form over here that we already put together we would probably want to call our action creator

of create stream that's the one we already put together.

We already did a lot of work on this action creator right here.

So we probably want to call that action creator with the Create stream form and with edits stream.

I bet you could probably guess we probably want to call the edit stream action creator.

So there's really just three big differences between these two forms.

The header whether or not these inputs have some initial value inside them and what action creator gets

called when the user clicks on the submit button.

So it seems to me like this might be a fantastic opportunity to try to get some code reuse inside of

our project.

We've spoken a lot about techniques for code reuse throughout this course and I've certainly said many

times like oh yeah we could enhance reusability of this component by doing X Y Z but we really have

never reuse any of the components that we've put together.

So this is a case where we are going to be able to reuse a component between these two forms.

So let me tell you exactly how we're going to do that.

All right.

Where is my diagram.

Here it is.

OK.

So here's the idea.

We're going to create a total of three components between those two pages.

We're going to have a stream create a stream edit and stream form.

Now the bulk of work like the vast majority of showing those text inputs handling changes wiring up

to redux form all that kind of stuff is all going to be done inside of this new stream form component

that we've not yet put together.

So all the logic that hooks up to redux form all the logic that renders text inputs all the logic that

submits the form and handles the mission appropriately.

We're going to place inside a stream form we're going to refactor our current stream create component

and we're also going to make some changes to stream at it.

We've only got some like you know a little boiler plate and there right now here's stream at it as it

stands.

So we're going to refactor both these components.

They're going to show internally the stream form.

And the only thing that we're going to really do between all these components we're going to make sure

that stream create passes down a on submit callback to stream form so that stream form knows what to

do.

Anytime the users time it's the form.

So essentially stream create is just going to slightly customize the form in addition stream edit is

going to pass down an on submit callback as well.

So any time someone submits the stream form it's going to call the Submit callback that is passed down

from stream at it.

The other little thing in here as well because stream edits form needs to have some initial values inside

there.

Right we want to show the initial Where is my mockups There we go we want to show the initial title

and description side of your we need to make sure that the stream edit component also passes down some

initial values to show inside of those little text and puts as well.

All right so that's that's the idea here.

That's what we're going to do.

We're going to kind of abstract out all the form logic to stream form that's going to contain everything

with redux form and then we're going to significantly cut down on the amount of code and stream create

We're going to have very little code inside of stream at it as well to just pass down some on Samit

and in the case of stream at some initial values as well.

So let's get to it.

Let's flip back over to our code editor.

All right.

So Bacharach you are going to find my stream's directory and I'm going to make a new file called stream

form.

And the idea here is that we're going to have a form that can be reused between both components.

Now to get started I'm going to open up stream create.

So your stream create right here stream create already has a tremendous amount of logic inside of it

for showing the form and the air messaging and all that kind of stuff.

So essentially want to take all the logic inside of stream create and refactor it to make sure that

this thing does not attempt to call any distinct action creator when it gets submitted.

Instead it should call some callback that gets passed down from a parent component.

So inside a string create I'm going to select everything inside of your I'm going to copy it and then

I'm going to open up the new stream form file that we just created and I'm going to paste stream create

inside there.

So now inside stream form I have everything from string create.

Now the first thing we're going to do inside of here is refactor the class name.

So I going to change the name to stream form.

I'm going to make sure that I change the name down inside of my export default statements down here

as well.

So here's where we did the initial reform wrapped and I passed in string create right here.

We're going to make sure we refactor that to be stream form as well.

Next up stream form does not need to call any action creator.

It's going to be a parent component that calls some action creator.

So we don't need to pass and create stream at all.

And now once we do that you'll notice that we don't have anything else that we're using the connect

function for.

So we don't actually need the connect function here at all anymore so we can delete that entire export

default.

And now we can go back to having a single export default or a single wrapped component right here.

So rather than assigning the result of redux form to form wrapped I'll just say export default redux

form next up we can change the name of the form because it's now going to be generalized between all

these different pages that are trying to use the form.

So change the name to stream form.

That's not really required but you know what the heck let's do it anyway.

All right.

Now the last thing I think we need to do is going to be on submit right here.

So remember we don't want to have stream form decide how to handle this mission anymore.

Instead a stream form should attempt to call a callback passed down from props from some parent component

so on Summit right here rather than calling create stream.

I'll call this Scott prop's dot on submit.

So we're now going to expect the parent component to pass down a callback called on submit.

And that thing is going to be called with whatever values are coming out of our form.

All right.

I'm going to do a quick pass in here.

I don't really see anything else.

I think the only other little cleanup we could do would be to remove the import or connect right here

and the import for the action creator create stream as well.

And I think that's just about it.

So we now have a generalized stream form component.

Now at present the one thing I want to point out here is we are not handling this kind of initial values

thing in the case of stream.

It will talk about exactly what's going on with that in just a moment.

So right now let's just focus on getting stream create with on Samit working with the stream form.

All right so I'm going to save stream form.

We're going to take a pause right here and when we come back the next section we're going to do a huge

refactor to stream create and make sure that it uses stream form and just passes down some appropriate

callback function to be called.

And any time the form gets submitted so quick pauses I'll see you in just a minute.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[868a1f577b...](https://github.com/petre-symfony/modern-react-udemy/commit/868a1f577baf194e294384c60e49c442832cfc71)
#### Friday 2020-07-10 18:02:47 by petrero

350.4. More on Using Portals(Section 25: Using React Portals)

Well before we even think about fixing it you might say to me.

All right.

Well Stephen this seems like a really silly example.

But we have to do is take out this div with class positioned right.

That seems like a real simple example or maybe we should change the z index a position right here.

Now we could change it to like 99.

And now that's going to definitely beat out the sidebar.

So if I save this now and refresh we're back to the original good case.

Well here's the issue.

Remember I've now made a pretty big deal saying that when we have a re-act application we've got all

of these different divs all these different elements all these different components.

And our model might be deeply nested inside there.

And so this is a kind of contrived example of how a application might look that you are going to work

on some day you might work on an application that already has hundreds of components inside of it and

you might have a super deeply nested component structure.

And so it's not always going to be quite so easy for you to just say oh yeah I just need to like change

some parents DSS because this might be CSSA that has been super finely tuned and if you change it you

might break the entire application.

So it's not always a good solution to just say oh yeah just delete that div right there and you'll be

good to go or to change the z index on it and you'll be good to go.

It's incredibly likely that if you're adding a motile into some existing application you might end up

having to break the entire layout and rewrite all the CSSA for the project.

At least the layout us to get a modal working.

So just saying oh yeah I'm going to change the styling or the z index on this position.

Elmet right here or delete it entirely is not a good solution.

It's not a solution at all.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[67cece4a14...](https://github.com/petre-symfony/modern-react-udemy/commit/67cece4a140bb2286ab5eb63f4328219a2e26241)
#### Friday 2020-07-10 18:02:47 by petrero

348. PUT vs PATCH Requests(Section 24: REST-Based React Apps)

In the last video we successfully edited a stream.

I'd definitely change the description.

This one right here.

But when we came back to the streamlets page I no longer see the buttons to edit and delete the stream.

So that seems a little bit off but I bet we can figure out what's going on here.

I'm going to open up my network request tab right here.

I'm not going to refresh the page and take a look at the request to get my list of streams from the

slash streams and point on my API when I select that request or then open up response right here or

preview either one inside of this list of streams.

Here's my Stream right here I've got the title and the description.

I've also got the idea.

Remember we only show those edit and delete buttons if the user id of the stream is equal to the currently

signed in user.

So I don't see any user ID right here.

So something seems a little bit off.

Well let me just come out and tell you exactly what's going on here.

I want you to see this little air right here to kind of clean clear up a very common misconception in

the world of rest requests restful requests are restful conventions.

All right.

So I showed you this chart a while ago right here.

MEMBER We spoke about restful conventions with this.

We spoke about how we can make a get request to streams to get a list of all of our records.

We spoke about making a post request to stream's to create a record and then I had told you that to

update a record we were going to make a polite request to stream's slash and then the ID stream that

we were trying to update.

Now a lot of documentation you're going to read is going to say exactly that but a put request actually

has a little side effect to it.

That is very commonly not well implemented in a lot of back and API.

So here's what really goes on when you make a put request.

The actual thing that happens is whatever properties you put inside the body of that request are going

to replace all the properties inside of the record that you're trying to update.

So in other words when we just made our update request were are put requests on submission that form.

We posted the title and description property right.

We just made a big deal about saying that we were only going to take the title and the description out

of the form and attempt to submit that to the back end API.

The problem is that when we made our request to our API the API said oh OK I see a title and description

and I see you made a put request so I'm going to take all the different properties inside the stream

the title The ID the description and the user id as well.

And I'm going to replace them with just the properties that you posted or put up to this API.

So we put a tile and description that meant that we took the existing title description and user ID

and replace it with just the new title and description.

The one property that is usually immune to this is the id property.

So essentially when we made our Put request we did not include a user ID inside of that update and we

did that for very good reasons that we just discussed.

But our back and AAPI interpreted that as saying oh you no longer want a user ID and so it just dropped

off the user id entirely.

And that's why we don't see the User ID associated with our request here anymore.

So again I wanted you to see this I want you to run into this problem because a lot of people kind of

designed these put request routes on back and servers in different ways.

You're technically supposed to make sure that a put request is going to replace or update all properties

of a record which could potentially lead to deleting properties off a record on the API.

If you really want to just update some properties we're actually supposed to use a different type of

request called a patch request so that the Patrick Quest we're going to pass some properties inside

the body the request that are supposed to be updated on the API.

And with a patch request just those properties are going to be updated.

It's not essentially an overriding operation that's going to cause some properties to be dropped off.

So let's try updating our action creator to make a patch request as opposed to a puts.

So I going to go back over to my actual creator file to find at it Stream right here and essentially

all you have to do is rather than calling put right here to make a point type request we're going to

make a patch request instead.

That's it.

So now when we make a Patrick quest to our back in API with form values we're just going to be updating

the form values on our API and we're not going to destroy or unset any properties with our stream because

we were making the request before.

So let's flip back over to our application and we'll test this out really quickly.

Now this time I'm going to attempt to edit this Stream right here so click on edit and all change the

description of it.

I'll say this change was made by a patch request and then I will submit this.

Now inside my requests log right here you can see that I'm now making a patch request so I can select

that I see the response right here and the response has the new description as the same title.

It has my user ID.

Most importantly so I did not overwrite the user ID.

And now when I go back to a list of streams I still see the edit and delete buttons as I would expect

whenever I edit a stream.

Ok guess that's pretty much it.

Again I want you to see this issue because you're going to see a lot of conflicting API is where sometimes

if you make the request it's going to drop off some properties and in those cases you're supposed to

use patch instead.

But a lot of people choose to just kind of disregard this rule when they are designing API or back and

servers.

A lot of people just say oh yeah just make a put request in the back end server or we'll just merge

these different properties as opposed to dropping some off as we just saw.

I guess now that we've got this all fixed up let's take a quick pause right here and we'll continue

in the next video.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[b7ff7c12c2...](https://github.com/petre-symfony/modern-react-udemy/commit/b7ff7c12c299657dddf0870ade871767768dca5a)
#### Friday 2020-07-10 18:02:47 by petrero

349. Why Use Portals?(Section 25: Using React Portals)

Our application is coming along pretty darn well.

We've got our index page put together.

We've got the ability to create streams edit streams and now we're going to start to move onto one the

last big pages of our application the delete stream page when a user comes to this page.

We're going to show what is called a modal to them.

This is a modal window a modal window essentially prompts the user to take some action.

I can very quickly show you a example modal.

If I open up the diagram program that I'm using right now at draw IO I'll see a big window appear here

right on the center of the screen.

So this is a modal window in-action it's prompting need to take some immediate action and there's really

nothing else I can do on the screen until I resolve this.

I can still see some of the content of the page kind of faded out behind it but I can't directly interact

with it until I do something with them with the modal window.

So that's what we're going to show for our delete stream page.

I want to show a modal window to the user that's going to essentially force them to either delete a

stream or not delete the stream.

So in this video we're going to start talking about how we can create modal windows with react.

You might be surprised to hear that creating models with re-act is surprisingly challenging.

So I'm going to walk you through an example of exactly why modals are challenging and why they're challenging

specifically with react.

So let's get to it.

OK.

This first diagram right here is a diagram of a typical re-act application.

The component hierarchy at the very top of any HMO document we have the body tag inside the body.

We usually have a div with an ID of root and we'd render our entire re-act application into that div

with idea of root.

So inside that div we've got a provider we've got the app any routes routes maybe our stream delete

component that we're going to create in just a little bit maybe a modal component and then maybe some

button inside of that that a user can click to either delete or not delete the stream.

What I'm trying to communicate here at this diagram is that any re-act application all of our elements

are nested inside of that div with the ID of root and that is the normal operation of react.

However there is a feature inside of re-act called portal's.

And we're going to ultimately use a portal to kind of get around this requirement of having to nest

all of our different components elements whatever you want to call it inside of this Dave with the idea

of root.

But before I just tell you hey here's how a portal works.

You need to really understand why would we why we would even want to use a portal in the first place.

So understanding this right here understanding how all of our elements get ultimately rendered into

a single Div..

I now want to show you how we usually create a modal window without react at all without re-act without

javascript without anything like that and you're going to very quickly realize that if we use traditional

re-act layouts like what you see right you're putting together that model will be rather challenging.

OK so here's a little exercise that you and I are going to go through.

We're going to forget re-act we're going to forget javascript.

We're going to make a normal aged mail document and we're going to try to get a little modal window

to show up inside of it.

And as we go to that process like I said you're going to realize that using typical react to do this

might be a little bit challenging.

So for this little side application we're going to put together with plain e-mail.

I want to have a window that shows I'm a sidebar and I am a person that has some content in the center

of the screen as well.

And then we can optionally put a model on the screen and when the Spittal appears it's not kind of obscure

or not replacing that content the other content is still visible behind it.

But the model is meant to kind of sit on top of that stuff and demand some attention from the user.

So again I want to put this example together with normal H.M. normal success and are going to very quickly

realize that putting these portals together not the easiest thing.

All right.

Let's get to it.

I'm to flip back over to my code editor Sunstone side of my project directory here to get a normal HTML

document put together.

I'm going to open up my public directory and create a new file called modal HMO.

So we're going to write up our entire league's entire modal example inside this document with normal

CSSA and normal HMO inside if you're going to put down a head tag and a body tag and inside of the body

tag.

I'm just going to put some plain text for right now that says I am a motile example and then I'm going

to try to access this you know document inside my browser.

So in order to access any file inside of our public directory we're just going to go to local host 3000

slash than the file name.

So in this case middle aged.

So I'm going to open up a new browser tab and navigate to localhost Kulin three 3000 slash modal dot

HD mail Lexow and I should see the text from that H.M. document appear on the screen.

All right.

Now that we've got that showing up let's try putting together the route of this example so that sidebar

element and some content on the very center of the screen.

So inside my body I'm going to place a div with a class.

Don't forget we are now writing female not writing GSX right now.

So in order to specify a CSSA class we just write out class not class name.

So it's a class sidebar

and I'll give it some content.

I am a sidebar.

After that I'll place another div with a class of content and inside of that one I'll put a H-1 that

says I am some content.

And now if I say this again I should be able to flip back over to my browser refreshed the page because

we don't get automatic reload with just plain ational documents and then we'll see.

I'm a sidebar and I am some content now.

Very quickly add in some CSSA just to get these elements into the correct position.

Inside my head tag I'm going to add on a style tag and we'll just write some CSSA directly into here.

So first off I'm going to attempt to position that side bar on the left hand side of my screen so I'm

going to put in a side bar CSSA select a regular I'm going to give it a position of fixed a top of zero

a left of 0 a height of 100 VH which is just going to make it spanned the entire height of the screen

a width of 300 pixels and then I'll give it a background.

Color of green.

Just to make sure that we can really tell where the sidebar starts and ends.

After that rule then add in a CSSA selector for content as well.

So say duck content and I will give this a with or me a margin dash left of 300 pixels the margin left

right here is just to make sure that the sidebar does not overwrite or obscure any of our content.

So now I'll save this very quickly put back over and I see my sidebar with I am some content and just

recall I always run with my browser very far zoomed in.

So you probably see something like this right here.

OK.

So this looks good.

It's a good place to get started.

So let's take a quick pause right here.

When we come back in the next section we're going to start putting this motile together.

And again that's when you're going to start to learn why we want to use this portal's thing with react

at all.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[6c2161c67f...](https://github.com/petre-symfony/modern-react-udemy/commit/6c2161c67f92eb4926f7e569b345434a79406753)
#### Friday 2020-07-10 18:02:47 by petrero

345.1. Setting Initial Values(Section 24: REST-Based React Apps)

In-class video we read factored stream create to make use of stream form.

We're not going to do the same thing for stream edit as well.

Stream is going to be very similar to the work we just did inside of stream create the only big difference

here remember is that we want to make sure that the form is going to show some initial values inside

of those inputs.

Someone to very quickly tell you how we do that with redux form.

First I need to open up my code editor and find the stream form component.

Here it is right here.

Stream form.

So I just want to remind you very quickly that down at the very bottom of the file when we export a

component from here we have stream form.

And it gets wrapped inside of redux form.

Right.

It gets wrapped by that helper right there.

So just with that in mind I going to show you another diagram here.

Very quickly.

So in this diagram very similar to the one we are just looking at.

I just essentially took off stream creates.

So we have stream edit that is showing stream form wrapped inside of that redux form helper.

So when we passed props from stream at it down to stream form just as we did inside of stream create

remember your stream create right here and we pass some props down to stream form.

We're not actually passing props directly to our stream form component.

Instead we are technically passing props to redux form redux form then turns around and passes those

props onto our component.

So there are actually some very special props that we can pass down into the redux form wrapped component

that we are creating here.

One special component or Simmie one special prop name is initial values.

If we pass some initial values Propp from stream at it down to this kind of redux farm rapt stream form

it's going to provide some initial values to show inside of the text inputs inside of stream form.

So if we pass in a prop named initial values specifically initial values that is a very special name

with redux form.

And if that object contains a title and description then those will be used at the as the initial values

for our form.

Now when I described this with diagrams it probably looks kind of confusing.

So let's just start to work on string at it.

And then when we get to the part where we want to set up these initial values We'll take another glance

at this diagram to make sure you understand what's going on here because this is a really key topic

for understanding how to set up any type of form like this right here with redux form.

So let's get to it.

All right.

So I can open up my code editor and I'm going to find the stream edit component.

Now inside of here we're going to do a step by step refactor just like we did with string create.

So up at the top I've got import connect.

That's good.

I've got import jet stream.

That's good.

I also want to import edit stream from my action Kreator file as well.

Remember edit stream is what is going to eventually allow us to take the idea of a stream and some new

properties for the stream and update our API record or the record maintained by the API.

And then after that I'm also going to import our new stream form component from stream form Zao inside

of your.

We're going to leave the component in MT still want that.

We're going to define an on Samit function.

This is going to be used as our callback for stream form just like we had inside of a stream create.

So when the user eventually submits our form this thing is going to receive some form values and for

right now we will just cancel log out those form values.

Next up inside the render method rather than just returning a div with the stream's title that we fetched

we're going to instead return a multi-line block of GSX just like we did back on stream create.

So now inside if you're going to return a div with an H 3.

Is that what we use on the other one.

When we check really quickly Yeah it's three that says edit a stream and then after that we will place

our stream form component.

Now just like before we're going to pass in an on submit callback and then we will leave off the initial

values that I was talking about just a second go for right now.

So we went to any initial values just yet let's just get this component to show up on the screen and

then we'll come back and visit this initial values thing.

But this is where we will specify our initial values.

Last thing we need to do here down at the bottom we still want this map state to prop's so that we can

get some initial values for the form.

We still want to have the connect function here we still want to be able to fetch a stream.

The only other change that we need is to make sure that we pass in our action creator at it stream again.

That is the action creator that's going to make her request over to our API and update some given stream.

So I can make sure that on the Connect function right here I also put in at it stream.

OK so let's save this and we'll flip back with the browser and just make sure that we can get some form

appearing on the screen.

So when I flip back over I'm going to go back to my list of streams page and then click on edit for

one of these two streams right here doesn't matter which one sultry editing this one.

All right.

So I see my form right here it says edit a stream but as we said we don't have any initial values for

the form.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[b99a48dd4d...](https://github.com/petre-symfony/modern-react-udemy/commit/b99a48dd4d10a06a9116f6199f299ac1459bf6a9)
#### Friday 2020-07-10 18:02:47 by petrero

346.2. Avoiding Changes to Properties(Section 24: REST-Based React Apps)

Well I'm going to show you another way of handling this that's going to be just a little bit more concise.

So I'm going to delete everything in between those curly braces and then at the very top of this file

We're going to import load ash.

Remember that is that helper library that we've been using quite a bit.

So we're going to use a function from Lotus to basically just pick out the values or the properties

from that stream object that we care about and that we actually want to pass down as initial values

to our form.

So back down at initial values right here I'm going to say underscore dot pick

and then I'm going to put in my stream object.

This dot props start Stream.

And then I will put in a list of all the different properties that I want to essentially pull out of

that object and pass down to initial values.

So in our case we want to pick out title and description.

And let me say this you can see the entire line very easily OK.

Let's test this out very quickly and we'll take a look at a quick example of how pick works just in

a little bit more greater detail.

So I going to save this I'm going to flip back over.

Now I'm back at my form right here and if I look at my redux dev tools and look at my state I can open

up loops form again.

I can look at my stream form I can look at values and I'll see that I only have the title and description

loaded up into redux form.

So now if I change these and submit the form again I see that my essentially kind of like change object

right here only has the title and description no longer is my idea inside there no longer is the user

ID inside there.

It's only the properties that I actually changed inside the form.

All right.

So again we did that by making use of this pick function from loadout.

So just really quickly I want to show you a quick example of what pick is really doing for us even though

I mean you can probably imagine what it's doing.

Let me give you a quick example.

Nonetheless someone to do my favorite thing hearing and a pull up in that little code editor again there

is the link to it if you want to follow along so inside if you're all put together some object like

say profile and I'll give it a name of Sam and age of 18.

And how about a favorite color.

Of green.

So now I can call underscore pic on profile and as the additional arguments into this thing I can list

out the different properties that I want to pull out of this profile object so I can say name like so

and you'll see that on a top right hand side I now get a new object returned.

That has only the name property out of profile.

This does not actually modify the profile object if I printout profile as well.

You'll see that profile itself is completely unchanged.

So profile creates a new object with de-listed properties.

So I could add on a third argument here of age and now I get name of Sam an age of 18.

So again we're doing the same exact thing inside of our form for our initial values right here we are

just picking out the form values that we care about and that we want to actually edit inside that form.

All right so I think that we probably get a good idea of what's going on here with the initial values.

Now let's take a quick pause.

When we come back the next section we're going to wrap up all this stream at stuff by making sure that

our Samit callback right here comes the appropriate action at Kreator to actually edit and update our

stream.

So quick pause and I'll see you in just a minute.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[45ed1d39c4...](https://github.com/petre-symfony/modern-react-udemy/commit/45ed1d39c4b7f3a70d73fdb721399bf7d19ac1b0)
#### Friday 2020-07-10 18:02:47 by petrero

350.5. More on Using Portals(Section 25: Using React Portals)

So again how are we going to do this.

Well essentially we're going to use a little bit of a cheat.

Here's what we're going to do rather than showing our model as a child of positions.

We're going to instead show the modal as a child of the body.

Now you might look at this and still think Stephen way that goes against what you were just saying two

seconds ago.

Well not quite.

Remember when we look at this diagram right here of how we have to put re-act applications together

we had said that if the stream delete wants to show a modal the modal component will be rendered down

here.

So I'm essentially saying rather than follow the normal rules of re-act where we nest all of our components

underneath each other we should try to kind of like break or bend this rule a little bit and that's

exactly what we're going to do by using this portable thing with portal's.

We don't have to stick with this type of component hierarchy where everything is a child of this div

with the ID of root.

Instead when we use a portal we can essentially say OK stream delete We want you to render a modal component

but we don't want to have you render a modal as a direct child.

Instead try to render the model component but make it a child of some other element in our HMO hierarchy

such as the body element way back up here.

So that's the core purpose of a portal.

A portal allows us to render some element not as a direct child.

We can instead render that element or that component as a child of some other element inside our HDL

structure.

Most commonly the body why would we want to do this at all.

Well we would do this to get around all this rules of stacking contexts or trying to show a modal or

CSSA issues or stuff like that.

There are many different scenarios.

Modals are just one of them but it's the easiest one to show where we might want to render some element

or some component as a child of some other element inside of our application as opposed to just a direct

child of some given component.

So now if we render the modal as a direct child of the body we can set any z index on it that we want.

We will not run into that same stacking context issue that we saw a second ago and will be totally fine

and the modal will show up correctly and not conflict with any other element inside of application.

And so if we go back here to this HTL example the Senshi we would imagine still leaving position there

and leaving whatever other content position had you know maybe position had a bunch of text inside it

or something like that.

And we're going to instead just take our div with class modal and make it a direct child of the body

like so.

So now if I save this we can go back over and we're back to good operation as we saw before.

OK.

That's that's pretty much it.

That's why we make use of portal's.

Now the one part I left out here is telling you how we use a portal.

So let's take a quick pause right here.

When we come back in in the next section I'll show you how we create a portal and render something into

it.

So quick break in I'll see you in just a minute.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[6ead3b5576...](https://github.com/petre-symfony/modern-react-udemy/commit/6ead3b5576ae229b436fa91faaf30e424e796332)
#### Friday 2020-07-10 18:02:47 by petrero

352.2. Hiding a Modal(Section 25: Using React Portals)

I think you can agree with me that you probably feel like if you hit Baqir or on the background you

want to see the modal go away.

So let's figure out how he could do that.

All right so I'm going to flip back over.

Remember that right now we're only showing this motile on the screen.

If the user is out the route streams slash delete.

So a very easy way that we could get this motile to go away is to just navigate to a different route

inside of our application.

So essentially if a user clicks on the background div we want to navigate the user to some other location

or path inside of our app.

We can get a user to navigate programmatically by making use of that history object that we created

a little bit ago.

So inside my motile at the very top I'm going to import history from up one directory history.

So this is remember that history that Jesus object or the history such as file where we created our

history for re-act router then on my div with Diemer modals visible active I can add on a on click event

handler So anytime that a user clicks on this thing we can call history dot push and we can go back

to our route route like so.

So notice how I wrapped this inside of a ero function.

So anytime we click on that thing run that arrow function which is going to call history don't push

it let's try saving this and give it a quick shot so I'll flip back over.

And now when I click on that I see the window go away.

Let's try that again one more time because it happened pretty darn quickly.

I'm going to again go to localhost three thousand streams slash delete.

And now if I click on say the background Yup I go back to my main stream window.

But let's do this one more time and I want to show you some interesting behavior this time around.

I'm going to click like just to the left of the delete button.

Let's say that our user comes in here and they try to click that delete button but they accidentally

clicked just off to the left side.

So if I click just to the left hand side that still dismisses the entire model or it navigates us away.

Well why is that.

Well essentially this is very basic event handling this is event propagation.

So remember this is default javascript behavior default HTL behavior.

If we ever trigger an event on some child elements and that child element Element does not handle that

event the event is going to essentially bubble up to some parent element on leave he gets caught with

an event handler.

So in this case if I click on any of the elements inside of any of these things that click event is

going to bubble up to this device.

It's going to run the on click event handler right here which is going to run history push.

So that's definitely something that we probably don't want to have happen.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[acaeb0769e...](https://github.com/petre-symfony/modern-react-udemy/commit/acaeb0769e3d8c3ff367cfc272a77f4416962f2d)
#### Friday 2020-07-10 18:53:36 by petrero

359.1. Deleting a Stream(Section 25: Using React Portals)

The last thing we have to do with our stream delete modal is make sure that these two buttons right

here delete and cancel actually do something.

So the cancel button is going to be pretty easy with the cancel button if a user clicks on it.

We probably want to have the same behavior as a user clicking in the background.

So if a user clicks on cancel we probably want to just take the user back to the stream's list page

sort of wired that up it's going be pretty straightforward.

We can either do some programmatic navigation with a click event on the cancel button or we can just

turn this cancel button into re-act router Dom link tag instead.

I think that we should probably make it that link tag because that's the real purpose of the link element.

It's supposed to show some clickable thing that the user can click on to navigate around her application.

So back inside of stream delete at the very top.

I'm going to import link from re-act router.

Damn.

Now remember get the dash bomb inside of your.

And don't forget to put in curly braces around link as well.

So now down inside of render actions instead of showing the button with the text cancel all instead

show a link.

So update both those tags and then will assign the to property and will say anyone that anytime someone

clicks on this will take them back to the root route which is our list of streams.

So now save that we can flip back over and try clicking on cancell when I click on it.

I go back to my list of streams.

Now I can click on delete and cancel back and forth and toggle the presence of that motile perfect.

So now the next thing we need to do is make sure we have the ability to delete the stream as well.

So we're going to flip back over again.

Again look at my render actions method right here and find the button with the text delete.

So in this case we do not want to make a link elmet because link is for navigation with this button

right here.

We want to make sure that any time a user clicks on this thing we call an action creator.

That's going to attempt to reach out to our API and delete that very particular stream.

Now let's very quickly flip on over to the action creators file and side of actions indexed us and just

get a quick reminder of how the delete stream action creator works sit down at the bottom of that file.

We have delete Stream right here.

Remember any time that we call delete stream we just pass in the idea the stream that we want to delete.

And that's pretty much it.

The redux side of our application will take it from there.

There is one thing we are going to have to do inside this section creator.

Remember inside of edit Stream.

And I think create stream as well.

We had eventually decided that after a user successfully deletes or creates or edits or whatever a stream

we wanted to automatically navigate them back to the root route of our application.

So we probably want to do that on delete stream as well.

Let's first make sure that we can get this action creedo work in and will out in the history push.

After that in case we need to do a little bit of trouble shooting we probably don't want to automatically

navigate back.

All right so back inside of stream delete.

I'm going to go up to the top of the file and I'm going to make sure that I add in my action creator

of delete stream then down at the very bottom of the file.

I'm going to make sure that I add an delete stream to the connect function right next to fetch Stream.

And then finally if I go back up to render actions I can find my button right here and I can add on

and on click handler so to this function I'm going to pass an arrow function I'm passing an arrow function

here because I want to be able to call delete stream with the particular ID if we just put in something

like this not Propst dot delete stream we're passing in a reference to that function which is correct.

But in this case it would not be called with the appropriate ID.

If we put in the idea right away like so then the action creator would be invoked the instant render

actions was Kalt and neither of those things is what we want.

So that's why we're using the arrow function here.

We can pass off the arrow function that allows us to only call delete stream at some point in the future

because we are passing a reference to a function off to unclick and we can also pasand the idea of the

stream that want to delete.

At that point as well.

Now this line right here that we're going to pass off to unclick is going to be a little bit long because

we want to call this dot Propst dot delete stream and we want to pass in the idea of the stream that

we want to delete.

And that's essentially the idea up there remember it's this prop's prams or match BRAMs ID so rather

than referencing that really long thing right there I think we should instead do a little bit of re-assignment

up here.

So above return's render or see above the return statement I'm going to say Konst ID is this stop prop's

match Puranas ID and then we could pass an ID much more easily like so.

So there's my ID.

Now if you wanted to we could clean up this Asuna right here with a little bit of yes 2015 so we could

actually just structure out the ID property by placing curly braces right there and then deleting dot

ID off the end.

So now it's just this prop's match prams get the ID pass the ID off to delete stream.

Ok so it looks pretty good.

Let's save this.

When I save it the button element right here is probably going to get refactored a little bit or reformatted

I suppose.

And that's what we end up with right there.

All right so now is the moment of truth.

I'm going to flip back over.

I'm going to refresh the page just to make sure I got my update.

I'm going to open up my network request log right here and then we're going to click on delete and when

we do I'm going to make sure that I see a delete request over to my API attempting to delete the stream

with ID of 3.

So I click on delete and now I see two requests right here.

The first one is options remember options is related to core's requests.

If you've ever heard about that not super important for what we are doing right now but the second request

is the delete request and it looks like it was successful.

So I got to 200.

OK in response and remember whenever we make a delete request if we are following restful conventions

which are based on API server is we get no response so we got nothing back.

Technically technically we did get response here I think it's just an empty object but the empty object

contains no properties whatsoever.

So essentially it's an empty response.

All right so now if I click on cancel right here and go back to my list of streams I no longer see the

stream on my list.

And if I refresh the page.

Yep that stream is still gone.

OK so this looks fantastic.

---
## [petre-symfony/modern-react-udemy](https://github.com/petre-symfony/modern-react-udemy)@[3ffeecc1dd...](https://github.com/petre-symfony/modern-react-udemy/commit/3ffeecc1ddd4a9fda2cc214a379d53438041e4a0)
#### Friday 2020-07-10 18:53:36 by petrero

358.3. Conditionally Showing Stream Details(Section 25: Using React Portals)

So in order to always show the modal and then just make sure that we update the content field with the

title of the stream I'm going to delete that if statements and I'm going to define another helper method

inside of your called render content so as you might guess render content is going to produce whatever

text it's a post be passed up to the content Propp of modal.

So now inside if you're all say if we do not yet have a stream loaded up then return.

Are you sure you want to get single quotes in here.

Not double.

Are you sure you want to delete this stream.

And then if we have loaded that thing up we can return.

Are you sure you want to delete the stream with title and then we can protect the title inside of your.

To print that out.

We should probably use a E.S. 20:15 template string.

So going to replace those single quotes with back to X and then after that what we say.

Are you sure you want to delete the stream title colon and then we'll do some interpellation here and

we'll say this not prop's stream title.

OK that's a really long line Salumi zoom out so you can see the entire thing.

So again render content is going to say if we do not yet have a stream just print out this kind of like

standon message and then once we actually fetch the stream put the title of the stream into the message

and zoom back in.

And now for content right here rather than just directly assigning a string we can instead place some

curly braces and then make a call to this dot render content like so.

Now last thing I want to point out here is that inside of a render method we currently have the text

stream delete.

And you'll notice that inside of our browser that text is showing up right over here in the background

which is really probably not ideal.

We just don't need to show that text at all.

So I'm going to delete that text of stream delete from the render method.

In addition we've got the wrapping div right here.

We really don't even need the wrapping div at all as well there's no point to that div because nothing

actually shows up inside of it.

Remember our modal uses a re-act portal.

So anything that gets rendered by the modal is going to go directly to the div that we had put into

our indexed HTL file the one with the ID of modal that was the entire point of that portal.

So there's really no point to having this device here at all.

So I going to delete that wrapping as well and I'm left with just returning our modal component.

All right.

I think it's time for a test here.

So going to save this and we'll flip back over it and we'll see how we're doing.

OK.

So back over here my reload kicked in right away.

And I see.

Are you sure you want to delete the stream a title.

I created this stream and so now we could click delete or cancel.

Of course clicking those don't do anything just yet but we'll wired that up in just a second just to

make sure that this works correctly.

I'm going to refresh the page and I still see the title appear right there.

You can also notice that the text can have very suddenly changes like instantaneously because when we

first render the modal to the screen we've got that initial content of.

Are you sure you want to delete the stream and then only after we fetch the thing do we add in the title

at the end.

That's why you see that kind of little blink inside there.

OK so this looks pretty good.

Now the user knows exactly what stream they are attempting to delete.

So unless we have to do is make sure that we wire up the delete and cancel buttons right here.

So let's take care of that in the next video.

---
## [tannerhelland/PhotoDemon](https://github.com/tannerhelland/PhotoDemon)@[d3fc31ca04...](https://github.com/tannerhelland/PhotoDemon/commit/d3fc31ca048942898afc970e7af7df73f528529b)
#### Friday 2020-07-10 19:21:18 by Tanner

Animated screen capture: get the "form cut-out" capture rect working

Jeez, this was a mess to make work.  My goal was simple enough - like LICEcap, I want the capture window to have a square "hole" cut out of it, which you can position over the area you want captured.  Simple, right?

No.  Never.  Not when Windows is involved.

I tried three different methods and ended up circling around all of them multiple times, as they all have trade-offs.  Making them work with VB is particularly gnarly as VB likes to take over certain windows messages and do its own thing, which requires constant intervention to make all sides happy.

I finally settled on using a transparent key color and layered windows as PD's solution of choiec.  (I'd say this is the "goldilocks" option in terms of difficulty; SetWindowRgn is what LiceCAP uses and it's easier in many ways, but it forces the window to be drawn un-themed, with a gray border filling in the system drop-shadow area.   On the other end of the spectrum, I also experimented with a full-blown 32-bpp manually rendered window, but that requires manually rendering all non-client window areas, which makes the dialog inadvertently stand out from everything else in PD.... which is just overkill.  I'd also need to make it work on every version of Windows back to XP, so nope, I had to drop it.  My preferred solution is the least of several evils, I think.)

An awful lot of subclassing and API work is required to make this behave correctly on Win 10, and I haven't actually tested other OS versions yet so I can't promise that everything works there.  (It *should* work, in theory, but there are a lot of variables at play.)

While here, I added duplicate-frame-detection to the recorder.  This is (obviously) an incredibly common event during screen captures, and it cuts down on resource usage to simply ignore duplicates when we find 'em.  Frame times are automatically adjusted for these as they occur, regardless of capture frame rate.

---
## [tannerhelland/PhotoDemon](https://github.com/tannerhelland/PhotoDemon)@[cb1fe4d4cd...](https://github.com/tannerhelland/PhotoDemon/commit/cb1fe4d4cd192eac611f829131c81ef71fc0b447)
#### Friday 2020-07-10 19:21:18 by Tanner

First pass at an animated PNG screen capture tool

I love [LICEcap](https://www.cockos.com/licecap/), the free animated GIF screen capture tool.  It makes it so easy to capture animated screen captures, without the complexity of deploying a full video streaming solution.

The downside to GIFs is, obviously, that they're limited to 256 colors per frame, and they use ancient compression technology that sometimes doesn't compress so well.  Animated PNGs don't have these restrictions, and now that they're supported everywhere (courtesy of Microsoft finally bringing [Edge](https://en.wikipedia.org/wiki/Microsoft_Edge) on board), it'd be great if someone wrote an animated PNG screen capture tool.

But what kind of idiot would be dumb enough to attempt that?

:smirk:

This first pass is just a rough proof-of-concept.  There's lots left to do.  But it works!  Mostly.

My biggest issue at present is that even libdeflate can't perform DEFLATE compression in real-time on moderate-sized captures (1024x768).  That means my only option is to cache frame data as I go, then build an actual APNG at the end, after the capture finishes.

My goal is to hit a 30 fps capture target with a single-threaded solution on my main VB6 development PC (which is ~10 years old).  The current plan is to use lz4 to dump frame data to a cache file, which should buy us good space savings with effectively no cost to performance.  When the capture ends, the tool will then "play back" those frames and optimize them into a final, well-optimized APNG file.

I also need to devise a way to display the cursor, as it is hidden by default on standard screen captures (Windows composites it separately).  I've got an idea for how to do this, c/o code in PD that already extracts and modifies system cursors on-the-fly.

---
## [PixelExperience-Devices/device_xiaomi_laurel_sprout](https://github.com/PixelExperience-Devices/device_xiaomi_laurel_sprout)@[b965f04ce4...](https://github.com/PixelExperience-Devices/device_xiaomi_laurel_sprout/commit/b965f04ce459d42ccfd0ce77dc1dc7ca565bac1c)
#### Friday 2020-07-10 21:06:50 by Kuba Wojciechowski

laurel_sprout: fuck you too, megvii

Signed-off-by: Kuba Wojciechowski <nullbytepl@gmail.com>

---
## [HachimanH20/Android_kernel_sm6125](https://github.com/HachimanH20/Android_kernel_sm6125)@[7e26f9e566...](https://github.com/HachimanH20/Android_kernel_sm6125/commit/7e26f9e56648a1175295dc9eb8bceec03bfb80da)
#### Friday 2020-07-10 21:36:56 by Christian Brauner

BACKPORT: signal: add pidfd_send_signal() syscall

The kill() syscall operates on process identifiers (pid). After a process
has exited its pid can be reused by another process. If a caller sends a
signal to a reused pid it will end up signaling the wrong process. This
issue has often surfaced and there has been a push to address this problem [1].

This patch uses file descriptors (fd) from proc/<pid> as stable handles on
struct pid. Even if a pid is recycled the handle will not change. The fd
can be used to send signals to the process it refers to.
Thus, the new syscall pidfd_send_signal() is introduced to solve this
problem. Instead of pids it operates on process fds (pidfd).

/* prototype and argument /*
long pidfd_send_signal(int pidfd, int sig, siginfo_t *info, unsigned int flags);

/* syscall number 424 */
The syscall number was chosen to be 424 to align with Arnd's rework in his
y2038 to minimize merge conflicts (cf. [25]).

In addition to the pidfd and signal argument it takes an additional
siginfo_t and flags argument. If the siginfo_t argument is NULL then
pidfd_send_signal() is equivalent to kill(<positive-pid>, <signal>). If it
is not NULL pidfd_send_signal() is equivalent to rt_sigqueueinfo().
The flags argument is added to allow for future extensions of this syscall.
It currently needs to be passed as 0. Failing to do so will cause EINVAL.

/* pidfd_send_signal() replaces multiple pid-based syscalls */
The pidfd_send_signal() syscall currently takes on the job of
rt_sigqueueinfo(2) and parts of the functionality of kill(2), Namely, when a
positive pid is passed to kill(2). It will however be possible to also
replace tgkill(2) and rt_tgsigqueueinfo(2) if this syscall is extended.

/* sending signals to threads (tid) and process groups (pgid) */
Specifically, the pidfd_send_signal() syscall does currently not operate on
process groups or threads. This is left for future extensions.
In order to extend the syscall to allow sending signal to threads and
process groups appropriately named flags (e.g. PIDFD_TYPE_PGID, and
PIDFD_TYPE_TID) should be added. This implies that the flags argument will
determine what is signaled and not the file descriptor itself. Put in other
words, grouping in this api is a property of the flags argument not a
property of the file descriptor (cf. [13]). Clarification for this has been
requested by Eric (cf. [19]).
When appropriate extensions through the flags argument are added then
pidfd_send_signal() can additionally replace the part of kill(2) which
operates on process groups as well as the tgkill(2) and
rt_tgsigqueueinfo(2) syscalls.
How such an extension could be implemented has been very roughly sketched
in [14], [15], and [16]. However, this should not be taken as a commitment
to a particular implementation. There might be better ways to do it.
Right now this is intentionally left out to keep this patchset as simple as
possible (cf. [4]).

/* naming */
The syscall had various names throughout iterations of this patchset:
- procfd_signal()
- procfd_send_signal()
- taskfd_send_signal()
In the last round of reviews it was pointed out that given that if the
flags argument decides the scope of the signal instead of different types
of fds it might make sense to either settle for "procfd_" or "pidfd_" as
prefix. The community was willing to accept either (cf. [17] and [18]).
Given that one developer expressed strong preference for the "pidfd_"
prefix (cf. [13]) and with other developers less opinionated about the name
we should settle for "pidfd_" to avoid further bikeshedding.

The  "_send_signal" suffix was chosen to reflect the fact that the syscall
takes on the job of multiple syscalls. It is therefore intentional that the
name is not reminiscent of neither kill(2) nor rt_sigqueueinfo(2). Not the
fomer because it might imply that pidfd_send_signal() is a replacement for
kill(2), and not the latter because it is a hassle to remember the correct
spelling - especially for non-native speakers - and because it is not
descriptive enough of what the syscall actually does. The name
"pidfd_send_signal" makes it very clear that its job is to send signals.

/* zombies */
Zombies can be signaled just as any other process. No special error will be
reported since a zombie state is an unreliable state (cf. [3]). However,
this can be added as an extension through the @flags argument if the need
ever arises.

/* cross-namespace signals */
The patch currently enforces that the signaler and signalee either are in
the same pid namespace or that the signaler's pid namespace is an ancestor
of the signalee's pid namespace. This is done for the sake of simplicity
and because it is unclear to what values certain members of struct
siginfo_t would need to be set to (cf. [5], [6]).

/* compat syscalls */
It became clear that we would like to avoid adding compat syscalls
(cf. [7]).  The compat syscall handling is now done in kernel/signal.c
itself by adding __copy_siginfo_from_user_generic() which lets us avoid
compat syscalls (cf. [8]). It should be noted that the addition of
__copy_siginfo_from_user_any() is caused by a bug in the original
implementation of rt_sigqueueinfo(2) (cf. 12).
With upcoming rework for syscall handling things might improve
significantly (cf. [11]) and __copy_siginfo_from_user_any() will not gain
any additional callers.

/* testing */
This patch was tested on x64 and x86.

/* userspace usage */
An asciinema recording for the basic functionality can be found under [9].
With this patch a process can be killed via:

 #define _GNU_SOURCE
 #include <errno.h>
 #include <fcntl.h>
 #include <signal.h>
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
 #include <sys/stat.h>
 #include <sys/syscall.h>
 #include <sys/types.h>
 #include <unistd.h>

 static inline int do_pidfd_send_signal(int pidfd, int sig, siginfo_t *info,
                                         unsigned int flags)
 {
 #ifdef __NR_pidfd_send_signal
         return syscall(__NR_pidfd_send_signal, pidfd, sig, info, flags);
 #else
         return -ENOSYS;
 #endif
 }

 int main(int argc, char *argv[])
 {
         int fd, ret, saved_errno, sig;

         if (argc < 3)
                 exit(EXIT_FAILURE);

         fd = open(argv[1], O_DIRECTORY | O_CLOEXEC);
         if (fd < 0) {
                 printf("%s - Failed to open \"%s\"\n", strerror(errno), argv[1]);
                 exit(EXIT_FAILURE);
         }

         sig = atoi(argv[2]);

         printf("Sending signal %d to process %s\n", sig, argv[1]);
         ret = do_pidfd_send_signal(fd, sig, NULL, 0);

         saved_errno = errno;
         close(fd);
         errno = saved_errno;

         if (ret < 0) {
                 printf("%s - Failed to send signal %d to process %s\n",
                        strerror(errno), sig, argv[1]);
                 exit(EXIT_FAILURE);
         }

         exit(EXIT_SUCCESS);
 }

/* Q&A
 * Given that it seems the same questions get asked again by people who are
 * late to the party it makes sense to add a Q&A section to the commit
 * message so it's hopefully easier to avoid duplicate threads.
 *
 * For the sake of progress please consider these arguments settled unless
 * there is a new point that desperately needs to be addressed. Please make
 * sure to check the links to the threads in this commit message whether
 * this has not already been covered.
 */
Q-01: (Florian Weimer [20], Andrew Morton [21])
      What happens when the target process has exited?
A-01: Sending the signal will fail with ESRCH (cf. [22]).

Q-02:  (Andrew Morton [21])
       Is the task_struct pinned by the fd?
A-02:  No. A reference to struct pid is kept. struct pid - as far as I
       understand - was created exactly for the reason to not require to
       pin struct task_struct (cf. [22]).

Q-03: (Andrew Morton [21])
      Does the entire procfs directory remain visible? Just one entry
      within it?
A-03: The same thing that happens right now when you hold a file descriptor
      to /proc/<pid> open (cf. [22]).

Q-04: (Andrew Morton [21])
      Does the pid remain reserved?
A-04: No. This patchset guarantees a stable handle not that pids are not
      recycled (cf. [22]).

Q-05: (Andrew Morton [21])
      Do attempts to signal that fd return errors?
A-05: See {Q,A}-01.

Q-06: (Andrew Morton [22])
      Is there a cleaner way of obtaining the fd? Another syscall perhaps.
A-06: Userspace can already trivially retrieve file descriptors from procfs
      so this is something that we will need to support anyway. Hence,
      there's no immediate need to add another syscalls just to make
      pidfd_send_signal() not dependent on the presence of procfs. However,
      adding a syscalls to get such file descriptors is planned for a
      future patchset (cf. [22]).

Q-07: (Andrew Morton [21] and others)
      This fd-for-a-process sounds like a handy thing and people may well
      think up other uses for it in the future, probably unrelated to
      signals. Are the code and the interface designed to permit such
      future applications?
A-07: Yes (cf. [22]).

Q-08: (Andrew Morton [21] and others)
      Now I think about it, why a new syscall? This thing is looking
      rather like an ioctl?
A-08: This has been extensively discussed. It was agreed that a syscall is
      preferred for a variety or reasons. Here are just a few taken from
      prior threads. Syscalls are safer than ioctl()s especially when
      signaling to fds. Processes are a core kernel concept so a syscall
      seems more appropriate. The layout of the syscall with its four
      arguments would require the addition of a custom struct for the
      ioctl() thereby causing at least the same amount or even more
      complexity for userspace than a simple syscall. The new syscall will
      replace multiple other pid-based syscalls (see description above).
      The file-descriptors-for-processes concept introduced with this
      syscall will be extended with other syscalls in the future. See also
      [22], [23] and various other threads already linked in here.

Q-09: (Florian Weimer [24])
      What happens if you use the new interface with an O_PATH descriptor?
A-09:
      pidfds opened as O_PATH fds cannot be used to send signals to a
      process (cf. [2]). Signaling processes through pidfds is the
      equivalent of writing to a file. Thus, this is not an operation that
      operates "purely at the file descriptor level" as required by the
      open(2) manpage. See also [4].

/* References */
[1]:  https://lore.kernel.org/lkml/20181029221037.87724-1-dancol@google.com/
[2]:  https://lore.kernel.org/lkml/874lbtjvtd.fsf@oldenburg2.str.redhat.com/
[3]:  https://lore.kernel.org/lkml/20181204132604.aspfupwjgjx6fhva@brauner.io/
[4]:  https://lore.kernel.org/lkml/20181203180224.fkvw4kajtbvru2ku@brauner.io/
[5]:  https://lore.kernel.org/lkml/20181121213946.GA10795@mail.hallyn.com/
[6]:  https://lore.kernel.org/lkml/20181120103111.etlqp7zop34v6nv4@brauner.io/
[7]:  https://lore.kernel.org/lkml/36323361-90BD-41AF-AB5B-EE0D7BA02C21@amacapital.net/
[8]:  https://lore.kernel.org/lkml/87tvjxp8pc.fsf@xmission.com/
[9]:  https://asciinema.org/a/IQjuCHew6bnq1cr78yuMv16cy
[11]: https://lore.kernel.org/lkml/F53D6D38-3521-4C20-9034-5AF447DF62FF@amacapital.net/
[12]: https://lore.kernel.org/lkml/87zhtjn8ck.fsf@xmission.com/
[13]: https://lore.kernel.org/lkml/871s6u9z6u.fsf@xmission.com/
[14]: https://lore.kernel.org/lkml/20181206231742.xxi4ghn24z4h2qki@brauner.io/
[15]: https://lore.kernel.org/lkml/20181207003124.GA11160@mail.hallyn.com/
[16]: https://lore.kernel.org/lkml/20181207015423.4miorx43l3qhppfz@brauner.io/
[17]: https://lore.kernel.org/lkml/CAGXu5jL8PciZAXvOvCeCU3wKUEB_dU-O3q0tDw4uB_ojMvDEew@mail.gmail.com/
[18]: https://lore.kernel.org/lkml/20181206222746.GB9224@mail.hallyn.com/
[19]: https://lore.kernel.org/lkml/20181208054059.19813-1-christian@brauner.io/
[20]: https://lore.kernel.org/lkml/8736rebl9s.fsf@oldenburg.str.redhat.com/
[21]: https://lore.kernel.org/lkml/20181228152012.dbf0508c2508138efc5f2bbe@linux-foundation.org/
[22]: https://lore.kernel.org/lkml/20181228233725.722tdfgijxcssg76@brauner.io/
[23]: https://lwn.net/Articles/773459/
[24]: https://lore.kernel.org/lkml/8736rebl9s.fsf@oldenburg.str.redhat.com/
[25]: https://lore.kernel.org/lkml/CAK8P3a0ej9NcJM8wXNPbcGUyOUZYX+VLoDFdbenW3s3114oQZw@mail.gmail.com/

Cc: "Eric W. Biederman" <ebiederm@xmission.com>
Cc: Jann Horn <jannh@google.com>
Cc: Andy Lutomirsky <luto@kernel.org>
Cc: Andrew Morton <akpm@linux-foundation.org>
Cc: Oleg Nesterov <oleg@redhat.com>
Cc: Al Viro <viro@zeniv.linux.org.uk>
Cc: Florian Weimer <fweimer@redhat.com>
Signed-off-by: Christian Brauner <christian@brauner.io>
Reviewed-by: Tycho Andersen <tycho@tycho.ws>
Reviewed-by: Kees Cook <keescook@chromium.org>
Reviewed-by: David Howells <dhowells@redhat.com>
Acked-by: Arnd Bergmann <arnd@arndb.de>
Acked-by: Thomas Gleixner <tglx@linutronix.de>
Acked-by: Serge Hallyn <serge@hallyn.com>
Acked-by: Aleksa Sarai <cyphar@cyphar.com>

(cherry picked from commit 3eb39f47934f9d5a3027fe00d906a45fe3a15fad)

Conflicts:
        arch/x86/entry/syscalls/syscall_32.tbl - trivial manual merge
        arch/x86/entry/syscalls/syscall_64.tbl - trivial manual merge
        include/linux/proc_fs.h - trivial manual merge
        include/linux/syscalls.h - trivial manual merge
        include/uapi/asm-generic/unistd.h - trivial manual merge
        kernel/signal.c - struct kernel_siginfo does not exist in 4.14
        kernel/sys_ni.c - cond_syscall is used instead of COND_SYSCALL
        arch/x86/entry/syscalls/syscall_32.tbl
        arch/x86/entry/syscalls/syscall_64.tbl

(1. manual merges because of 4.14 differences
 2. change prepare_kill_siginfo() to use struct siginfo instead of
kernel_siginfo
 3. use copy_from_user() instead of copy_siginfo_from_user() in copy_siginfo_from_user_any()
 4. replaced COND_SYSCALL with cond_syscall
 5. Removed __ia32_sys_pidfd_send_signal in arch/x86/entry/syscalls/syscall_32.tbl.
 6. Replaced __x64_sys_pidfd_send_signal with sys_pidfd_send_signal in arch/x86/entry/syscalls/syscall_64.tbl.)

Bug: 135608568
Test: test program using syscall(__NR_pidfd_send_signal,..) to send SIGKILL
Change-Id: I34da11c63ac8cafb0353d9af24c820cef519ec27
Signed-off-by: Suren Baghdasaryan <surenb@google.com>
(cherry picked from commit c8b9b2c5cca36e3bbc567a1f030ee10a795b409d)
(cherry picked from commit bc2aae56cbc3337606ffab64182cb47269961f61)
(cherry picked from commit 14ab996549cf2910bd4ecaacbed3628cfc7e5ca1)

---
## [Maetrim/DDOBuilder](https://github.com/Maetrim/DDOBuilder)@[93c1f34861...](https://github.com/Maetrim/DDOBuilder/commit/93c1f34861af9332fa0d0212d745975684e876be)
#### Friday 2020-07-10 21:38:55 by Maetrim

Build 1.0.0.105

U46 Patch 2 Changes:
---Carceri Storm level 3 bonus spell is now Creeping Cold
---The Abyss level 6 bonus spell is now Rend the Soul
---Warlock: Absolute Zero now has a DC listing
---Channel the Abyss now has a stance and effects
---All Sorcerer level 6/12 cores from Air/Earth/Fire/Cold trees now no longer grant +1 max caster level with that element
---Enlightened Spirit's Celestial Spirit is now: Major Form Toggle: When enabled, you float above the ground, gain Feather Falling, are immune to most knockdown effects, and your Eldritch Blasts gain 3d6 Light damage. Passive: Your Eldritch Aura now affects enemies every 2 seconds.
---Enlightened Spirit's Ultimate Enlightenment is now: +2 CON, +2 CHA, +20% Competence bonus to Maximum HP, +10 Universal Spellpower, +20 Light Spellpower. While your Eldritch Aura is enabled, you gain full Base Attack Bonus, +10 Melee Power, and +10 Ranged Power.
---Shroud of the Zombie has been changed to: Shroud Toggle: You shroud yourself with Negative Energy and assume many of the traits of a Zombie. While in this form, you hunger for brains and gain +4 Constitution, +10 Melee Power, 3 Physical and Magical Resistance Rating, and attack 10% slower. You have +100% critical hit resistance, are healed by Negative Energy, take 50% healing from Positive Energy, and take double damage from Light. You are considered Undead rather than your original type for the purposes of most effects.
---Ascendant Shroud has been changed to: While in Shroud of the Zombie, you gain an additional; +30 Melee Power and +10 Physical Resistance Rating, and your attacks deal +10% more damage. You also benefit from a 10% Profane Bonus to Maximum Hit Points.
---Slicing Blow has been changed to: Tactical Melee Attack: Using this attack, you deal one point of Constitution damage to your target, and deal 1 to 6 additional damage every 2 seconds for 18 seconds. The target suffers an additional 1 to 6 damage per tick for every three Character Levels. This damage scales with 100% Melee Power, and can stack up to three times. Some creatures may be immune to the bleeding or wounding effect.
---Reflection of Wave's Improved Water Elemental Form now grants 5% Exceptional Cold Spell Crit Damage instead of 20% Exceptional Cold Spell Crit Chance.
---Holy Aura is now: Allies and yourself gain +4 Sacred bonus to AC, Saves, immunity to charms/mental compulsions for 1 minute per caster level. Nearby enemies must make a fortitude save or be blinded.
Fix: Item "Legendary Scales of Malice" now correctly awards 8 Insightful Con, not 9. (Reported by Guntharm)
Fix: Incorrect values for Alchemist Orchidium reactions fixed (Reported by FullPlayer20)
New: A "Reset Layout" option in the view menu has been added (Suggested by a user in game on the HC server - sadly I forgot who)
---Note that this will not work correctly unless you delete your current DDOBuilder.ini file to pick up the new defaults that need to be present

Other Changes:
Missing Item: Baz'Morath, The Curator of Decay (Great Axe)

---
## [HachimanH20/Android_kernel_sm6125](https://github.com/HachimanH20/Android_kernel_sm6125)@[e20d7b3aed...](https://github.com/HachimanH20/Android_kernel_sm6125/commit/e20d7b3aed45fef1b4d7f104020750655b9f9599)
#### Friday 2020-07-10 23:23:42 by Andrey Konovalov

UPSTREAM: kasan, mm: change hooks signatures

Upstream commit 0116523cfffa62aeb5aa3b85ce7419f3dae0c1b8.

Patch series "kasan: add software tag-based mode for arm64", v13.

This patchset adds a new software tag-based mode to KASAN [1].  (Initially
this mode was called KHWASAN, but it got renamed, see the naming rationale
at the end of this section).

The plan is to implement HWASan [2] for the kernel with the incentive,
that it's going to have comparable to KASAN performance, but in the same
time consume much less memory, trading that off for somewhat imprecise bug
detection and being supported only for arm64.

The underlying ideas of the approach used by software tag-based KASAN are:

1. By using the Top Byte Ignore (TBI) arm64 CPU feature, we can store
   pointer tags in the top byte of each kernel pointer.

2. Using shadow memory, we can store memory tags for each chunk of kernel
   memory.

3. On each memory allocation, we can generate a random tag, embed it into
   the returned pointer and set the memory tags that correspond to this
   chunk of memory to the same value.

4. By using compiler instrumentation, before each memory access we can add
   a check that the pointer tag matches the tag of the memory that is being
   accessed.

5. On a tag mismatch we report an error.

With this patchset the existing KASAN mode gets renamed to generic KASAN,
with the word "generic" meaning that the implementation can be supported
by any architecture as it is purely software.

The new mode this patchset adds is called software tag-based KASAN.  The
word "tag-based" refers to the fact that this mode uses tags embedded into
the top byte of kernel pointers and the TBI arm64 CPU feature that allows
to dereference such pointers.  The word "software" here means that shadow
memory manipulation and tag checking on pointer dereference is done in
software.  As it is the only tag-based implementation right now, "software
tag-based" KASAN is sometimes referred to as simply "tag-based" in this
patchset.

A potential expansion of this mode is a hardware tag-based mode, which
would use hardware memory tagging support (announced by Arm [3]) instead
of compiler instrumentation and manual shadow memory manipulation.

Same as generic KASAN, software tag-based KASAN is strictly a debugging
feature.

[1] https://www.kernel.org/doc/html/latest/dev-tools/kasan.html

[2] http://clang.llvm.org/docs/HardwareAssistedAddressSanitizerDesign.html

[3] https://community.arm.com/processors/b/blog/posts/arm-a-profile-architecture-2018-developments-armv85a

====== Rationale

On mobile devices generic KASAN's memory usage is significant problem.
One of the main reasons to have tag-based KASAN is to be able to perform a
similar set of checks as the generic one does, but with lower memory
requirements.

Comment from Vishwath Mohan <vishwath@google.com>:

I don't have data on-hand, but anecdotally both ASAN and KASAN have proven
problematic to enable for environments that don't tolerate the increased
memory pressure well.  This includes

(a) Low-memory form factors - Wear, TV, Things, lower-tier phones like Go,
(c) Connected components like Pixel's visual core [1].

These are both places I'd love to have a low(er) memory footprint option at
my disposal.

Comment from Evgenii Stepanov <eugenis@google.com>:

Looking at a live Android device under load, slab (according to
/proc/meminfo) + kernel stack take 8-10% available RAM (~350MB).  KASAN's
overhead of 2x - 3x on top of it is not insignificant.

Not having this overhead enables near-production use - ex.  running
KASAN/KHWASAN kernel on a personal, daily-use device to catch bugs that do
not reproduce in test configuration.  These are the ones that often cost
the most engineering time to track down.

CPU overhead is bad, but generally tolerable.  RAM is critical, in our
experience.  Once it gets low enough, OOM-killer makes your life
miserable.

[1] https://www.blog.google/products/pixel/pixel-visual-core-image-processing-and-machine-learning-pixel-2/

====== Technical details

Software tag-based KASAN mode is implemented in a very similar way to the
generic one. This patchset essentially does the following:

1. TCR_TBI1 is set to enable Top Byte Ignore.

2. Shadow memory is used (with a different scale, 1:16, so each shadow
   byte corresponds to 16 bytes of kernel memory) to store memory tags.

3. All slab objects are aligned to shadow scale, which is 16 bytes.

4. All pointers returned from the slab allocator are tagged with a random
   tag and the corresponding shadow memory is poisoned with the same value.

5. Compiler instrumentation is used to insert tag checks. Either by
   calling callbacks or by inlining them (CONFIG_KASAN_OUTLINE and
   CONFIG_KASAN_INLINE flags are reused).

6. When a tag mismatch is detected in callback instrumentation mode
   KASAN simply prints a bug report. In case of inline instrumentation,
   clang inserts a brk instruction, and KASAN has it's own brk handler,
   which reports the bug.

7. The memory in between slab objects is marked with a reserved tag, and
   acts as a redzone.

8. When a slab object is freed it's marked with a reserved tag.

Bug detection is imprecise for two reasons:

1. We won't catch some small out-of-bounds accesses, that fall into the
   same shadow cell, as the last byte of a slab object.

2. We only have 1 byte to store tags, which means we have a 1/256
   probability of a tag match for an incorrect access (actually even
   slightly less due to reserved tag values).

Despite that there's a particular type of bugs that tag-based KASAN can
detect compared to generic KASAN: use-after-free after the object has been
allocated by someone else.

====== Testing

Some kernel developers voiced a concern that changing the top byte of
kernel pointers may lead to subtle bugs that are difficult to discover.
To address this concern deliberate testing has been performed.

It doesn't seem feasible to do some kind of static checking to find
potential issues with pointer tagging, so a dynamic approach was taken.
All pointer comparisons/subtractions have been instrumented in an LLVM
compiler pass and a kernel module that would print a bug report whenever
two pointers with different tags are being compared/subtracted (ignoring
comparisons with NULL pointers and with pointers obtained by casting an
error code to a pointer type) has been used.  Then the kernel has been
booted in QEMU and on an Odroid C2 board and syzkaller has been run.

This yielded the following results.

The two places that look interesting are:

is_vmalloc_addr in include/linux/mm.h
is_kernel_rodata in mm/util.c

Here we compare a pointer with some fixed untagged values to make sure
that the pointer lies in a particular part of the kernel address space.
Since tag-based KASAN doesn't add tags to pointers that belong to rodata
or vmalloc regions, this should work as is.  To make sure debug checks to
those two functions that check that the result doesn't change whether we
operate on pointers with or without untagging has been added.

A few other cases that don't look that interesting:

Comparing pointers to achieve unique sorting order of pointee objects
(e.g. sorting locks addresses before performing a double lock):

tty_ldisc_lock_pair_timeout in drivers/tty/tty_ldisc.c
pipe_double_lock in fs/pipe.c
unix_state_double_lock in net/unix/af_unix.c
lock_two_nondirectories in fs/inode.c
mutex_lock_double in kernel/events/core.c

ep_cmp_ffd in fs/eventpoll.c
fsnotify_compare_groups fs/notify/mark.c

Nothing needs to be done here, since the tags embedded into pointers
don't change, so the sorting order would still be unique.

Checks that a pointer belongs to some particular allocation:

is_sibling_entry in lib/radix-tree.c
object_is_on_stack in include/linux/sched/task_stack.h

Nothing needs to be done here either, since two pointers can only belong
to the same allocation if they have the same tag.

Overall, since the kernel boots and works, there are no critical bugs.
As for the rest, the traditional kernel testing way (use until fails) is
the only one that looks feasible.

Another point here is that tag-based KASAN is available under a separate
config option that needs to be deliberately enabled. Even though it might
be used in a "near-production" environment to find bugs that are not found
during fuzzing or running tests, it is still a debug tool.

====== Benchmarks

The following numbers were collected on Odroid C2 board. Both generic and
tag-based KASAN were used in inline instrumentation mode.

Boot time [1]:
* ~1.7 sec for clean kernel
* ~5.0 sec for generic KASAN
* ~5.0 sec for tag-based KASAN

Network performance [2]:
* 8.33 Gbits/sec for clean kernel
* 3.17 Gbits/sec for generic KASAN
* 2.85 Gbits/sec for tag-based KASAN

Slab memory usage after boot [3]:
* ~40 kb for clean kernel
* ~105 kb (~260% overhead) for generic KASAN
* ~47 kb (~20% overhead) for tag-based KASAN

KASAN memory overhead consists of three main parts:
1. Increased slab memory usage due to redzones.
2. Shadow memory (the whole reserved once during boot).
3. Quaratine (grows gradually until some preset limit; the more the limit,
   the more the chance to detect a use-after-free).

Comparing tag-based vs generic KASAN for each of these points:
1. 20% vs 260% overhead.
2. 1/16th vs 1/8th of physical memory.
3. Tag-based KASAN doesn't require quarantine.

[1] Time before the ext4 driver is initialized.
[2] Measured as `iperf -s & iperf -c 127.0.0.1 -t 30`.
[3] Measured as `cat /proc/meminfo | grep Slab`.

====== Some notes

A few notes:

1. The patchset can be found here:
   https://github.com/xairy/kasan-prototype/tree/khwasan

2. Building requires a recent Clang version (7.0.0 or later).

3. Stack instrumentation is not supported yet and will be added later.

This patch (of 25):

Tag-based KASAN changes the value of the top byte of pointers returned
from the kernel allocation functions (such as kmalloc).  This patch
updates KASAN hooks signatures and their usage in SLAB and SLUB code to
reflect that.

Link: http://lkml.kernel.org/r/aec2b5e3973781ff8a6bb6760f8543643202c451.1544099024.git.andreyknvl@google.com
Signed-off-by: Andrey Konovalov <andreyknvl@google.com>
Reviewed-by: Andrey Ryabinin <aryabinin@virtuozzo.com>
Reviewed-by: Dmitry Vyukov <dvyukov@google.com>
Cc: Christoph Lameter <cl@linux.com>
Cc: Mark Rutland <mark.rutland@arm.com>
Cc: Will Deacon <will.deacon@arm.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Andrey Konovalov <andreyknvl@google.com>
Change-Id: Iefef37d9c54869df0873af75345262a24150ee80
Bug: 128674696
(cherry picked from commit 30847271f792610fba9ecb6ebe5cefdf1e2aa1a8)
(cherry picked from commit aabcfcee09bde8df23e9aea4f8fa0778598b19b1)
(cherry picked from commit cf04cd1597424f9db4401991829261b1abe6b657)

---
## [biosharp18/fivespot](https://github.com/biosharp18/fivespot)@[dd827c1c9e...](https://github.com/biosharp18/fivespot/commit/dd827c1c9e0da1a1c7d26e22256c6075db99a344)
#### Friday 2020-07-10 23:32:13 by biosharp18

Merge branch 'master' of https://github.com/biosharp18/fivespot

fuck you

---
## [HachimanH20/Android_kernel_sm6125](https://github.com/HachimanH20/Android_kernel_sm6125)@[21962352a1...](https://github.com/HachimanH20/Android_kernel_sm6125/commit/21962352a1058076d00746ee8cbed7a9e7548973)
#### Friday 2020-07-10 23:49:52 by Alexander Potapenko

BACKPORT: mm: security: introduce init_on_alloc=1 and init_on_free=1 boot options

Upstream commit 6471384af2a6530696fc0203bafe4de41a23c9ef.

Patch series "add init_on_alloc/init_on_free boot options", v10.

Provide init_on_alloc and init_on_free boot options.

These are aimed at preventing possible information leaks and making the
control-flow bugs that depend on uninitialized values more deterministic.

Enabling either of the options guarantees that the memory returned by the
page allocator and SL[AU]B is initialized with zeroes.  SLOB allocator
isn't supported at the moment, as its emulation of kmem caches complicates
handling of SLAB_TYPESAFE_BY_RCU caches correctly.

Enabling init_on_free also guarantees that pages and heap objects are
initialized right after they're freed, so it won't be possible to access
stale data by using a dangling pointer.

As suggested by Michal Hocko, right now we don't let the heap users to
disable initialization for certain allocations.  There's not enough
evidence that doing so can speed up real-life cases, and introducing ways
to opt-out may result in things going out of control.

This patch (of 2):

The new options are needed to prevent possible information leaks and make
control-flow bugs that depend on uninitialized values more deterministic.

This is expected to be on-by-default on Android and Chrome OS.  And it
gives the opportunity for anyone else to use it under distros too via the
boot args.  (The init_on_free feature is regularly requested by folks
where memory forensics is included in their threat models.)

init_on_alloc=1 makes the kernel initialize newly allocated pages and heap
objects with zeroes.  Initialization is done at allocation time at the
places where checks for __GFP_ZERO are performed.

init_on_free=1 makes the kernel initialize freed pages and heap objects
with zeroes upon their deletion.  This helps to ensure sensitive data
doesn't leak via use-after-free accesses.

Both init_on_alloc=1 and init_on_free=1 guarantee that the allocator
returns zeroed memory.  The two exceptions are slab caches with
constructors and SLAB_TYPESAFE_BY_RCU flag.  Those are never
zero-initialized to preserve their semantics.

Both init_on_alloc and init_on_free default to zero, but those defaults
can be overridden with CONFIG_INIT_ON_ALLOC_DEFAULT_ON and
CONFIG_INIT_ON_FREE_DEFAULT_ON.

If either SLUB poisoning or page poisoning is enabled, those options take
precedence over init_on_alloc and init_on_free: initialization is only
applied to unpoisoned allocations.

Slowdown for the new features compared to init_on_free=0, init_on_alloc=0:

hackbench, init_on_free=1:  +7.62% sys time (st.err 0.74%)
hackbench, init_on_alloc=1: +7.75% sys time (st.err 2.14%)

Linux build with -j12, init_on_free=1:  +8.38% wall time (st.err 0.39%)
Linux build with -j12, init_on_free=1:  +24.42% sys time (st.err 0.52%)
Linux build with -j12, init_on_alloc=1: -0.13% wall time (st.err 0.42%)
Linux build with -j12, init_on_alloc=1: +0.57% sys time (st.err 0.40%)

The slowdown for init_on_free=0, init_on_alloc=0 compared to the baseline
is within the standard error.

The new features are also going to pave the way for hardware memory
tagging (e.g.  arm64's MTE), which will require both on_alloc and on_free
hooks to set the tags for heap objects.  With MTE, tagging will have the
same cost as memory initialization.

Although init_on_free is rather costly, there are paranoid use-cases where
in-memory data lifetime is desired to be minimized.  There are various
arguments for/against the realism of the associated threat models, but
given that we'll need the infrastructure for MTE anyway, and there are
people who want wipe-on-free behavior no matter what the performance cost,
it seems reasonable to include it in this series.

[glider@google.com: v8]
  Link: http://lkml.kernel.org/r/20190626121943.131390-2-glider@google.com
[glider@google.com: v9]
  Link: http://lkml.kernel.org/r/20190627130316.254309-2-glider@google.com
[glider@google.com: v10]
  Link: http://lkml.kernel.org/r/20190628093131.199499-2-glider@google.com
Link: http://lkml.kernel.org/r/20190617151050.92663-2-glider@google.com
Signed-off-by: Alexander Potapenko <glider@google.com>
Acked-by: Kees Cook <keescook@chromium.org>
Acked-by: Michal Hocko <mhocko@suse.cz>		[page and dmapool parts
Acked-by: James Morris <jamorris@linux.microsoft.com>]
Cc: Christoph Lameter <cl@linux.com>
Cc: Masahiro Yamada <yamada.masahiro@socionext.com>
Cc: "Serge E. Hallyn" <serge@hallyn.com>
Cc: Nick Desaulniers <ndesaulniers@google.com>
Cc: Kostya Serebryany <kcc@google.com>
Cc: Dmitry Vyukov <dvyukov@google.com>
Cc: Sandeep Patil <sspatil@android.com>
Cc: Laura Abbott <labbott@redhat.com>
Cc: Randy Dunlap <rdunlap@infradead.org>
Cc: Jann Horn <jannh@google.com>
Cc: Mark Rutland <mark.rutland@arm.com>
Cc: Marco Elver <elver@google.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>

Removed the drivers/infiniband/core/uverbs_ioctl.c part, which is not in
android-common 4.14 kernel.

Change-Id: I6b5482fcafae89615e1d79879191fb6ce50d56cf
Bug: 138435492
Test: Boot cuttlefish with and without
Test:   CONFIG_INIT_ON_ALLOC_DEFAULT_ON/CONFIG_INIT_ON_FREE_DEFAULT_ON
Test: Boot an ARM64 mobile device with and without
Test:   CONFIG_INIT_ON_ALLOC_DEFAULT_ON/CONFIG_INIT_ON_FREE_DEFAULT_ON
Signed-off-by: Alexander Potapenko <glider@google.com>
(cherry picked from commit 8a4e1fcd4b5899935bf2375e7f23af39b95aaede)
(cherry picked from commit d995564220bfeb91ca6fcfe0cb1a769bc89a918a)
(cherry picked from commit ac7d8fe375d0b940f43e6b39f0415de509ae48f3)

---

# [<](2020-07-09.md) 2020-07-10 [>](2020-07-11.md)

