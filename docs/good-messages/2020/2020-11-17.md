# [<](2020-11-16.md) 2020-11-17 [>](2020-11-18.md)

3,047,778 events, 1,585,990 push events, 2,438,374 commit messages, 177,646,239 characters


## [pdiot/Slippi-Electron](https://github.com/pdiot/Slippi-Electron)@[c45910492c...](https://github.com/pdiot/Slippi-Electron/commit/c45910492c111fc28d28268b82a5f096c8e2c798)
#### Tuesday 2020-11-17 02:22:44 by Pierre Diot

First app tour commits, fuck this shit I hate it + some 4k support I guess

---
## [TheMapleTree02/Red-Liberty](https://github.com/TheMapleTree02/Red-Liberty)@[3455e62722...](https://github.com/TheMapleTree02/Red-Liberty/commit/3455e62722d0fd524643920f7b234bfcfc10c26b)
#### Tuesday 2020-11-17 03:21:37 by Alexander

Life is hell, living is pain

Please end my suffering

---
## [esmero/format_strawberryfield](https://github.com/esmero/format_strawberryfield)@[5bb4120b24...](https://github.com/esmero/format_strawberryfield/commit/5bb4120b245bbfbf4f26d016c460121aa1ab6d1f)
#### Tuesday 2020-11-17 04:43:29 by Diego Pino Navarro

Adds streaming capabilities on request

Normal deliver:
http://localhost:8001/do/2009/iiif/ba116b5f-9c1a-4f17-9b0b-7e3279cce6fb/full/full/0/esmero_test_video_by_diego.m4v

Streamed Deliver:
http://localhost:8001/do/2009/iiif/ba116b5f-9c1a-4f17-9b0b-7e3279cce6fb/full/full/0/esmero_test_video_by_diego.m4v?stream=true
(see the stream = true)

Also adds etags (weak because of GZIP compression and a lot of long explanations bla bla here https://stackoverflow.com/questions/40456346/nginx-not-taking-etag-into-account)

Also kids:
Did you know that if you request a
curl -vi someurl -o theoutputofthefile.binary the god damn headers get attached to the binary??????
Took me 1 hour of debugging and a vbindiff operation with an hexdec editor to find it out... gosh.. gosh.. who codes this stuff??

---
## [BZZ-2020/m403](https://github.com/BZZ-2020/m403)@[101142650e...](https://github.com/BZZ-2020/m403/commit/101142650e6922724dcc19ac0b1a76bfe628a21b)
#### Tuesday 2020-11-17 07:00:00 by Tim Irmler - Laptop

renamed every class so that the first letter is capital... or however the fuck you describe that

---
## [akeeba/releasemaker](https://github.com/akeeba/releasemaker)@[d5989b2b60...](https://github.com/akeeba/releasemaker/commit/d5989b2b60156d2d4e5ad066227df4088596f99a)
#### Tuesday 2020-11-17 07:09:04 by Nicholas K. Dionysopoulos

Send X-FOF-Token header on top of Authorization

I am having a massive what the actual fuck moment with macOS Big
Sur. Sending only the Authorization header results in a 403 from
the remote server and only when the server is not on my
localhost. Trying the same thing on Linux against the same live
server works fine. Using the X-FOF-Token header works on both
macOS Big Sur _and_ Linux.

I would think that maybe PHP is somehow compiled differently and
magically causes the Authorization header to be dropped. However,
this machine was upgraded from macOS Catalina, the PHP version
and its configuration remained intact on upgrade. Yet, the
Authorization header seems to magically disappear or have no
effect.

WHAT. THE. ACTUAL. FUCK!

---
## [CherishOS/android_packages_apps_Launcher3](https://github.com/CherishOS/android_packages_apps_Launcher3)@[8af42dca55...](https://github.com/CherishOS/android_packages_apps_Launcher3/commit/8af42dca5544c68c36c3514fd74b5f220b8aefec)
#### Tuesday 2020-11-17 08:58:15 by Alex Cruz

Restart with change only on exit

This change allow the user to change everything they have to inside the
homescreen activity and only restart on exit. Previously this was a pain
in the fucking ass because you had to go in and set each option one by one
with a restart inbetween. At least now is not that big of a pain.

- Restart on destroy (hitting the back button, actionbar arrow)
- Restart when a chance is made and the home button is pressed

** Thanks "Jack" for code to detect home button
https://stackoverflow.com/a/27956263

- Cleaned up restart code

@eyosen adapted to 10

Change-Id: I4962916ae0bd59d08247b59de585a97a2b9da3a1
Signed-off-by: DennySPb <dennyspb@gmail.com>
Signed-off-by: Hưng Phan <phandinhhungvp2001@gmail.com>

---
## [olive-editor/olive](https://github.com/olive-editor/olive)@[75d4cd899b...](https://github.com/olive-editor/olive/commit/75d4cd899bb27a916261fd1cbdedd532b0337678)
#### Tuesday 2020-11-17 09:25:07 by itsmattkc

use hardcoded namespace

The macro defined namespaces confused the hell out of lupdate and more or less broke translations permanently. Looks like the only way we can do it is to have a hardcoded namespace, which goes against my instinct, but honestly how likely is it that we'll change the namespace anyway (I guess forks might want to do it, but that's their problem ;) )

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[aef7c4b0a2...](https://github.com/mrakgr/The-Spiral-Language/commit/aef7c4b0a2c98b9ec3cb94eb173797cc97768781)
#### Tuesday 2020-11-17 10:18:30 by Marko Grdinić

"9:15am. I am really so conflicted about BG1. I tried playing with a party just as I said I would and tried a straighforward playstyle, but this was the first time ever in a game that I've though - wow, why am I hanging out with those useless morons? They keep getting killed when my attention slips and are so hard to control. They are a drain on the most important resource of all - my exp, and the short term benefit I get from being in a group is more than offset by being under leveled in the medium and long term.

Somehow this strikes a chord in how I've lived my life in the real world.

The assassin solo playstyle using a wizard is just so effective. I am really quite conflicted over this.

9:25am. Let me chill for a while and then I will start.

9:50am. Let me start.

All in all, compared to some of the other things I could be thinking about, obsessing about the right way to play BG is not too bad.

```fs
| Some(Ok p) -> (x,{links=failwith "TODO"; files=failwith "TODO"}) :: adds, removes
```

Now I have to deal with these two TODOs.

```fs
        match Map.tryFind x schema with
        | Some(Ok p) ->
            let names = p.schema.packages |> List.map (snd >> fun x -> {|name=x|})
            let links = failwith "TODO"
            (x,{links=Map(List.zip links names); files=failwith "TODO"}) :: adds, removes
```

I have problem. How exactly am I going to do the package `links`? The mirrored graph has them, but as a set! I can't zip those with names.

```fs
        | Some(Ok p) ->
            let names = p.schema.packages |> List.map (snd >> fun x -> {|name=x|})
            let links = p.schema.schema.packages |> List.map (snd >> fun x -> DirectoryInfo(Path.Combine(dir,x)).FullName)
            (dir,{links=Map(List.zip links names); files=failwith "TODO"}) :: adds, removes
```

Yeah, this is hacky, but I do not want to spend time going back to the config parser and doing who knows what.

```fs
    let packages =
        let packages = HashSet()
        let validate_package d (r,x) =
            try let x = DirectoryInfo(Path.Combine(d,x)).FullName
                if project_dir = x then errors.Add(r,"Self references are not allowed."); None
                // The validator needs the backwards links even for files that are currently missing, but might exist.
                elif packages.Add(x) then Some(r, x)
                else errors.Add(r,"Duplicates are not allowed."); None
            with e -> errors.Add(r, e.Message); None
```

Hmmm, am I not tacking `file:///` onto this?

I though I was, in that case I can in fact use the packages field.

```fs
    let errors = order |> Array.choose (fun dir ->
        match Map.tryFind dir schemas with
        | Some(Ok x) -> Some {|uri=spiproj_link dir; errors=List.append x.schema.errors x.package_errors|}
        | _ -> None
        )
```

Ah, I am adding the wrapping information here.

This is great. I do have everything I need in the schema.

```fs
        | Some(Ok p) ->
            let names = p.schema.schema.packages
            let links = p.schema.packages
            (dir,{links=Map(List.map2 (fun (_,a) (_,b) -> a, {|name=b|}) links names); files=failwith "TODO"}) :: adds, removes
```

I have two different packages field. The first one is the parsed one that I can use as names. The second one is the full directory which should serve as path.

10:10am. Focus me. Let me turn off the router.

I need to do the file hierarchy next.

10:15am. Had to take a short break. Let I am going to have to add an extra field to the loaded schema...or I supposed I could just combine the paths.

```fs
{schema=x; packages=packages; links=Seq.toList links; actions=Seq.toList actions; errors=Seq.toList errors; moduleDir=moduleDir}
```

Combining paths is too complicated. Let me add an extra field.

10:25am.

```fs
            let path name =
                match p.schema.schema.moduleDir with
                | Some(_,module_dir) -> DirectoryInfo(Path.Combine(dir,module_dir,name)).FullName
                | None -> DirectoryInfo(Path.Combine(dir,name)).FullName
```

No, the extra field would not work.

...No this is not right either.

Let me go back to schema validation. I will change how the file hierarchy is structured.

```fs
type FileHierarchy =
    | File of path: string * name: string * meta: MultiFileOutState option * ParserRes Promise * tc: TypecheckerStream option
    | Directory of name: string * FileHierarchy list
```

I'll take this and make the `meta: MultiFileOutState option * ParserRes Promise * tc: TypecheckerStream option` a generic.

...Actually, let me just have two different types.

```fs
type ValidatedFileHierarchy =
    | File of path: string * name: string
    | Directory of name: string * FileHierarchy list

type ValidatedSchema = {
    schema : Schema
    packages : RString list
    links : RString list
    actions : RAction list
    errors : RString list
    files : ValidatedFileHierarchy list
    }
```

Let me do this.

10:45am.

```fs
    let files =
        if 0 = errors.Count then
            let rec validate_file prefix = function
                | FileHierarchy.File(r',(r,a),is_top_down,_) ->
                    try let x = FileInfo(Path.Combine(prefix,a + (if is_top_down then ".spi" else ".spir")))
                        if x.Exists then
                            links.Add (r, "file:///" + x.FullName)
                            actions.Add (r, RenameFile {|filePath=x.FullName; target=null|})
                            actions.Add (r, DeleteFile {|range=r'; filePath=x.FullName|})
                        else
                            errors.Add (r, "File does not exist.")
                            actions.Add (r, CreateFile {|filePath=x.FullName|})
                        Some(File(x.FullName,a))
                    with e -> errors.Add (r, e.Message); None
                | FileHierarchy.Directory(r',(r,a),b) ->
                    try let x = DirectoryInfo(Path.Combine(prefix,a))
                        let p = Path.Combine(x.FullName,"package.spiproj")
                        let l =
                            if File.Exists(p) then
                                errors.Add(r, "This directory belongs to a different project.")
                                links.Add(r, "file:///" + p)
                                []
                            elif x.Exists then
                                actions.Add(r, RenameDirectory {|dirPath=x.FullName; target=null; validate_as_file=true|})
                                actions.Add(r, DeleteDirectory {|dirPath=x.FullName; range=r'|})
                                List.choose(validate_file x.FullName) b
                            else
                                errors.Add(r, "Directory does not exist.")
                                actions.Add(r, CreateDirectory {|dirPath=x.FullName|})
                                []
                        Some(Directory(x.FullName,l))
                    with e -> errors.Add (r, e.Message); None
            List.choose (validate_file moduleDir) x.modules
        else
            []
```

Refactored this. Now I have the proper basis to do the file hierarchy.

W,wait. The directory here should not be a path.

```fs
Some(Directory(a,l))
```

I just need it to be a name.

Now that I have this new field, making the FileHierarchy the that all_file stream needs will be a lot easier.

10:45am. Focus me. Let me just do this. It is time to finish this.

10:50am.

```fs
        match Map.tryFind dir schema with
        | Some(Ok p) ->
            let names = p.schema.schema.packages
            let links = p.schema.packages
            let files =
                let rec elem = function
                    | ValidatedFileHierarchy.File(a,b) -> File(a,b,None,parsers.[a],None)
                    | ValidatedFileHierarchy.Directory(a,b) -> Directory(a,list b)
                and list l = List.map elem l
                list p.schema.files
            (dir,{links=Map(List.map2 (fun (_,a) (_,b) -> a, {|name=b|}) links names); files=files}) :: adds, removes
```

10:55am. Focus me. As soon as I finish a step I go far out of tune.

```fs
            let names = p.schema.schema.packages // TODO: Extend the parser for packages and separate out the names and locations.
            let links = p.schema.packages
```

I am not really comfortable with this part, but what I am suggesting won't be hard to do later. It is not worth attending to at the moment though.

11:05am. Nothing comes to mind.

I guess I am done.

The `package_diff` stream is complete.

Right now I am just standing in a daze here, and my mind keeps wandering to the wizard game.

I need to ask myself - what is the next step?

11:10am. Now that I've come this far, I think it is time to start bringing it all together.

11:15am. It is time to do the true editor support for Spiral. That is what I am going to aim for next - the full eager server.

Once I master that, I can move to the actual build - the prepass, the peval and codegen.

...I feel strange. It does not really feel like I've really completed all the Spiral streams, and yet that is the factual truth. My mind is scattered, but maybe once I start writing actual Spiral code and seeing it all work, my focus will come back to me.

Let me have breakfast here. I've earned it."

---
## [crazazy/nixos-config](https://github.com/crazazy/nixos-config)@[ce59e449cf...](https://github.com/crazazy/nixos-config/commit/ce59e449cf130ec63aba9bf230fba02bdd7730e8)
#### Tuesday 2020-11-17 11:09:59 by Erik Oosting

Update update.yml

fuck you github actions like keep your API consistent for once

---
## [Ovab/HTML-CSS](https://github.com/Ovab/HTML-CSS)@[772117e9b5...](https://github.com/Ovab/HTML-CSS/commit/772117e9b5c7147c0be429a571ed37168e4c5c23)
#### Tuesday 2020-11-17 13:04:13 by Ovab

Finished Butron form

It was a real pain in the arse because my form fucked things up so I had to do stuff to fix shit

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[e9dde78411...](https://github.com/mrakgr/The-Spiral-Language/commit/e9dde784117ea050d6e8ab674c7d9c27aa7e1a55)
#### Tuesday 2020-11-17 14:18:21 by Marko Grdinić

"12:25pm. Done with breakfast. Before I can resume programming I have chores to do. They'll take a while today.

Let me watch the latest ep of Elaina and then I'll get to it.

12:55pm. Time to get moving. First come the chores.

1:40pm. Done with chores. I need to cool for a bit.

2pm. Ok, enough. Let me start. I've just been reading the Spell Revisions instead of thinking about the servers.

I need to get going. Let me specifically focus on the next step.

2:05pm. My mind might have been broken lately, but I am going to finish Spiral even if it kills me. Even if I died, I'd rise as a zombie in order to get this out the door.

2:10pm. Ok, ok...

```fs
let all_file_server tokenizer_errors parser_errors type_errors req =
    let dict = Dictionary()
    let file_server' uri =
        match dict.TryGetValue(uri) with
        | true, v -> false, v
        | false, _ ->
            let x = {|req=Ch(); req_token_range=Ch(); req_hover_at=Ch()|}
            Hopac.start (file_server tokenizer_errors parser_errors type_errors uri x.req x.req_token_range x.req_hover_at)
            dict.[uri] <- x
            true, x
    let file_server uri = file_server' uri |> snd
    let loop = req >>= function
        | FileOpen x ->
            let is_new, s = file_server' x.uri
            if is_new then s.req *<+ DocumentAll(x.spiText)
            else Job.unit()
        | FileChanged x ->
            let s = file_server x.uri
            s.req *<+ DocumentEdit(x.spiEdit)
        | FileTokenRange(x, res) ->
            let s = file_server x.uri
            s.req_token_range *<+ (x.range, res)
        | HoverAt(x,res) ->
            let s = file_server x.uri
            s.req_hover_at *<+ (x.pos, res)
    Job.forever loop
```

So here this. Let me put up the file server.

```fs
let file_server tokenizer_errors parser_errors type_errors (uri : string) req req_token_range req_hover_at =
    let cancel (s : FileState) = IVar.fill s.cancellation_start () >>=. s.cancellation_done
    let loop s =
        req >>= fun x ->
        let rec try_more x = Ch.Try.take req >>= function
            | Some x -> try_more (s.tokenizer.Run(x))
            | None -> Job.result x
        try_more (s.tokenizer.Run(x)) >>= fun (r_tok,tok) ->
        cancel s >>= fun () ->
        let r_par,par = s.parser.Run(r_tok)
        let r_typ,typ = s.typechecker.Run(r_par)
        let canc = IVar()
        Promise.start (Job.conIgnore [
            Src.value tokenizer_errors {|uri=uri; errors=r_tok.errors|}
            r_par >>= fun r_par -> Src.value parser_errors {|uri=uri; errors=r_par.parser_errors|}
            handle_token_range r_par canc req_token_range
            handle_typ uri type_errors r_typ canc
            handle_hover_at r_typ canc req_hover_at
            ]) >>- fun canc_done ->
        { tokenizer=tok; parser=par; typechecker=typ; cancellation_start=canc; cancellation_done=canc_done }
    Job.iterateServer {
        tokenizer=tokenizer
        parser=parser (System.IO.Path.GetExtension(uri) = ".spi")
        typechecker=typechecker 0 0 (Promise(Infer.top_env_default))
        cancellation_start=IVar()
        cancellation_done=Promise(())
        } loop
```

Uagh...

One more...

```fs
let supervisor_server fatal_errors package_errors req =
    let m = ref {schemas=Map.empty; links=mirrored_graph_empty; loads=Map.empty}
    let change is_open dir text = change is_open !m dir text >>= fun (ers,m') -> m := m'; Array.iterJob (Src.value package_errors) ers

    let loop = req >>= function
        | ProjectFileOpen x -> change true (dir x.uri) (Some x.spiprojText)
        | ProjectFileChange x -> change false (dir x.uri) (Some x.spiprojText)
        | ProjectFileDelete x -> change false (dir x.uri) None
        | ProjectFileLinks(x,res) ->
            match m.contents.schemas.[dir x.uri] with
            | Ok x -> IVar.fill res (List.append x.schema.links x.package_links)
            | Error _ -> IVar.fill res []
        | ProjectCodeActions(x,res) ->
            match m.contents.schemas.[dir x.uri] with
            | Ok x -> IVar.fill res x.schema.actions
            | Error _ -> IVar.fill res []
        | ProjectCodeActionExecute x ->
            match code_action_execute x.action with
            | Some er -> Src.value fatal_errors er
            | None -> Job.unit()

    Job.foreverServer loop
```

Gahhhhh...

Now I have to do all this from bottom up and I have to think how I am going to put all of these together.

2:20pm. Before I do anything else, let me just try running this thing so I can make sure that it still works.

I am going to be breaking everything soon enough, so I want a clean commit.

```fs
| Error er -> {schema=schema_def; packages=[]; links=[]; actions=[]; errors=er; files=[]} |> Ok
```

Missed the files field in `load_from_string`. Let me run this.

2:25pm.

```
Server bound to: tcp://*:13805
Unhandled exception: System.AggregateException: One or more errors occurred. (The given key was not present in the dictionary.) (The given key was not present in the dictionary.)
 ---> System.Collections.Generic.KeyNotFoundException: The given key was not present in the dictionary.
   at Hopac.Promise`1.Get()
   at Hopac.Promise.Now.get[x](Promise`1 xP)
   at Spiral.StreamServer.loop@74-123[b](PersistentVector`1 olds, Cons`1 _arg1) in C:\Users\Marko\Source\Repos\The Spiral Language\The Spiral Language v0.2 (typechecking)\StreamServer.fs:line 75
```

The package server is fine, but the regular files are broken. It did not show hovers and now it crashed.

Do I backtrack to a previous commit or do I figure it out by hand?

Well, it will be a good refresher, so let me do it by hand.

The task of redesigning the server is the last hurdle. It is literally the last boss fight, and doing the actual build is more like an expansion pack.

Once I beat this, I will have made a remarkable accomplishment.

So let me do it. There is nothing to agonize about here. If I want power, I should just go and get it by myself!

2:30pm. Focus. This is my life's work here. However it ends up being acquiring these skills and creating Spiral v0.2 will have been worth it. Whatever I regret in the future and whatever my regrets are in the past, Spiral won't be one of them. Spiral was one of the few things I did right.

Let me do this. Find the error.

As the first step, I'll try running the server in debug mode. That should show me where the error is.

```fs
let rec constraint_name (env : TopEnv) = function
    | CNumber -> "number"
    | CPrototype i -> env.prototypes.[i].name
```

Of all things it is here. What the hell?

```fs
    |> fun (filled_top, top_env_additions) ->
        if 0 = errors.Count then
            annotations |> Seq.iter (fun (KeyValue (_,(r,x))) -> if has_metavars x then errors.Add(r, ValueRestriction x))
        {
        filled_top = filled_top
        top_env_additions = top_env_additions
        hovers = let x = hover_types.ToArray() |> Array.map (fun (a,b) -> a, show_t top_env b) in Array.sortInPlaceBy fst x; x
```

So it happens here when it tries to show the types of hovers.

I am going to have to put in a print statement just so I can make sure of what kind of top level statement it is.

It happens in `bundle_prototype`. Does it try printing its own constraint?

```fs
    | BundlePrototype(q,(r,name),(w,var_init),vars',expr) ->
        let i = at_tag top_env'.prototypes_next_tag
        let cons = CPrototype i
        let v = {scope=0; constraints=Set.singleton cons; name=var_init; kind=List.foldBack (fun ((_,(_,k)),_) s -> KindFun(typevar k, s)) vars' KindType}
        let vars,env_ty = typevars {term=Map.empty; constraints=Map.empty; ty=Map.add var_init (TyVar v) Map.empty} vars'
        let vars = v :: vars
        let v = fresh_var()
        ty {term=Map.empty; ty=env_ty; constraints=Map.empty} v expr
        let body = List.foldBack (fun a b -> TyForall(a,b)) vars (term_subst v)
        if 0 = errors.Count then
            hover_types.Add(r,body)
            psucc (fun () -> FPrototype(q,(r,name),(w,var_init),vars',expr)),
            { top_env_empty with
                prototypes_next_tag = i.tag + 1
                prototypes = Map.add i {|name=name; signature=body|} Map.empty
                term = Map.add name body Map.empty
                constraints = Map.add name (C cons) Map.empty
                }
        else pfail, top_env_empty
```

Yes, the first forall has a recursive constraint. But where does thing thing get added to the hover provider? I find that confusing. It has been a while since I did this and I am not sure about the details.

Ok, instead throwing an exception on a missing key, let me just have it print `?`. I want to make sure that the error really occurs where I think it does.

```fs
hover_types.Add(r,body)
```

Ah, missed this.

```fs
        let top_env = union top_env_additions top_env
        {
        filled_top = filled_top
        top_env_additions = top_env_additions
        hovers = let x = hover_types.ToArray() |> Array.map (fun (a,b) -> a, show_t top_env b) in Array.sortInPlaceBy fst x; x
```

I can do this.

Or I can just remove the troublesome hover.

Let me remove the hover.

Less is more.

2:55pm.

```fs
instance (>>=) cps_parser r = fun (cps_parser a) f => cps_parser fun str i ({on_succ on_fail} & on) =>
    a str i { on_fail on_succ = fun a,i => run_cps (f a) str i on }
```

Something strange is going on here.

The arguments are not showing up on hover. So hovers still have some errors.

I need to get this out of the way.

I do not want to redo the whole server and have to wonder which bugs are from before, and which ones have been introduced.

```fs
hovers = let x = hover_types.ToArray() |> Array.map (fun (a,b) -> a, show_t top_env b) in Array.sortInPlaceBy fst x; x
```

```fs
type VSCPos = {|line : int; character : int|}
type VSCRange = VSCPos * VSCPos
```

Ah, crap, it might be sorting this by character and then by line. It is possible.

```fs
let bundle_top_range = function
    | BundleType(r,_,_,_) | BundleNominal(r,_,_,_) | BundleInl(r,_,_,_) | BundlePrototype(r,_,_,_,_) | BundleInstance(r,_,_,_,_) -> r
    | BundleNominalRec l -> List.head l |> fun (r,_,_,_) -> r
    | BundleRecInl(l,_) -> List.head l |> fun (r,_,_) -> r
```

I am going to do this shit properly. I had enough of these stupid offset shenanigans.

```fs
    |> fun (filled_top, top_env_additions) ->
        if 0 = errors.Count then
            annotations |> Seq.iter (fun (KeyValue(_,(r,x))) -> if has_metavars x then errors.Add(r, ValueRestriction x))
        {
        filled_top = filled_top
        top_env_additions = top_env_additions
        offset = bundle_top_range expr |> fst |> fun x -> x.line
        hovers = hover_types.ToArray() |> Array.map (fun (a,b) -> a, show_t top_env b)
        errors = errors |> Seq.toList |> List.map (fun (a,b) -> a, show_type_error top_env b)
        }
```

Let me go with this. Now I'll try redesigning the hover handler in ordoer to account for...

```fs
        let start = if 0 < x.hovers.Length then (x.hovers.[0] |> fst |> fst).line else Int32.MaxValue
        start <= pos.line
```

Hmm, does this kind of check make sense.

Yes, it does.

```fs
l |> PersistentVector.tryFindBack (fun x -> x.offset <= pos.line)
```

Well, whatever. Now things should work just as well as they have before. No way will this fail me.

Let me give it a try.

Ever since I did the new version, the hovers have been a source of trouble, but I should nail them down with this.

3:15pm. Perfect. Everything is perfect right now. I can make a clean commit.

Let me do it. It is really good that I took just a bit of my time to do this kind of testing as it will make things a lot smoother after I am done with the new server. This was a good move."

---
## [D0641860/Advanced-SW-](https://github.com/D0641860/Advanced-SW-)@[babacd956e...](https://github.com/D0641860/Advanced-SW-/commit/babacd956e27b82909fe8ccc68d1e3eee0aee6b8)
#### Tuesday 2020-11-17 14:39:07 by D0641860

Merge pull request #1 from YuHeng-Juan/main

fuck you!

---
## [AnisiaVasileva/codeWars_solutions](https://github.com/AnisiaVasileva/codeWars_solutions)@[5b3c36916d...](https://github.com/AnisiaVasileva/codeWars_solutions/commit/5b3c36916d5421ffb4bada4d9fad5ff27f9b4c9a)
#### Tuesday 2020-11-17 16:25:02 by Anisia Vasileva

Create I love you, a little,	a lot...

Who remembers back to their time in the schoolyard, when girls would take a flower and tear its petals, saying each of the following phrases each time a petal was turn:
•	I love you
•	a little
•	a lot
•	passionately
•	madly
•	not at all
When the last petal was torn there were cries of excitement, dreams, surging thoughts and emotions.
Your goal in this kata is to determine which phrase the girls would say for a flower of a given number of petals, where nb_petals > 0.

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[d79cb727f8...](https://github.com/mrakgr/The-Spiral-Language/commit/d79cb727f826ee388655554ddc8974f3c5494678)
#### Tuesday 2020-11-17 17:57:13 by Marko Grdinić

"5:25pm. I am back.

```fs
let supervisor tokenizer_errors parser_errors type_errors package_errors fatal_errors req =
    let loop = req >>= function
        | ProjectFileOpen x -> failwith "TODO"
        | ProjectFileChange x -> failwith "TODO"
        | ProjectFileDelete x -> failwith "TODO"
        | ProjectFileLinks(x,res) -> failwith "TODO"
        | ProjectCodeActions(x,res) -> failwith "TODO"
        | ProjectCodeActionExecute x -> failwith "TODO"
        | FileOpen x -> failwith "TODO"
        | FileChanged x -> failwith "TODO"
        | FileTokenRange(x, res) -> failwith "TODO"
        | HoverAt(x,res) -> failwith "TODO"
    Job.foreverServer loop
```

My focus when I am away from the screen has not really been good. When I do the chores, my mind starts to wander towards other things.

It is not like when I am taking a nap specifically to refine my ideas.

I am weak. In order to really focus I need to sit down and grind away at it.

5:30pm. Let me review my old code for a while. I need to run my desire over and over in order to build it up. I need to manifest the urge.

5:50pm. I've been thinking of various things.

Yeah, it is telling that of all the things I could think about, the way the `file_server` was done is what stuck in my mind. I can't use cancellation tokens. That general technique is too complicated.

In a similar vein...

```fs
    let rec loop old_results =
        {new TypecheckerStream with
            member _.Run(res) =
                let r =
                    top_env >>=* fun top_env ->
                    res >>= fun res ->
                    // Doing the memoization like this has the disadvantage of always focing the evaluation of the previous
                    // streams' first item, but on the plus side will reuse old state.
                    old_results >>- fun old_results ->
                    run (cons_fulfilled old_results) top_env 0 res.bundles
                let a = Stream.mapFun (fun (_,x,_) -> x) r
                a, loop r
            }
```

I've been thinking about the way I've done this part. I dislike this.

I want it the memoization to be done here similarly to how it is done in the parser. This way is no good as it does excess computation because it always forces the first item and will create garbage in the scenarios I am envisioning.

The parser's way is the best tradeoff. Even if it will potentially throw aways useful old state, it won't create garbage.

I can in fact redesign this to use the same pattern. Today I'll just add a TODO, but tomorrow I'll move `old_results >>- fun old_results ->` up and see where it leads me from there.

In the past few months I've done a lot of thinking about concurrency. And one thing that is clear to me now that I am bathed in the stresses of real world needs is that an amateur thinks of increasing concurrency in order to get the benefits of it.

Now that I am closer to an expert, I see that to get the benefits I should be instead increasing laziness. Instead of launching more processes, make things immutable and do less work.

And things being pure and lazy will make it quite natural to uncover good concurrency opportunities. Like with packages.

Apart from missing some pieces, the way it is done now is very good. I have multiple promises and in order to unlock the benefit of concurrency there, all I have to do is grab them in parallel.

Right now the package streams return: `Map<string, InferResult Stream> * PackageDiffStream`.

Both the core and the diff stream return that map of `InferResult Stream`s.

I am thinking of adding another layer of laziness to that. Later on in addition to this map of infer results, I'll need to ...

Actually, I am pointing at the wrong thing here.

6:05pm. I am confused now.

```fs
type PackageCoreStateItem = {
    links : Map<string,{|name : string|}>
    rev_links : string Set
    top_env_in : TopEnv Promise
    top_env_out : TopEnv Promise
    stream : MultiFileStream
    }
```

I meant to point at the `top_env_in`. The way I am imagining it, I need to diff the hierarchy and only then can I pass the top env to the next package.

But instead of doing everything in `add_package` eagerly I'd like to expose even more laziness just in case the user working on some package that links to many other packages. I do not want every single key press to immediatelly affect all the packages linking to it.

```fs
packages : Map<string,PackageCoreStateItem>
```

I am not sure whether I should aim to lazify this further at this particular spot, but I'll definitely consider replacing `PackageCoreStateItem` with `PackageCoreStateItem Promise` here. I'll leave it as a future idea.

6:10pm. It is actually surprising that I do not want anything to do with cancellation tokens. I spent a lot of time thinking of how to deal with launching and cancelling concurrent processes, but now that time has passed and I am looking at it again, I feel completely cold on it.

6:15pm. Now that the push has come to shove, I am only really composing promises and streams. I do not even want to think about how to make use of that technique. I can't see any place where I need it either.

So I guess it will be fine to leave it aside.

...

The strangest thing right now is just how well things are clicking for me.

I've been frazzled the whole day, and you'd think that nothing would come to me givem my emotional state, but I can't see any difficulties at all from my present vantage point.

6:30pm. I am thinking.

Right now, if the user loads a package file, the server will in fact try to recursively load the packages it links to. I need to go beyond that. I need to have the loading the package file also load the modules.

It does not go one way only.

Most of the time, a module file is the one that will get opened first, so what the program will have to do is look for the project file, load it and then load the rest of the modules.

So modules must be capable of loading packages and packages must be capable of loading modules.

So far I've only been relying on VS Code to ferry the file data around, but I'll have to redesign the server to be more proactive.

I am thinking how exactly do I want to do this loading.

I do not want the schema validator to say no problem only to get an error later when I try to load the file from disk. So that functionality is going to have to be close to there.

Schema validation is almost an ancient piece by now, but I am going to have to reimagine its purpose and extend its functionality.

So far for simplicity I've been taking for granted that the files are loaded in memory, but now I am going to have to decide a few things.

Let me make a little TODO list.

1) Fix the way packages are merged in `add_package`.
2) Lazify the `typechecker` more like the `parser`.
3) Extend the package loader so it loads modules as well.

Lunch time.

6:55pm. I am back, but obviously I am not going to be doing any more programming at this time. It is time for some fun.

It is strange, my BG obsession just does not seem to be abbating. Well, I'll scratch that itch at some point.

I want to see what exactly is the ideal game."

---
## [chanzuckerberg/corpora-data-portal](https://github.com/chanzuckerberg/corpora-data-portal)@[11833c1e0e...](https://github.com/chanzuckerberg/corpora-data-portal/commit/11833c1e0eeb9b9ba6415d9dfbbecff792342737)
#### Tuesday 2020-11-17 18:32:22 by Timmy Huang

thuang-517-AuthN (#712)

When the user is logged in, you see the random scientist emoji:

<img width="1218" alt="Screen Shot 2020-11-12 at 2 06 03 PM" src="https://user-images.githubusercontent.com/6309723/99001836-5f075880-24f0-11eb-888b-ad4faceae8fa.png">

When a user is logged in and clicks on the emoji:
<img width="465" alt="Screen Shot 2020-11-12 at 2 06 12 PM" src="https://user-images.githubusercontent.com/6309723/99001845-629adf80-24f0-11eb-8286-8308634af830.png">

UPDATE (11/16): Use email first char if name is not available

![demo3](https://user-images.githubusercontent.com/6309723/99344085-1deeab80-2844-11eb-9941-748487c2fa54.gif)
![demo2](https://user-images.githubusercontent.com/6309723/99344098-25ae5000-2844-11eb-8ea4-92a780964390.gif)

When user is not logged in, but they click on "Create Collection" button:
<img width="1216" alt="Screen Shot 2020-11-12 at 2 05 44 PM" src="https://user-images.githubusercontent.com/6309723/99001813-57e04a80-24f0-11eb-9f0b-15d996beab10.png">

(UPDATED: 11/13) When a user is not logged in and `auth` flag is `true`, they see "Log In" button:
<img width="1462" alt="Screen Shot 2020-11-13 at 11 20 42 AM" src="https://user-images.githubusercontent.com/6309723/99112404-7868dd00-25a2-11eb-9a14-cabe28b1203d.png">

GIF:
![demo](https://user-images.githubusercontent.com/6309723/99003154-76474580-24f2-11eb-8a86-64a8e0bd395f.gif)

QA Steps:
1. Pull this branch: `thuang-517-AuthN`
1. Run `npm start`
1. Navigate to: `http://localhost:8000/?auth=true&cc=true` to enable both flags
1. You should now see "Log In" and "Sign Up" buttons, and if you click on "Create Collection" button, you'll get the CTA
1. Now to simulate a logged in user's experience, I use [Requestly](https://chrome.google.com/webstore/detail/requestly-redirect-url-mo/mdnleldcmiljblolnjhpnblkcekpdkpa?hl=en) to modify the request header's `Cookie` to include my `dev` env cookies. Essentially you log in on dev cellxgene (https://api.cellxgene.dev.single-cell.czi.technology/dp/v1/login), and then inspect a request we send to BE, so you can cookie the request header `Cookie` field and paste that into Requestly rule, with `contains URL: api.cellxgene.dev.single-cell.czi.technology`. Press "Save"

    E.g., 

    **NOTE: Please check your `frontend/src/configs/configs.js` uses `API_URL: "https://api.cellxgene.dev.single-cell.czi.technology"` instead of the old `corpora` namespace**

    <img width="916" alt="Screen Shot 2020-11-12 at 2 29 35 PM" src="https://user-images.githubusercontent.com/6309723/99004068-86135980-24f3-11eb-9c66-2e742396133f.png">

1. Now activate Requestly like so:
    
    <img width="683" alt="Screen Shot 2020-11-12 at 2 34 30 PM" src="https://user-images.githubusercontent.com/6309723/99004597-3c773e80-24f4-11eb-92b6-e3f7436ec27e.png">

1. Refresh the page, and you should see all the logged in features!

1. Alternatively, you can also run local BE with `DEPLOYMENT_STAGE=test`! 

PTAL thanks all!

resolves #571

---
## [clearlinux-pkgs/urllib3](https://github.com/clearlinux-pkgs/urllib3)@[7ffdbaf21b...](https://github.com/clearlinux-pkgs/urllib3/commit/7ffdbaf21b52d4f4137b29fc70d5855c7ec20bda)
#### Tuesday 2020-11-17 18:54:13 by Arjan van de Ven

urllib3: Autospec creation for update from version 1.25.11 to version 1.26.0

Andrey Petrov (2):
      Add Contributor Covenant as Code of Conduct
      FUNDING.yml: Add Gitcoin

Bastiaan Bakker (1):
      Feature/support env var sslkeylogfile (#1867)

Brian Price (1):
      Don't log defect warnings on multipart/* responses

Chris (1):
      Drain connection after PoolManager redirect (#1817)

David Vo (1):
      Avoid hasattr in BrotliDecoder.decompress()

DonaCthulhuote (1):
      Add default user agent header (#1750)

Ezzeri Esa (4):
      Include mypy in noxfile and add ssl_match_hostname stubs
      Install Mypy in Nox, add Ezzeri Esa to contributors
      Include exceptions.pyi and fields.pyi
      Include filepost.pyi and util/url.pyi (#1955)

Hasan Ramezani (3):
      Coerce values to str in HTTPHeaderDict.__getitem__
      Raise error on invalid labels in create_connection()
      Add supported Python versions badge to README (#2010)

Heikki Orsila (1):
      Document disabling certificate verification via cert_reqs='CERT_NONE'

Himanshu Garg (1):
      Update LICENSE copyright date

Hod Bin Noon (1):
      Ensure test host resolves to IPv6 in tests (#1819)

Hugo van Kemenade (2):
      Test on Python 3.9-dev and nightly on Travis CI
      Test Python 3.9-dev on macOS on GitHub Actions

Jorge (5):
      Add support for HTTPS connections to proxies. (#1679)
      Add SSLTransport to support TLS in TLS connections
      Get SSLTransport tests to 100% coverage
      Integrate TLS-in-TLS support into urllib3 (#1923)
      Update documentation for HTTPS proxies

Jorge Lopez Silva (2):
      Fix constructor parameter order in SSLTransport.
      Improve readability on return handling logic.

Michael Shields (1):
      Fix typo in doc

PleasantMachine9 (2):
      Add documentation for using Nox more efficiently (#1887)
      Disable the use of session tickets on TLSv1.2 by default

Pradyun Gedam (1):
      Use Sphinx 3 and unpin Furo

Quentin Pradet (32):
      Stop looking at exception values in test_client_no_intermediate (#1811)
      ci: remove now-unneeded virtualenv workaround (#1813)
      Fix test_preserve_chunked_on_retry_after flakiness (#1816)
      Ensure load_verify_locations raises SSLError for all backends (#1812)
      Stop skipping SecureTransport tests
      Regenerate dummyserver/certs with trustme (#1831)
      Restore coverage measurements
      Include requirement unconditionally
      Switch macOS CI to GitHub Actions (#1839)
      Detect GitHub Actions as continuous integration (#1840)
      Revert "Add context to find_unused_port"
      Fix documentation build by skipping Sphinx 3.0.0 (#1844)
      Fix flaky test by setting longer connect timeout
      Run twine check in CI
      Remove raw reST directive from README
      Check README.rst and CHANGES.rst are valid reST
      Prevent git from ignoring .github/
      Fix linting for flake8 v3.8
      Use nox version that works with Python 3.5.2
      Skip two tests that are flaky on Windows
      Use LONG_TIMEOUT for read with retries=0
      Rename _travis/ to ci/
      Switch to more reliable method to upload coverage
      Use ci/upload_coverage.sh in GitHub Actions
      Use LONG_TIMEOUT on another timeout-based test
      Move nox -s lint to GitHub Actions
      Use LONG_TIMEOUT on test with disabled retries
      Enforce flake8-2020
      Stop testing docs in Travis
      Sort imports with 'isort'
      Add isort config to setup.cfg for editors (#2009)
      Fix flaky test by avoiding refused connection with short timeout (#2008)

Rober Morales-Chaparro (1):
      Swallow BrokenPipeError when writing request body

Seth Michael Larson (28):
      Add v1.25.9 to CHANGES.rst on master
      Add CODEOWNERS restricting access to files related to deployment (#1857)
      Collapse request chunked data and framing into one send() call (#1906)
      Add v1.25.10 release to CHANGES on master
      Allow Python nightly build to fail on Travis
      Use tz-aware functions in Retry.parse_retry_after()
      Parse UTC for 'Retry-After' redirect handler
      Wrap BaseSSLError into SSLError during response reads
      Change 'sanity-friendly' to 'user-friendly'
      Remove 'Defensive' from non-timeout SSLError branch
      Overhaul and re-theme documentation
      Stricter RTD builds, move Sponsors to docs (#1954)
      Mark master branch as 1.26.0.dev0 for RTD
      Fix autodoc and intersphinx links in documentation (#1966)
      Create v2.0 Roadmap and Open Collective Sponsors Section
      Add Open Collective to GitHub Funding
      Add Discord shield, reorder shields
      Update the Discord invite
      Update color scheme of banner to match logo
      Rename Retry options and defaults
      Don't set keylog_filename for empty values
      Deprecate negotiating TLSv1 and TLSv1.1 by default
      Add 1.25.11 release to CHANGES.rst
      Switch to an absolute URL for banner image
      Add SKIP_HEADER for skipping automatically added headers
      Skip TLS versions if disabled by OpenSSL config
      Remove type stubs from 1.26 branch
      Release: 1.26.0

Shea Craig (1):
      Add hardcoded paths to macOS frameworks for Big Sur compatibility. (#1905)

Stephen Rosen (1):
      Document how to customize SNI and Host headers when connecting via IP

Tim Gates (2):
      doco: Fix small typos (#1860)
      Fix typo: 'succesfully' -> 'successfully'

hodbn (26):
      Skip tests when DNS can't resolve a dotted FQDN
      Test that ConnectionPool preserves path dot segments
      Simplify get_unreachable_address (#1836)
      Add context to find_unused_port (#1837)
      Unwrap ProxyError when evaluating retries (#1830)
      Backslash terminates authority URL section
      Change TARPIT_HOST to detect isolated network (#1862)
      Add 'other errors' counter to Retry (#1824)
      Don't insert 'None' into ConnectionPool if it was empty
      Add InvalidChunkLength error
      Test buggy incomplete read
      Fix coverage, InvalidChunkLength is chunked and has no expected length
      Update docs for an old Python version test
      Remove unnecessary httplib export
      Fix testing of SSLKEYLOGFILE on AppVeyor
      Raise a meaningful error for an unknown scheme (#1872)
      Send "http/1.1" ALPN extension during TLS handshake
      Don't raise SNI warning on SecureTransport with server_hostname=None
      Blacken using black==20.8b1
      Always assume UTC if no timezone in Retry-After
      Upgrade pytest-freezegun to 0.4.2
      Remove duplicate dict key and except block
      Migrate Windows CI to GitHub Actions
      Consume connections better in socket-level tests (#1958)
      Add PR and issue templates (#1978)
      Terminate connection when custom verification fails (SecureTransport) (#1977)

matthewhughes934 (2):
      Fix typo, add rST code block
      Document url and body parameters for ConnectionPool.urlopen()

谭九鼎 (1):
      Use GitHub Actions checkout v2 (#2006)

---
## [newstools/2020-sundiata-post](https://github.com/newstools/2020-sundiata-post)@[5096362511...](https://github.com/newstools/2020-sundiata-post/commit/5096362511150d0fe85c66400a8be5e90a44b464)
#### Tuesday 2020-11-17 19:56:37 by NewsTools

Created Text For URL [sundiatapost.com/new-york-boy-14-steals-his-dads-car-to-run-away-with-his-11-year-old-girlfriend/]

---
## [CrashCringle12/Simply-Love-SM5](https://github.com/CrashCringle12/Simply-Love-SM5)@[a9156fbdaf...](https://github.com/CrashCringle12/Simply-Love-SM5/commit/a9156fbdaf76e847f0b7b765e518b2c8b76a59f0)
#### Tuesday 2020-11-17 22:14:14 by Lamar Cooley

Seems we've reached an Impasse

The point before point of no return. I've mixed feelings about proceeding from here. You finally beat the game, but are you sure you want to go to NewGame+? No no.... You've finally finished the first chapter of the main quest, but proceeding any futher in the story will take you to a new area. Are you sure you wish to leave? Your favorite show has ended and it holds a great amount of nostalgia in your heart. The spin off airs now, but part of you worries.

I think, I think this is a good spot to remain for now.

This is a completely exaggerated example of the moral dilemma
https://youtu.be/ks5DFEwZoHw?t=472

Can't quite remember everything about the episode but I remember this part at 7:52. While the Krusty Krab technically by modern standards is "better", I mean look at all the cool new stuff it has: Omg a freaking pool table? Sign me up. And I mean it is also a lot more efficient. They're able to pump out patties left and right and they've got the automated cash register. Putting the overt grossness of the patties aside (as i'm sure that's not the case here) that is pretending that the patties taste fine if not better. Well actually either way, the customer's are content. But it still just feels off. Where's the Love? Love truly is something magical and I think it's an important ingredient to any truly great product. This is more of an extreme dystpoian fear of things down the line. I hope that love is included in every commit.

Anywho, will I proceed from here? Mmm possibly eventually? Perhaps if there's some grand new feature that twiddles my heartstrings. But not knowing the folks reduces my immediate trust, this is probably something I should always do but i'll probs hold off on blindly merging beta builds. Eh I'm starting to ramble now.

We'll see what happens from here I suppose. Even if I become an SL-Boomer, I think tho whoever replaces me will likely eventually continue regardless of I stopped or not. Rightfully so. For now, in grand conclusion, we'll be resting here for a decent bit.

---

# [<](2020-11-16.md) 2020-11-17 [>](2020-11-18.md)

