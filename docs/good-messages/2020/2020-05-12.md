# [<](2020-05-11.md) 2020-05-12 [>](2020-05-13.md)

2,737,454 events, 1,382,610 push events, 2,208,656 commit messages, 160,440,953 characters


## [dom64/dompack](https://github.com/dom64/dompack)@[a6bfdc9d36...](https://github.com/dom64/dompack/commit/a6bfdc9d36ef82bb1061e217049ab2b12ce5997f)
#### Tuesday 2020-05-12 01:29:15 by CrazyC787

Added mod configs

Fuck you dom I'm not seperating these because I hate you

---
## [valevalorin/aothine](https://github.com/valevalorin/aothine)@[3036163630...](https://github.com/valevalorin/aothine/commit/3036163630855ce0536a898ea2ed3ad92d1b2875)
#### Tuesday 2020-05-12 01:58:25 by GIANTMEDIA\dkelly

fuck you you stupid bitch ass developer putting taht shit under that fucking directory

---
## [izzabelle/msg](https://github.com/izzabelle/msg)@[e2587ee259...](https://github.com/izzabelle/msg/commit/e2587ee259cf915c951cba46cb19574cecd94d3e)
#### Tuesday 2020-05-12 02:15:43 by Isabelle L

holy fuck that's a lot of code that she changed. god damn she should have made smaller commits

---
## [STJr/Kart-Public](https://github.com/STJr/Kart-Public)@[35aa2a58bf...](https://github.com/STJr/Kart-Public/commit/35aa2a58bf66eba5dc318e63e849e0f386262aef)
#### Tuesday 2020-05-12 02:43:50 by wolfs

Merge branch 'appveyor-shit' into 'next'

Fuck you Appveyor / Thank you Appveyor

See merge request KartKrew/Kart-Public!165

---
## [Jackzmc/MissileWars](https://github.com/Jackzmc/MissileWars)@[f4c8f830eb...](https://github.com/Jackzmc/MissileWars/commit/f4c8f830eb37b2c891308f4705dd96a300bee172)
#### Tuesday 2020-05-12 05:30:05 by Jackz

Nearly full working reset system works
- God I fucking hate worldedit with its little documentation

---
## [J-Cake/Neural-Network](https://github.com/J-Cake/Neural-Network)@[75f83c3fd2...](https://github.com/J-Cake/Neural-Network/commit/75f83c3fd2f82a2a70405ac25f4f8f175b117aae)
#### Tuesday 2020-05-12 06:01:13 by jcake

Started work on GUI. I've done a shit tone of work. I actually planned on this being a super simple quick pluck-it-together kinda thing, but, of course, no. anyway, I wanted to commit the entire GUI in a single commit but decided that was stupid. So I've done a massive refactor, basically finished the worker communication system and finally made some upgrades to my state manager. It works super well. I now need to link up the network, make the error graph and then optimise the fuck out of it - and I mean **realllyyy** optimise it!!!

---
## [tduncan/conways-game-of-life](https://github.com/tduncan/conways-game-of-life)@[0545e220c3...](https://github.com/tduncan/conways-game-of-life/commit/0545e220c36c9bd803708ee18d4a2b6345881c12)
#### Tuesday 2020-05-12 06:14:51 by thomasduncan

The beginnig of the test.  Some schools of TDD thought advocate for
literally not writing any production code, including the production
class,  until a failing test requires it, and that a compiler error is a failing test.  I've done that here for demonstration, but I personally don't find that level of rigor valuable.  I would avoid creating method stubs, however, as exploring the API space within the tests from the perspective of a user can produce some surprising results. Often the APIs we dream up are not very useable, and this pain will be felt frequently as you continue building the test suite.

---
## [okias/linux](https://github.com/okias/linux)@[91232b0b36...](https://github.com/okias/linux/commit/91232b0b36c50a5b749809b789bc24963d776e44)
#### Tuesday 2020-05-12 09:01:10 by Joonsoo Kim

mm/page_alloc: use ac->high_zoneidx for classzone_idx

Patch series "integrate classzone_idx and high_zoneidx", v5.

This patchset is followup of the problem reported and discussed two years
ago [1, 2].  The problem this patchset solves is related to the
classzone_idx on the NUMA system.  It causes a problem when the lowmem
reserve protection exists for some zones on a node that do not exist on
other nodes.

This problem was reported two years ago, and, at that time, the solution
got general agreements [2].  But it was not upstreamed.

[1]: http://lkml.kernel.org/r/20180102063528.GG30397@yexl-desktop
[2]: http://lkml.kernel.org/r/1525408246-14768-1-git-send-email-iamjoonsoo.kim@lge.com

This patch (of 2):

Currently, we use classzone_idx to calculate lowmem reserve proetection
for an allocation request.  This classzone_idx causes a problem on NUMA
systems when the lowmem reserve protection exists for some zones on a node
that do not exist on other nodes.

Before further explanation, I should first clarify how to compute the
classzone_idx and the high_zoneidx.

- ac->high_zoneidx is computed via the arcane gfp_zone(gfp_mask) and
  represents the index of the highest zone the allocation can use

- classzone_idx was supposed to be the index of the highest zone on the
  local node that the allocation can use, that is actually available in
  the system

Think about following example.  Node 0 has 4 populated zone,
DMA/DMA32/NORMAL/MOVABLE.  Node 1 has 1 populated zone, NORMAL.  Some
zones, such as MOVABLE, doesn't exist on node 1 and this makes following
difference.

Assume that there is an allocation request whose gfp_zone(gfp_mask) is the
zone, MOVABLE.  Then, it's high_zoneidx is 3.  If this allocation is
initiated on node 0, it's classzone_idx is 3 since actually
available/usable zone on local (node 0) is MOVABLE.  If this allocation is
initiated on node 1, it's classzone_idx is 2 since actually
available/usable zone on local (node 1) is NORMAL.

You can see that classzone_idx of the allocation request are different
according to their starting node, even if their high_zoneidx is the same.

Think more about these two allocation requests.  If they are processed on
local, there is no problem.  However, if allocation is initiated on node 1
are processed on remote, in this example, at the NORMAL zone on node 0,
due to memory shortage, problem occurs.  Their different classzone_idx
leads to different lowmem reserve and then different min watermark.  See
the following example.

root@ubuntu:/sys/devices/system/memory# cat /proc/zoneinfo
Node 0, zone      DMA
  per-node stats
...
  pages free     3965
        min      5
        low      8
        high     11
        spanned  4095
        present  3998
        managed  3977
        protection: (0, 2961, 4928, 5440)
...
Node 0, zone    DMA32
  pages free     757955
        min      1129
        low      1887
        high     2645
        spanned  1044480
        present  782303
        managed  758116
        protection: (0, 0, 1967, 2479)
...
Node 0, zone   Normal
  pages free     459806
        min      750
        low      1253
        high     1756
        spanned  524288
        present  524288
        managed  503620
        protection: (0, 0, 0, 4096)
...
Node 0, zone  Movable
  pages free     130759
        min      195
        low      326
        high     457
        spanned  1966079
        present  131072
        managed  131072
        protection: (0, 0, 0, 0)
...
Node 1, zone      DMA
  pages free     0
        min      0
        low      0
        high     0
        spanned  0
        present  0
        managed  0
        protection: (0, 0, 1006, 1006)
Node 1, zone    DMA32
  pages free     0
        min      0
        low      0
        high     0
        spanned  0
        present  0
        managed  0
        protection: (0, 0, 1006, 1006)
Node 1, zone   Normal
  per-node stats
...
  pages free     233277
        min      383
        low      640
        high     897
        spanned  262144
        present  262144
        managed  257744
        protection: (0, 0, 0, 0)
...
Node 1, zone  Movable
  pages free     0
        min      0
        low      0
        high     0
        spanned  262144
        present  0
        managed  0
        protection: (0, 0, 0, 0)

- static min watermark for the NORMAL zone on node 0 is 750.

- lowmem reserve for the request with classzone idx 3 at the NORMAL on
  node 0 is 4096.

- lowmem reserve for the request with classzone idx 2 at the NORMAL on
  node 0 is 0.

So, overall min watermark is:
allocation initiated on node 0 (classzone_idx 3): 750 + 4096 = 4846
allocation initiated on node 1 (classzone_idx 2): 750 + 0 = 750

Allocation initiated on node 1 will have some precedence than allocation
initiated on node 0 because min watermark of the former allocation is
lower than the other.  So, allocation initiated on node 1 could succeed on
node 0 when allocation initiated on node 0 could not, and, this could
cause too many numa_miss allocation.  Then, performance could be
downgraded.

Recently, there was a regression report about this problem on CMA patches
since CMA memory are placed in ZONE_MOVABLE by those patches.  I checked
that problem is disappeared with this fix that uses high_zoneidx for
classzone_idx.

http://lkml.kernel.org/r/20180102063528.GG30397@yexl-desktop

Using high_zoneidx for classzone_idx is more consistent way than previous
approach because system's memory layout doesn't affect anything to it.
With this patch, both classzone_idx on above example will be 3 so will
have the same min watermark.

allocation initiated on node 0: 750 + 4096 = 4846
allocation initiated on node 1: 750 + 4096 = 4846

One could wonder if there is a side effect that allocation initiated on
node 1 will use higher bar when allocation is handled on local since
classzone_idx could be higher than before.  It will not happen because the
zone without managed page doesn't contributes lowmem_reserve at all.

Link: http://lkml.kernel.org/r/1587095923-7515-1-git-send-email-iamjoonsoo.kim@lge.com
Link: http://lkml.kernel.org/r/1587095923-7515-2-git-send-email-iamjoonsoo.kim@lge.com
Signed-off-by: Joonsoo Kim <iamjoonsoo.kim@lge.com>
Reported-by: Ye Xiaolong <xiaolong.ye@intel.com>
Tested-by: Ye Xiaolong <xiaolong.ye@intel.com>
Reviewed-by: Baoquan He <bhe@redhat.com>
Acked-by: Vlastimil Babka <vbabka@suse.cz>
Acked-by: David Rientjes <rientjes@google.com>
Cc: Johannes Weiner <hannes@cmpxchg.org>
Cc: Michal Hocko <mhocko@kernel.org>
Cc: Minchan Kim <minchan@kernel.org>
Cc: Mel Gorman <mgorman@techsingularity.net>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Stephen Rothwell <sfr@canb.auug.org.au>

---
## [brauner/linux](https://github.com/brauner/linux)@[95044a90f4...](https://github.com/brauner/linux/commit/95044a90f476dd8dce21fc6c5e5c7b290d444537)
#### Tuesday 2020-05-12 10:30:12 by Christian Brauner

nsproxy: attach to namespaces via pidfds

For quite a while we have been thinking about using pidfds to attach to
namespaces. This patchset has existed for about a year already but we've
wanted to wait to see how the general api would be received and adopted.
Now that more and more programs in userspace have started using pidfds
for process management it's time to send this one out.

This patch makes it possible to use pidfds to attach to the namespaces
of another process, i.e. they can be passed as the first argument to the
setns() syscall. When only a single namespace type is specified the
semantics are equivalent to passing an nsfd. That means
setns(nsfd, CLONE_NEWNET) equals setns(pidfd, CLONE_NEWNET). However,
when a pidfd is passed, multiple namespace flags can be specified in the
second setns() argument and setns() will attach the caller to all the
specified namespaces all at once or to none of them. Specifying 0 is not
valid together with a pidfd.

Here are just two obvious examples:
setns(pidfd, CLONE_NEWPID | CLONE_NEWNS | CLONE_NEWNET);
setns(pidfd, CLONE_NEWUSER);
Allowing to also attach subsets of namespaces supports various use-cases
where callers setns to a subset of namespaces to retain privilege, perform
an action and then re-attach another subset of namespaces.

If the need arises, as Eric suggested, we can extend this patchset to
assume even more context than just attaching all namespaces. His suggestion
specifically was about assuming the process' root directory when
setns(pidfd, 0) or setns(pidfd, SETNS_PIDFD) is specified. For now, just
keep it flexible in terms of supporting subsets of namespaces but let's
wait until we have users asking for even more context to be assumed. At
that point we can add an extension.

The obvious example where this is useful is a standard container
manager interacting with a running container: pushing and pulling files
or directories, injecting mounts, attaching/execing any kind of process,
managing network devices all these operations require attaching to all
or at least multiple namespaces at the same time. Given that nowadays
most containers are spawned with all namespaces enabled we're currently
looking at at least 14 syscalls, 7 to open the /proc/<pid>/ns/<ns>
nsfds, another 7 to actually perform the namespace switch. With time
namespaces we're looking at about 16 syscalls.
(We could amortize the first 7 or 8 syscalls for opening the nsfds by
 stashing them in each container's monitor process but that would mean
 we need to send around those file descriptors through unix sockets
 everytime we want to interact with the container or keep on-disk
 state. Even in scenarios where a caller wants to join a particular
 namespace in a particular order callers still profit from batching
 other namespaces. That mostly applies to the user namespace but
 all container runtimes I found join the user namespace first no matter
 if it privileges or deprivileges the container similar to how unshare
 behaves.)
With pidfds this becomes a single syscall no matter how many namespaces
are supposed to be attached to.

A decently designed, large-scale container manager usually isn't the
parent of any of the containers it spawns so the containers don't die
when it crashes or needs to update or reinitialize. This means that
for the manager to interact with containers through pids is inherently
racy especially on systems where the maximum pid number is not
significicantly bumped. This is even more problematic since we often spawn
and manage thousands or ten-thousands of containers. Interacting with a
container through a pid thus can become risky quite quickly. Especially
since we allow for an administrator to enable advanced features such as
syscall interception where we're performing syscalls in lieu of the
container. In all of those cases we use pidfds if they are available and
we pass them around as stable references. Using them to setns() to the
target process' namespaces is as reliable as using nsfds. Either the
target process is already dead and we get ESRCH or we manage to attach
to its namespaces but we can't accidently attach to another process'
namespaces. So pidfds lend themselves to be used with this api.
The other main advantage is that with this change the pidfd becomes the
only relevant token for most container interactions and it's the only
token we need to create and send around.

Apart from significiantly reducing the number of syscalls from double
digit to single digit which is a decent reason post-spectre/meltdown
this also allows to switch to a set of namespaces atomically, i.e.
either attaching to all the specified namespaces succeeds or we fail. If
we fail we haven't changed a single namespace. There are currently three
namespaces that can fail (other than for ENOMEM which really is not
very interesting since we then have other problems anyway) for
non-trivial reasons, user, mount, and pid namespaces. We can fail to
attach to a pid namespace if it is not our current active pid namespace
or a descendant of it. We can fail to attach to a user namespace because
we are multi-threaded or because our current mount namespace shares
filesystem state with other tasks, or because we're trying to setns()
to the same user namespace, i.e. the target task has the same user
namespace as we do. We can fail to attach to a mount namespace because
it shares filesystem state with other tasks or because we fail to lookup
the new root for the new mount namespace. In most non-pathological
scenarios these issues can be somewhat mitigated. But there are cases where
we're half-attached to some namespace and failing to attach to another one.
I've talked about some of these problem during the hallway track (something
only the pre-COVID-19 generation will remember) of Plumbers in Los Angeles
in 2018(?). Even if all these issues could be avoided with super careful
userspace coding it would be nicer to have this done in-kernel. Pidfds seem
to lend themselves nicely for this.

The other neat thing about this is that setns() becomes an actual
counterpart to the namespace bits of unshare().

Signed-off-by: Christian Brauner <christian.brauner@ubuntu.com>
Reviewed-by: Serge Hallyn <serge@hallyn.com>
Cc: Eric W. Biederman <ebiederm@xmission.com>
Cc: Serge Hallyn <serge@hallyn.com>
Cc: Jann Horn <jannh@google.com>
Cc: Michael Kerrisk <mtk.manpages@gmail.com>
Cc: Aleksa Sarai <cyphar@cyphar.com>
Link: https://lore.kernel.org/r/20200505140432.181565-3-christian.brauner@ubuntu.com

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[e227bbd927...](https://github.com/mrakgr/The-Spiral-Language/commit/e227bbd927c6e118a733a93b7340f68ae65ae61d)
#### Tuesday 2020-05-12 10:34:14 by Marko Grdinić

"7:40am. Got up 10m ago. Let me chill for a bit. I'll start after that.

8:05am. Just 10 more minutes and then I will start.

8:20am. Let me start.

Ugh, the MTL translations for Hero King are unreadable. I can't believe there is a whole site dedicated to that crap out there. I guess I'll take it as it comes on Re:Library.

8:25am. Now focus me. I can get a lot of studying done once if I start early.

Regarding regular sockets, the ZeroMQ book said they only allow one connection. So probably the same goes for streams. I'll have to make sure of that though. I have a lot of experimentation to do before I master this, but it should be worth doing. I'll want to take a look at how ZeroMQ works under the hood too.

I think I'll abandon my original plan of starting editor support in May, just so I can have time to properly learn this. It is worth it. I do not think it will take that long, but it depends on how deep I want to dive into it.

8:30am. I am really am flowering as a programmer. I used to be completely out of touch with web development and now I am making big strides in understanding it.

You really cannot be complete unless you understand how to connect computers with one another. Reactive combinators are nice. So are actors. But there is also the matter of going outside the bubble you are in. That is one challenge which needs to be resolved.

After that I'll be a real programmer. By the time v0.2 comes, I will have master all the fundamental skills of programming.

Well, except for how to do actual AI. But that one is best saved for last.

8:35am. With v0.09 I was really engrossed in discovering new techniques in staged functional programming, but in v0.2 I will be closing the lid on most of those as they are superseded by better alternatives. v0.2 is going to be very conventional as a language. Sure, those coming in will have things to discover, but for myself it will be an exceedingly plain as a language.

Just like a few days ago when I figured out how to compile mutually recursive functions properly, it will be more of a chance to tie everything up and complete it properly. The culmination of 3 years of effort and design work after which I will have the tool in its completed form.

v0.09 was innovative, but it is just not good enough.

v0.2 will tick literally every box there is. And I will be done with Spiral.

I will set my sights on the Singularity once more.

8:40am. For now, let me just focus on my studies. The things I talked about are off in the future. Forget that crap. Every day master the things in front of you and the future will take care of itself.

That is the way to roll as a programmer.

I wish I had all of these skills up front, but childhood exists and one must pass through it to reach maturity.

8:45am. There is just a little bit left. It won't be long until Spiral is done.

9:05am.

> The only constraint is that services must be stateless, all state being in the request or in some shared storage such as a database.

So then it is not stateless. This confuses me a little, but I sort of get what he is driving at. Still, I think would be good if the service had the ability to track IDs even if temporary ones. You want to know when people are logging in and out into the service. You do not want impersonators coming in and sending strange messages that much put the entire system into a state of perplexity.

9:10am. Time for the extended request-reply example.

Focus me, focus.

9:25am. Right now I am thinking of Spiral's design rather than doing the example. I think I know how to do the constructor for real nominals. I am doing some redesigning in my mind. Now that I have the concept of `real` blocks firmly embedded in my mind, this frees up some stuff.

...Rather than passing the constructor name by hand, I think I'll just do a pass to distribute it automatically in real nominals. That would be for the best.

Regular types will just be type declarations, but real nominals will extend into a top-down block and return a constructor function.

I'll just unify the range of that function with the intended type.

9:40am. Had to take a little break. Yeah, what I have in mind right now is the ideal form.

I admit, the simple pass to implicitly distribute the constructor, and the `real nominal` definition leading into a standard block is new to me. Doing it this way will really be great.

I've been intending to add `real inl` and `real let`, but instead `real` should be like `join` instead. That will make everything work much more smoothly.

9:50am. Focus me, focus. An hour has gone by, but I haven't done a thing.

10am. Ok, the broker is a bit complicated. I am going to have to wing it.

```
  let items = [Poll(ZMQ.POLLIN,frontend,fun s -> s >|< backend )
               Poll(ZMQ.POLLIN,backend ,fun s -> s >|< frontend)]
  //NOTE: the poll item callbacks above use the transfer operator (>|<).
  //      fs-zmq defines this operator as a convenience for transferring
  //      all parts of a multi-part message from one socket to another.
  //      for a lengthier, but more obvious alternative (which more
  //      closely matches the C version of the guide), see wuproxy.fsx

  // switch messages between sockets
  while true do items |> poll -1L |> ignore
```

I am not sure what this is supposed to be doing.

```
    //  Initialize poll set
    zmq_pollitem_t items [] = {
        { frontend, 0, ZMQ_POLLIN, 0 },
        { backend,  0, ZMQ_POLLIN, 0 }
    };
    //  Switch messages between sockets
    while (1) {
        zmq_msg_t message;
        zmq_poll (items, 2, -1);
        if (items [0].revents & ZMQ_POLLIN) {
            while (1) {
                //  Process all parts of the message
                zmq_msg_init (&message);
                zmq_msg_recv (&message, frontend, 0);
                int more = zmq_msg_more (&message);
                zmq_msg_send (&message, backend, more? ZMQ_SNDMORE: 0);
                zmq_msg_close (&message);
                if (!more)
                    break;      //  Last message part
            }
        }
        if (items [1].revents & ZMQ_POLLIN) {
            while (1) {
                //  Process all parts of the message
                zmq_msg_init (&message);
                zmq_msg_recv (&message, backend, 0);
                int more = zmq_msg_more (&message);
                zmq_msg_send (&message, frontend, more? ZMQ_SNDMORE: 0);
                zmq_msg_close (&message);
                if (!more)
                    break;      //  Last message part
            }
        }
```

Hmmm...

```
    //  Initialize poll set
    zmq_pollitem_t items [] = {
        { frontend, 0, ZMQ_POLLIN, 0 },
        { backend,  0, ZMQ_POLLIN, 0 }
    };
```

Ah, the famed C Array. What are those `0`s supposed to be?

```
zmq_msg_send (&message, backend, more? ZMQ_SNDMORE: 0);
```

Hmmm, what is this syntax...ah, it the ternary if operator.

http://api.zeromq.org/3-2:zmq-poll

Let me read this.

10:20am. I am getting lost in thought. Focus me, focus.

...I think I missed one of the previous example. Let me backtrack then.

```
  // Connect to task ventilator
  use receiver = context |> pull
  connect receiver "tcp://localhost:5557"

  // Connect to weather server
  use subscriber = context |> sub
  connect subscriber "tcp://localhost:5556"
  subscribe subscriber [ encode "10001" ]
```

Oh, I had no idea this would come out. I thought the examples were self contained, but it turns out the aren't.

I can't deal with this. Let me take a look at the NetMQ manual.

https://netmq.readthedocs.io/en/stable/poller/

...Since the whole documentation for this does not seem that big, how about I just move to studying it instead?

That will make dealing with the rest of the examples in the ZeroMQ book easier. Let me switch targets for a bit.

10:45am. https://blog.theodo.com/2019/08/event-driven-architectures-rabbitmq/

He was right, these other messaging protocols are complex.

There is RabbitMQ for .NET and it is more popular than NetMQ though. But I should not let it bother me. ASP.NET is more popular than Suave and I would not touch it with a pole.

```
using (var rep1 = new ResponseSocket("@tcp://*:5001"))
using (var rep2 = new ResponseSocket("@tcp://*:5002"))
using (var poller = new NetMQPoller { rep1, rep2 })
{
    // these event will be raised by the Poller
    rep1.ReceiveReady += (s, a) =>
    {
        // receive won't block as a message is ready
        string msg = a.Socket.ReceiveString();
        // send a response
        a.Socket.Send("Response");
    };
    rep2.ReceiveReady += (s, a) =>
    {
        // receive won't block as a message is ready
        string msg = a.Socket.ReceiveString();
        // send a response
        a.Socket.Send("Response");
    };

    // start polling (on this thread)
    poller.Run();
}
```

Ah, so it is something like this. Why am adding callbacks directly to on the sockets? Though this is much less confusing than the example code in the ZeroMQ guide.

10:50am.

> So you are looking for a messaging library, you might have become frustrated with WCF or MSMQ (we know we have been there too) and heard that ZeroMQ is very fast and then you got here, NetMQ, the .NET port of ZeroMQ (also known as ØMQ).

So WCF is a messaging library? Never heard of MSMQ.

11:05am. Right now I am going through the NetMQ docs from the top.

> With `Bind`, you allow peers to connect to you, thus you don't know how many peers there will be in the future and you cannot create the queues in advance. Instead, queues are created as individual peers connect to the bound socket.

> With `Connect`, ZeroMQ knows that there's going to be at least a single peer and thus it can create a single queue immediately. This applies to all socket types except ROUTER, where queues are only created after the peer we connect to has acknowledge our connection.

11:15am.

> Request-reply, which connects a set of clients to a set of services. This is a remote procedure call and task distribution pattern.

So I finally can put into my mind what a RPOC really is. ZMQ is really ideal for this kind of thing.

> These are the socket combinations that are valid for a connect-bind pair (either side can bind):

...This is a long list.

I think all of my examples where I passed in URIs directly are wrong. I am going to have to rewrite them a bit. I'll leave that for later.

11:30am. https://netmq.readthedocs.io/en/stable/message/#creating-multipart-messages

Ah, I think I get why multipart messages are necessary. For the sake of passing in multiple different fields. Like an `int` followed by a `string` and so on.

That is cool. Much simpler than JSON. I'll go with that then. Forget LSP.

11:55am.

```
[<EntryPoint>]
let main argv =
    let uri = "ipc://test"
    use client = new ResponseSocket()
    client.Bind(uri)
    use server = new RequestSocket()
    server.Connect(uri)
    server.SendMoreFrame([|byte 'Q';byte 'w';byte 'e'|])
        .SendMoreFrame("A")
        .SendFrame("Hello")

    let more = ref true
    while !more do
        let frame = client.ReceiveFrameString(more)
        Console.WriteLine(frame);

    0
```

This is quite cool. I've spent some time playing with it. Yes, it will be quite useful compared to sending everything as one string.

12pm. Right now I am thinking of how I am going to transfer F# union types IPC.

What I am going to is generate the transfer code programmatically using reflection. That will allow me to generate the simple, but tedious F# and TS code in tandem. I've never done something like this before, but it should be a fun little exercise.

I'll leave that for later though.

Let me get back to the book.

12:10pm. https://netmq.readthedocs.io/en/stable/transports/

Let me read this. I am thinking of stopping here for the morning, but let me go on for longer as I am into it.

```
Notice the format of the address string passed to Bind() and Connect(). For TCP connections, it will resemble:

* The protocol (tcp)
* The host (an IP address, host name, or the wildcard * to match any)
* The port number (5555)
```

Ah, I see. So that is what that wildcard is.

12:20pm. Ah, that Fable null issue I raised a fuss about finally got fixed. This is nice.

I guess I can consider using the thing again. I feel bad about how ham fisted I was in the review - I definitely was not fair, but I'll highlight that and reflect on my anger.

Let me get back to the book.

12:25pm. Ok, I do not really know what multicast is or why it is needed at this time. I'll leave that for later.

Let me finish the final intro chapter and then I am done.

> New with NetMQ version 4 we said goobye to NetMQContext. We can now create sockets with the new operator without the NetMQContext. Though this makes using the library simpler, it also adds complication to cleaning it up.

`goobye` should be `goodbye`.

...Ah, this error is only on the site. It has been fixed in the `.md` file.

12:30pm. https://netmq.readthedocs.io/en/stable/actor/

Surprised an actor is a part of ZeroMQ.

I'll study this later. Let me have a break here."

---
## [geokon-gh/sausage](https://github.com/geokon-gh/sausage)@[5487311207...](https://github.com/geokon-gh/sausage/commit/5487311207932d24ca07fd8660db8930ff535893)
#### Tuesday 2020-05-12 11:01:20 by George Kontsevich

Added; Scroll zoom and refactor for pixel bases lengths

I had some weird mix of `mm` and `pixels` and somehow it was
working.. but now it's all consistently using pixels everywhere which
should simplify the logic

The zooming effect however is a bit clunky and ugly in my opinion..

---
## [vcaputo/shadow](https://github.com/vcaputo/shadow)@[d8c9c2a6b6...](https://github.com/vcaputo/shadow/commit/d8c9c2a6b6e4ef52b687af449cd76635847cc947)
#### Tuesday 2020-05-12 12:13:37 by Vito Caputo

su.c: replace getopt with ad-hoc flag processing

In preparation for supporting --exec I was testing the robustness
of "--" handling and it became apparent that things are currently
a bit broken in `su`.

Since "--" is currently of limited utility, as the subsequent
words are simply passed to the shell after "-c","command_string",
it seems to have gone unnoticed for ages.

However, with --exec, it's expected that "--" would be an almost
required separator with every such usage, considering the
following flags must be passed verbatim to execve() and will
likely begin with hyphens looking indistinguishable from any
other flags in lieu of shell interpolation to worry about.

For some practical context of the existing situation, this
invocation doesn't work today:
```
  $ su --command ls -- flags for shell
  No passwd entry for user 'flags'
  $
```

This should just run ls as root with "flags","for","shell"
forwarded to the shell after "-c","ls".

The "--" should block "flags" from being treated as the user.
That particular issue isn't a getopt one per-se, it's arguably
just a bug in su.c's implementation.

It *seemed* like an easy fix for this would be to add a check if
argv[optind-1] were "--" before treating argv[optind] as USER.

But testing that fix revealed getopt was rearranging things when
encountering "--", the "--" would always separate the handled
opts from the unhandled ones.  USER would become shifted to
*after* "--" even when it occurred before it!

If we change the command to specify the user, it works as-is:
```
  $ su --command ls root -- flags for shell
  Password:
  testfile
  $

```

But what's rather surprising is how that works; the argv winds up:

"su","--command","ls","--","root","flags","for","shell"

with optind pointing at "root".

That arrangement of argv is indistinguishable from omitting the
user and having "root","flags","for","shell" as the stuff after
"--".

This makes it non-trivial to fix the bug of omitting user
treating the first word after "--" as the user, which one could
argue is a potentially serious security bug if you omit the user,
expect the command to run as root, and the first word after "--"
is a valid user, and what follows that something valid and
potentially destructive not only running in unintended form but
as whatever user happened to be the first word after "--".

So, it seems like something important to fix, and getopt seems to
be getting in the way of fixing it properly without being more
trouble than replacing getopt.

In disbelief of what I was seeing getopt doing with argv here, I
took a glance at the getopt source and found the following:

```
      /* The special ARGV-element '--' means premature end of options.
	 Skip it like a null option,
	 then exchange with previous non-options as if it were an option,
	 then skip everything else like a non-option.  */

      if (d->optind != argc && !strcmp (argv[d->optind], "--"))
```

I basically never use getopt personally because ages ago it
annoyed me with its terrible API for what little it brought to
the table, and this brings it to a whole new level of awful.

---
## [Firestarter/PlayerParticles](https://github.com/Firestarter/PlayerParticles)@[61745af165...](https://github.com/Firestarter/PlayerParticles/commit/61745af16577edfddb7640be521a0790865dd5bd)
#### Tuesday 2020-05-12 15:02:37 by Mykyta

✌ Migrate to Maven
I hate Gradle. This project has no reason to use Gradle.
Stop using Gradle when you don't need to. It's a pain in the ass.

---
## [SomeMissingColon/TheShortWebsite](https://github.com/SomeMissingColon/TheShortWebsite)@[6fcf341c81...](https://github.com/SomeMissingColon/TheShortWebsite/commit/6fcf341c817e3a9db8d4dfa673a8a3a0e2864a5b)
#### Tuesday 2020-05-12 15:06:53 by SomeMissingColon

fixed that one infuriating bug and wanted to lock this state in beacuse holy shit If this kinda stuff happen again im just gonna become a chef or something

---
## [MrDoomBringer/tgstation-1](https://github.com/MrDoomBringer/tgstation-1)@[f81a6a1c64...](https://github.com/MrDoomBringer/tgstation-1/commit/f81a6a1c64d27287761f5750b003a36d9d336963)
#### Tuesday 2020-05-12 15:51:10 by MrDoomBringer

10K hours

60,000 minutes
hahah


sure if you want a trailing newline i can do that


default cloak gets default skill


lazy list and no equip good


necessary ig


Update code/datums/skills/_skill.dm

Co-Authored-By: nemvar <47324920+nemvar@users.noreply.github.com>
Update code/datums/skills/gaming.dm

Co-Authored-By: Angust <46400996+Angustmeta@users.noreply.github.com>
WIP PDA skill monitor program


hacky fixes till i refactor skills


refactors skills a bit, adds admin skill edit menu


If you have a failing, it's that you're always demanding perfection

...IF you have a failing
i think that's it for the admin skill manger


appeases lord flord


bruh


level names


FUCK!!


unga


Update code/modules/vehicles/vehicle_key.dm

Co-authored-by: Rohesie <rohesie@gmail.com>
Update code/modules/admin/topic.dm

Co-authored-by: Rohesie <rohesie@gmail.com>
Update code/modules/admin/skill_panel.dm

Co-authored-by: Rohesie <rohesie@gmail.com>
Update code/modules/admin/skill_panel.dm

Co-authored-by: Rohesie <rohesie@gmail.com>
Apply suggestions from code review

frick

Co-authored-by: Rohesie <rohesie@gmail.com>
EOL and dumb spaces


more rohsie bait


tgui: Query Windows Registry for BYOND cache directory

hell yeah brother


update tgui and dmi


CLRF and bat file


typo ig

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[5135459a8a...](https://github.com/mrakgr/The-Spiral-Language/commit/5135459a8aa54ff92f5830fc0179f170de0c2589)
#### Tuesday 2020-05-12 16:32:52 by Marko Grdinić

"1:30pm. Done with breakfast. Let me rest a bit longer and then I will start.

1:50pm. Let me resume. I will go through the documentation for NetMQ today.

2:05pm. https://netmq.readthedocs.io/en/stable/actor/

I do not feel like messing with this in particular right now. I'll keep it in mind for later.

2:15pm. I lot of the other stuff uses actors so I should take time to get familiar with it. I'll wait until they are introduce in the ZMQ guide first though.

```
using (var responseSocket = new ResponseSocket("@tcp://*:5555"))
using (var requestSocket = new RequestSocket(">tcp://localhost:5555"))
```

Ahhh, I get it! It finally occurred to me what those `@` and `>` are supposed to be. No doubt `@` and `>` are short hands for `Bind` and `Connect`.

2:50pm. https://netmq.readthedocs.io/en/stable/push-pull/

Am thinking about Spiral rather than reading this. Agh.

One thing I am going to have to figure out is how to start lambdas on separate processes.

2:55pm. Agh, forget it. Nevermind that.

Let me just read the book.

3pm. https://netmq.readthedocs.io/en/stable/router-dealer/

As it turns out the NetMQ has examples from the initial part of the ZeroMQ book.

Let me check it out.

3:10pm. Er, now I am thinking of the whole issue of having to run things on a separate thread and yet displaying it in the same console window. The examples use some `.bat` script to run different processes...but the idea that is coming to me right now is to make my own GUI. Each process has to be an executable so that is out, but since I've gotten better at Rx, why don't I practice my GUI skills?

This is a good opportunity for it. Like it should not be that hard for me to set a GUI with a bunch of boxes to print stuff on them.

I've fought long and hard to get to the point where I am capable of this.

That having said, though I've gotten a grasp on Rx itself, my UI skills are extremely rusty. I definitely need practice at it.

3:20pm. To make matter more complicated, I've only ever studied WPF. I've made up my mind though that if I want to do this seriously, I should pick up something cross platform. So that means studying UWP or something like that and ditching WPF.

3:25pm. It depends though - what is WPF's status on Linux?

https://stackoverflow.com/questions/53954047/can-wpf-applications-be-run-in-linux-with-net-core-3

So no dice. I am going to have to study UWP. The guys in that thread are recommending GTK and Avalonia.

Let me just get back to the docs and I'll come back to this after I finish it. There is not much left.

3:40pm. https://netmq.readthedocs.io/en/stable/router-dealer/

```
    var clientSocketPerThread = new ThreadLocal<DealerSocket>();

    using (var server = new RouterSocket("@tcp://127.0.0.1:5556"))
    using (var poller = new NetMQPoller())
    {
        // Start some threads, each with its own DealerSocket
        // to talk to the server socket. Creates lots of sockets,
        // but no nasty race conditions no shared state, each
        // thread has its own socket, happy days.
        for (int i = 0; i < 3; i++)
        {
            Task.Factory.StartNew(state =>
            {
                DealerSocket client = null;

                if (!clientSocketPerThread.IsValueCreated)
                {
                    client = new DealerSocket();
                    client.Options.Identity =
                        Encoding.Unicode.GetBytes(state.ToString());
                    client.Connect("tcp://127.0.0.1:5556");
                    client.ReceiveReady += Client_ReceiveReady;
                    clientSocketPerThread.Value = client;
                    poller.Add(client);
                }
```

Why didn't he just create it inside the lambda? Weird.

3:45pm. I'll translate the example at a later point. Let me read the last chapter of the guide.

3:55pm. Ah, why did I have to think about taking the GUI idea to the next level? Now I am entranced by it instead of focusing the NetMQ docs.

4pm. Done with the NetMQ docs. I am really not spending my time effectively. My mind it totally focus on things not in front of me.

I want to do it. I want to do some more work on Lithe - I've been influenced how the Elmish book spoke against that pattern, and I am going to follow its lead in this. What it said felt sound to me.

4:05pm. For the next few hours of what is left in the day, let me check out platform alternatives to WPF.

https://github.com/fsprojects/Fabulous#fabulous-for-xamarinforms

> This library allows you to use the ultra-simple Model-View-Update architecture to build applications for iOS, Android, Mac, WPF and more using Xamarin.Forms. It is built on Fabulous.

I am still confused about the Xamarin.Forms thing. I thought it was a mobile UI library, but I am getting conflicting signals on this. What did I conclude last time?

https://docs.microsoft.com/en-us/windows/uwp/get-started/universal-application-platform-guide

Ah, UWP is more broad that Windows 10, but still it is a Windows platform.

https://docs.microsoft.com/en-us/xamarin/xamarin-forms/

So it is a cross platform UI thing for .NET.

4:15pm. Ok, so Xamarin.Forms is what I need. Let me go for it then.

In retrospect, February-April was just like the time I studied GUIs in 2016. I translated that huge load of examples by Petzold, but as a direct consequence of GUIs being too hard to deal with, that knowledge ended up rotting as I never used it for anything practical and stuck to command lines.

I should have mastered reactive combinators first and then studied GUIs. That would have been a lot better plan.

4:20pm. When it comes to utility, one thing just leads to another, or in my case does not lead to. I had great will in 2016, but not much skill.

Talent in programming is just not enough to be an expert. Having a sufficiently broad base of fundamental knowledge is a prerequisite. What is fundamental varies, but fundamental skills are all about managing complexity as the codebase and the domain complexity grows.

So I guess, this concurrency stuff, and knowing how to make Spiral in a world that does not have it does fit the bill.

4:25pm. No way around this. Let me open a new project just for Xamarin and I will play around with it. In my mind, I've already been designing a template for those ZeroMQ examples.

https://docs.microsoft.com/en-us/xamarin/get-started/installation/?pivots=windows

4Gb. Agh...Let me do it.

This would be a good time to do chores then. Let me just set the thing to download first. Now it is upgrading the installer.

4:35pm. Since the Android SDK is optional I'll leave that out and save myself 700mb.

Let me take off here for a bit.

5:15pm. Done with chores. The thing installed. Let me update VS while I am at it.

5:20pm. I made a mistake. This is all mobile shit. I should have just gone with something like Gtk or Avalonia.

I just wasted 5Gb on my hard drive and 3Gb of bandwidth. I guess I'll leave it in since I have it.

5:35pm.

```
Unhandled exception. System.TypeInitializationException: The type initializer for 'Gtk.Window' threw an exception.
 ---> System.DllNotFoundException: Gtk: libgtk-3-0.dll, libgtk-3.so.0, libgtk-3.0.dylib, gtk-3.dll
   at GLibrary.Load(Library library)
   at Gtk.Window..cctor()
   --- End of inner exception stack trace ---
   at Gtk.Window..ctor(WindowType type)
   at Gtk.Window..ctor(String title)
   at Program.main(String[] argv) in C:\Users\Marko\Source\Repos\Lithe\ZeroMQ Examples\Program.fs:line 8
```

When I try to run this it throws a bunch of errors.

Ah, I forgot to run `Application.Init`.

5:35pm. It seems closing the window of the hello world program does not terminate the application. I foolishly tried compiling it as a window program and I can't close it now.

...Had to close the process through the Task Manager. Ok...

5:40pm.

```
open System
open Gtk

[<EntryPoint>]
let main argv =
    Application.Init()
    let window = new Window("My first GTK# application!")
    window.Resize(400,200)
    let label = new Label()
    label.Text <- "Hello World!"
    window.Add(label)
    window.ShowAll()
    use __ = window.Destroyed.Subscribe(fun _ -> Application.Quit())
    Application.Run()
    0 // return an integer exit code
```

Figured out how to exit the main application properly. Ok.

This is all good.

5:50pm.

```
The “Application.Init()” command tells the runtime to listen for any Gtk.Windows launched and when you run the run command it starts a the main loop on those windows. This keeps the application running until all the windows are closed.
```

So the fact it is not shutting down is some kind of bug then?

https://stackoverflow.com/questions/2548200/how-do-i-access-gui-gtk-from-multi-threads

I also need a way to update things on the GUI thread - I should be more careful than usual since GTK won't throw an exception.

```
Application.Invoke(EventHandler(fun _ _ -> ()))
```

So the way to do this is similar to WPF. Ok, great.

6:05pm. https://www.mono-project.com/docs/gui/gtksharp/tutorials/

I'll leave the GTK+ tutorials for tomorrow. Let me get rid of the mobile stuff. It says -2Gb, but it was 3 to install. Tsk.

So far, my brief glance at Gtk shows me that it has everything that I need. I'll pick it up and not bother with the choice of them from here on out. Tomorrow, as an exercise I will port that counter app to Gtk, and make sure those collection elements have their children set as a property. I'll take look at the Elmish book again as the reference for what the right design should be and internalize it.

6:10pm. I should take the time to learn one GUI library at least, and I have no real interest in the newfangled stuff. Just one that is decent and covers the widest possible breadth of platforms is enough. Gtk will be ideal for that. The magic to make it work well will happen on my own end with reactive combinators.

6:15pm. I'll stop here for the day. I've gone through my creative budget for the day.

Let me shoot the wind for a bit. What am I doing now?

I think what I am doing now is ideal. Reactive combinators, editor support, message passing and now a UI toolkit. I am really charging at it in May. I am going to pick up the whole user experience suite of skills. I am going to get that whole branch in one swoop. Everything is going to get done properly in the lead up to Spiral v0.2.

Everything.

I am not going to stand for the abysmal programming of experience of 2018. I am better than that now.

6:25pm. For the next week at least and probably two, I'll be studying ZeroMQ and GTK side by side. This expenditure of time is fine. Important ML work will get done only when it is its turn."

---
## [mirzi1/WinampXP](https://github.com/mirzi1/WinampXP)@[13b2a063a9...](https://github.com/mirzi1/WinampXP/commit/13b2a063a95efdb71670ff3fca74ba6573c47b3a)
#### Tuesday 2020-05-12 17:16:21 by mirzi

Merge pull request #20 from The1Freeman/i-hate-my-life

fixed OAIDV being the wrong font and size

---
## [BSData/wh40k](https://github.com/BSData/wh40k)@[dab0a671de...](https://github.com/BSData/wh40k/commit/dab0a671de6de2dd97f5cfc944b4e0b6e5601c71)
#### Tuesday 2020-05-12 18:06:55 by Dirk Bachert

Update Imperium - Dark Angels.cat

I'll just edit this quickly, he said
what could go wrong, he said.
Fuck you, lazy past Thairne.

---
## [Juglone/mathia-rulebook](https://github.com/Juglone/mathia-rulebook)@[31cdb166f8...](https://github.com/Juglone/mathia-rulebook/commit/31cdb166f8a1d5c739c6cf0e9a0f277393c8f1f5)
#### Tuesday 2020-05-12 18:17:15 by Juglone

Update thief.md

* Do ordinary mafias in a channel share one same gun? So that they can't perform a kill if they are stolen from? Or are the mafia-members' guns individual? So that maf B still can perform a kill n2 even though maf A was stolen from n1? I thought the latter and that is how I've updated the role description.
* Does thief show up as guilty according to det? I know that they have once, but then it's written that neutral prs show up as town to det. I thought that the newest thing is that thief is seen as town to det - but please change if this is wrong.
* Is vigi death (the regular vigi, not the clumsy vigi/vigilante's bitch/vigi's bad twin/the sacrificing vigi/voodoo doll/wallbreaker) still a thing? 
* I was a little bit unsure of what happened when thief is shamaned so i would be happy if someone could check if i'm right or not.
* Thief can't steal anything from e.g. tracker even though tracker has a night action, right?
* Should there somewhere be smth about the rules of the gang war or are those instructions meant to be looked up in the server?
* Aaaand just wanted to double-check: shaman can target the same person several times in a row? If they can't that should be specified in shaman role but since the shaman has been able to do so in the last few games I assume they can. so if that's the case just ignore this last point :)

I'm sorry for this long message but there are a lot of things that I don't know but I still wanna help.

---
## [oceanaut/hackerrankpyhton](https://github.com/oceanaut/hackerrankpyhton)@[eff3b07b21...](https://github.com/oceanaut/hackerrankpyhton/commit/eff3b07b212a9cd75cb4f899a2527169905ac855)
#### Tuesday 2020-05-12 18:24:39 by oceanaut

Blessed is he who, in the name of charity and good will, shepherds the weak through the valley of the darkness, for he is truly his brother's keeper and the finder of lost children.

---
## [fivesanon/Warcraft-Guardians-of-Azeroth](https://github.com/fivesanon/Warcraft-Guardians-of-Azeroth)@[6ff6eb1217...](https://github.com/fivesanon/Warcraft-Guardians-of-Azeroth/commit/6ff6eb1217054e16ded9ae433242fbb81d07ef97)
#### Tuesday 2020-05-12 21:55:00 by fivesanon

fucked up some shit, someone help pls (i assume its indentations)

-added localisations
-tried to fix/change dynasties and characters
 -shadowhide got ruined the most, tried to make gnawbone female and garfangs wife, with an heir that is not garfangs son, now she wont show up in the game at all
 -the other ones also wont show up anymore, dont know what i did wrong,
All i need is for someone to show me what i did wrong so that i can improve.

---
## [bazel-packages/org_llvm](https://github.com/bazel-packages/org_llvm)@[b98a0c7f6c...](https://github.com/bazel-packages/org_llvm/commit/b98a0c7f6c9c7b38b6cd764e6f47e16e3d8c342c)
#### Tuesday 2020-05-12 22:05:27 by Roman Lebedev

[clang][CodeGen] Implicit Conversion Sanitizer: handle increment/decrement (PR44054)(take 2)

Summary:
Implicit Conversion Sanitizer is *almost* feature complete.
There aren't *that* much unsanitized things left,
two major ones are increment/decrement (this patch) and bit fields.

As it was discussed in
[[ https://bugs.llvm.org/show_bug.cgi?id=39519 | PR39519 ]],
unlike `CompoundAssignOperator` (which is promoted internally),
or `BinaryOperator` (for which we always have promotion/demotion in AST)
or parts of `UnaryOperator` (we have promotion/demotion but only for
certain operations), for inc/dec, clang omits promotion/demotion
altogether, under as-if rule.

This is technically correct: https://rise4fun.com/Alive/zPgD
As it can be seen in `InstCombineCasts.cpp` `canEvaluateTruncated()`,
`add`/`sub`/`mul`/`and`/`or`/`xor` operators can all arbitrarily
be extended or truncated:
https://github.com/llvm/llvm-project/blob/901cd3b3f62d0c700e5d2c3f97eff97d634bec5e/llvm/lib/Transforms/InstCombine/InstCombineCasts.cpp#L1320-L1334

But that has serious implications:
1. Since we no longer model implicit casts, do we pessimise
   their AST representation and everything that uses it?
2. There is no demotion, so lossy demotion sanitizer does not trigger :]

Now, i'm not going to argue about the first problem here,
but the second one **needs** to be addressed. As it was stated
in the report, this is done intentionally, so changing
this in all modes would be considered a penalization/regression.
Which means, the sanitization-less codegen must not be altered.

It was also suggested to not change the sanitized codegen
to the one with demotion, but i quite strongly believe
that will not be the wise choice here:
1. One will need to re-engineer the check that the inc/dec was lossy
   in terms of `@llvm.{u,s}{add,sub}.with.overflow` builtins
2. We will still need to compute the result we would lossily demote.
   (i.e. the result of wide `add`ition/`sub`traction)
3. I suspect it would need to be done right here, in sanitization.
   Which kinda defeats the point of
   using `@llvm.{u,s}{add,sub}.with.overflow` builtins:
   we'd have two `add`s with basically the same arguments,
   one of which is used for check+error-less codepath and other one
   for the error reporting. That seems worse than a single wide op+check.
4. OR, we would need to do that in the compiler-rt handler.
   Which means we'll need a whole new handler.
   But then what about the `CompoundAssignOperator`,
   it would also be applicable for it.
   So this also doesn't really seem like the right path to me.
5. At least X86 (but likely others) pessimizes all sub-`i32` operations
   (due to partial register stalls), so even if we avoid promotion+demotion,
   the computations will //likely// be performed in `i32` anyways.

So i'm not really seeing much benefit of
not doing the straight-forward thing.

While looking into this, i have noticed a few more LLVM middle-end
missed canonicalizations, and filed
[[ https://bugs.llvm.org/show_bug.cgi?id=44100 | PR44100 ]],
[[ https://bugs.llvm.org/show_bug.cgi?id=44102 | PR44102 ]].

Those are not specific to inc/dec, we also have them for
`CompoundAssignOperator`, and it can happen for normal arithmetics, too.
But if we take some other path in the patch, it will not be applicable
here, and we will have most likely played ourselves.

TLDR: front-end should emit canonical, easy-to-optimize yet
un-optimized code. It is middle-end's job to make it optimal.

I'm really hoping reviewers agree with my personal assessment
of the path this patch should take..

This originally landed in 9872ea4ed1de4c49300430e4f1f4dfc110a79ab9
but got immediately reverted in cbfa237892e55b7129a1178c9b03f26683d643af
because the assertion was faulty. That fault ended up being caused
by the enum - while there will be promotion, both types are unsigned,
with same width. So we still don't need to sanitize non-signed cases.
So far. Maybe the assert will tell us this isn't so.

Fixes [[ https://bugs.llvm.org/show_bug.cgi?id=44054 | PR44054 ]].
Refs. https://github.com/google/sanitizers/issues/940

Reviewers: rjmccall, erichkeane, rsmith, vsk

Reviewed By: erichkeane

Subscribers: mehdi_amini, dexonsmith, cfe-commits, #sanitizers, llvm-commits, aaron.ballman, t.p.northover, efriedma, regehr

Tags: #llvm, #clang, #sanitizers

Differential Revision: https://reviews.llvm.org/D70539

---

# [<](2020-05-11.md) 2020-05-12 [>](2020-05-13.md)

