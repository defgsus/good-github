# [<](2021-06-17.md) 2021-06-18 [>](2021-06-19.md)

2,889,786 events, 1,482,905 push events, 2,365,598 commit messages, 178,551,415 characters


## [kernel-patches/bpf@bba3e3d769...](https://github.com/kernel-patches/bpf/commit/bba3e3d76955ce6abba33e39545ee4b7cf46f68f)
##### 2021-06-18 01:37:44 by Maciej Żenczykowski

bpf: do not change gso_size during bpf_skb_change_proto()

This is technically a backwards incompatible change in behaviour,
but I'm going to argue that it is very unlikely to break things,
and likely to fix *far* more then it breaks.

In no particular order, various reasons follow:

(a) I've long had a bug assigned to myself to debug a super rare kernel
crash on Android Pixel phones which can (per stacktrace) be traced back
to bpf clat ipv6 to ipv4 protocol conversion causing some sort of ugly
failure much later on during transmit deep in the GSO engine, AFAICT
precisely because of this change to gso_size, though I've never been able
to manually reproduce it.
I believe it may be related to the particular network offload support
of attached usb ethernet dongle being used for tethering off of an
IPv6-only cellular connection.  The reason might be we end up with more
segments than max permitted, or with a gso packet with only one segment...
(either way we break some assumption and hit a BUG_ON)

(b) There is no check that the gso_size is > 20 when reducing it by 20,
so we might end up with a negative (or underflowing) gso_size or
a gso_size of 0.  This can't possibly be good.
Indeed this is probably somehow exploitable (or at least can result
in a kernel crash) by delivering crafted packets and perhaps triggering
an infinite loop or a divide by zero...
As a reminder: gso_size (mss) is related to mtu, but not directly
derived from it: gso_size/mss may be significantly smaller then
one would get by deriving from local mtu.  And on some nics (which
do loose mtu checking on receive, it may even potentially be larger,
for example my work pc with 1500 mtu can receive 1520 byte frames
[and sometimes does due to bugs in a vendor plat46 implementation]).
Indeed even just going from 21 to 1 is potentially problematic because
it increases the number of segments by a factor of 21 (think DoS,
or some other crash due to too many segments).

(c) It's always safe to not increase the gso_size, because it doesn't
result in the max packet size increasing.  So the skb_increase_gso_size()
call was always unnecessary for correctness (and outright undesirable, see
later).  As such the only part which is potentially dangerous (ie. could
cause backwards compatibility issues) is the removal of the
skb_decrease_gso_size() call.

(d) If the packets are ultimately destined to the local device, then
there is absolutely no benefit to playing around with gso_size.
It only matters if the packets will egress the device.  ie. we're
either forwarding, or transmitting from the device.

(e) This logic only triggers for packets which are GSO.  It does not
trigger for skbs which are not GSO.  It will not convert a non-GSO mtu
sized packet into a GSO packet (and you don't even know what the mtu is,
so you can't even fix it).  As such your transmit path must *already* be
able to handle an mtu 20 bytes larger then your receive path (for ipv4
to ipv6 translation) - and indeed 28 bytes larger due to ipv4 fragments.
Thus removing the skb_decrease_gso_size() call doesn't actually increase
the size of the packets your transmit side must be able to handle.
ie. to handle non-GSO max-mtu packets, the ipv4/ipv6 device/route mtus
must already be set correctly.  Since for example with an ipv4 egress mtu
of 1500, ipv4 to ipv6 translation will already build 1520 byte ipv6 frames,
so you need a 1520 byte device mtu.  This means if your ipv6 device's
egress mtu is 1280, your ipv4 route must be 1260 (and actually 1252,
because of the need to handle fragments).  This is to handle normal non-GSO
packets.  Thus the reduction is simply not needed for GSO packets,
because when they're correctly built, they will already be the right size.

(f) TSO/GSO should be able to exactly undo GRO: the number of packets
(TCP segments) should not be modified, so that TCP's mss counting works
correctly (this matters for congestion control).
If protocol conversion changes the gso_size, then the number of TCP segments
may increase or decrease.  Packet loss after protocol conversion can result
in partial loss of mss segments that the sender sent.  How's the sending
TCP stack going to react to receiving ACKs/SACKs in the middle of the
segments it sent?

(g) skb_{decrease,increase}_gso_size() are already no-ops for GSO_BY_FRAGS
case (besides triggering WARN_ON_ONCE). This means you already cannot
guarantee that gso_size (and thus resulting packet mtu) is changed.
ie. you must assume it won't be changed.

(h) changing gso_size is outright buggy for UDP GSO packets, where framing
matters (I believe that's also the case for SCTP, but it's already excluded
by [g]).  So the only remaining case is TCP, which also doesn't want it
(see [f]).

(i) see also the reasoning on the previous attempt at fixing this
(commit fa7b83bf3b156c767f3e4a25bbf3817b08f3ff8e) which shows
that the current behaviour causes TCP packet loss:

  In the forwarding path GRO -> BPF 6 to 4 -> GSO for TCP traffic, the
  coalesced packet payload can be > MSS, but < MSS + 20.

  bpf_skb_proto_6_to_4() will upgrade the MSS and it can be > the payload
  length. After then tcp_gso_segment checks for the payload length if it
  is <= MSS. The condition is causing the packet to be dropped.

  tcp_gso_segment():
    [...]
    mss = skb_shinfo(skb)->gso_size;
    if (unlikely(skb->len <= mss)) goto out;
    [...]

Thus changing the gso_size is simply a very bad idea.
Increasing is unnecessary and buggy, and decreasing can go negative.

Cc: Dongseok Yi <dseok.yi@samsung.com>
Cc: Daniel Borkmann <daniel@iogearbox.net>
Cc: Willem de Bruijn <willemb@google.com>
Fixes: 6578171a7ff0 ("bpf: add bpf_skb_change_proto helper")
Signed-off-by: Maciej Żenczykowski <maze@google.com>

---
## [vr-voyage/remote-logix@21498702b7...](https://github.com/vr-voyage/remote-logix/commit/21498702b78091c6ce0c8f600aeb0947576d1afd)
##### 2021-06-18 19:34:11 by Voyage

The first alpha is almost finished !

YAY !

With constant values support !
I'll go with that first, anyway. Dynamic variables support
might follow afterwards.
I have to support constant first, since ReadDynamicVariable
needs you to provide the name... through a constant string
value !

You can try to load the Example program (and don't click on
Save before, or you'll nuke it !) to see how it goes at
the moment.

There's still SO many things to fix. I've hit many issues
with Godot, with things like :
* Inability to parse 64-bit integers from strings (in 2021)
* Hash() functions returning the same numbers on different
  strings
* The sheer inability for Godot to provide code completion
  on typed onready var variables
* The whole inspector to script nodes attributions being
  broken

Still, the GraphEdit system is kind of working correctly,
and thanks to that, the first alpha should be released
once the interpretor is done on the NeosVR side.
I'll add Websocket streaming support for that reason, since
parsing files on NeosVR is stupidly hard, if you want
some user-friendlly interaction.

So, yeah... SOON ! ON YOUR SCREEN ! Remote LOGIX Alpha 1

Signed-off-by: Voyage <voyage@miouyouyou.fr>

---
## [HoduRe/Audio-Semi-Automatic-Selector@22425da25f...](https://github.com/HoduRe/Audio-Semi-Automatic-Selector/commit/22425da25f70fda992e5ed66e8aa728dde3b8f47)
##### 2021-06-18 22:27:56 by Ferran-Roger Basart i Bosch

I was missing the whole I FUCKING HATE MY LIFE kind of feel UwU

---
## [Mojave-Sun/mojave-sun@67bfc8853e...](https://github.com/Mojave-Sun/mojave-sun/commit/67bfc8853efe27cf414fbd395aa6a130f79d5eb6)
##### 2021-06-18 22:35:36 by EdwardNashton

Bad Boys Den: Update of Raider's Base. (#325)

* Bad Boys Den: Update of Raider's Base.

Remade one shop to Butcher Shop. Add a small Warehouse with graveyard. Slightly remade a Garage, improved living house and the Bar.

* Bad Boys Den: Small Fixes

* Bad Boys Den: Hatred of Low Walls

Fixed god damn low walls. Also added a few things like carcass. pickaxes etc.

* Bad Boys Den: Extra Fixes fo free!

Spotted a some few small errors. Fixed it.

* Bad Boys Den: End My Suffering

* Bad Boys Den: Area Errors...Area Errors Everywhere!

Fixed an areas near Administration.

Co-authored-by: Edward Nashton <eddienigma48@gmail.com>

---
## [9Kbits/ateff@78b5595fdd...](https://github.com/9Kbits/ateff/commit/78b5595fdd3c01cfbbfaa06833eb777bdc5ff643)
##### 2021-06-18 23:15:19 by Doodlebot11

fuck you yo worthless piece of shit external hard drive I fucking hate you

---
## [Makmann1/GameDev@b521376102...](https://github.com/Makmann1/GameDev/commit/b5213761023106e8179b3b43111468758490b83b)
##### 2021-06-18 23:44:21 by EngineerisGaming

whatever thats the thing that people will see and your gonna click commit to main ok funny man alright

I typed the words "some random shit", it is the funniest thinjg ive ever done im my life

---

# [<](2021-06-17.md) 2021-06-18 [>](2021-06-19.md)

