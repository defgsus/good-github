# 2021-03-06

2,088,088 events, 1,188,285 push events, 1,717,611 commit messages, 129,859,453 characters


## [kil0byt3/RotN-SCE@8b7ad6b838...](https://github.com/kil0byt3/RotN-SCE/commit/8b7ad6b838633a2609cd10cc7d785b3f97452453)
##### 2021-03-06 01:27:06 by kil0byt3

Main Menu Sanity! 

Just removed the entire fucking thing! The main menu you know and love! Config is now a meme repository instead! HELL YEAH!

---
## [rizalgowandy/cockroach@90d6ba4efd...](https://github.com/rizalgowandy/cockroach/commit/90d6ba4efd994bdf5c7a662a0cd69b01b0a4a831)
##### 2021-03-06 03:32:26 by craig[bot]

Merge #61207 #61305 #61386 #61499 #61556

61207: cli: don't refresh prompt on line continuations r=jordanlewis a=jordanlewis

Previously, the CLI would recalculate its prompt (including any required
network roundtrips to determine transaction status and current database)
on every newline, even if the newline came in the middle of a SQL
statement. This was wasteful, of course, but it's also very confusing
for users when entering a large multi-line statement via paste: the
prompt refreshes defer until enter is pressed for the first time, and
there is a lot of unexplained latency during the statement that doesn't
reflect the actual SQL being executed. It also doesn't match the
reported execution time, leading to mass confusion and sadness.

Now, we don't bother refreshing the prompt during line continuations.

Closes #61095

Release note (cli change): optimize handling of multi-line SQL strings
to avoid unwanted extra server roundtrips.

Release justification: bug fixes and low-risk updates to new functionality

61305:  kvserver: add closedts side-transport consumer  r=andreimatei a=andreimatei

Add the consumer of closed timestamps communicated by the side transport
(i.e. the gRPC server for our new push-based streaming protocol).

This side-transport consumer accumulates closed timestamps communicated
to it by other nodes (the leaseholders of the respective ranges). Its
state is queried whenever a range needs a higher closed timestamp than
what it has locally in the Replica state, at which point the Replica's
state is lazily updated.

Release note: None
Release justification: Needed for GLOBAL tables.

61386: kv: configure leading closed timestamp target for global_read ranges r=nvanbenschoten a=nvanbenschoten

Informs #59680.
Informs #52745.

This commit updates `closedts.TargetForPolicy` to calculate a target closed
timestamp that leads present time for ranges with the LEAD_FOR_GLOBAL_READS
closed timestamp policy. This is needed for non-blocking transactions, which
require ranges to closed time in the future.

TargetForPolicy's LEAD_FOR_GLOBAL_READS calculation is more complex than its
LAG_BY_CLUSTER_SETTING calculation. Instead of the policy defining an offset
from the publisher's perspective, the policy defines a goal from the consumer's
perspective - the goal being that present time reads (with a possible
uncertainty interval) can be served from all followers. To accomplish this, we
must work backwards to establish a lead time to publish closed timestamps at.

The calculation looks something like the following:
```
// this should be sufficient for any present-time transaction,
// because its global uncertainty limit should be <= this time.
// For more, see (*Transaction).RequiredFrontier.
closed_ts_at_follower = now + max_offset

// the sender must account for the time it takes to propagate a
// closed timestamp update to its followers.
closed_ts_at_sender = closed_ts_at_follower + propagation_time

// closed timestamps propagate in two ways. Both need to make it to
// followers in time.
propagation_time = max(raft_propagation_time, side_propagation_time)

// raft propagation takes 3 network hops to go from a leader proposing
// a write (with a closed timestamp update) to the write being applied.
// 1. leader sends MsgProp with entry
// 2. followers send MsgPropResp with vote
// 3. leader sends MsgProp with higher commit index
//
// we also add on a small bit of overhead for request evaluation, log
// sync, and state machine apply latency.
raft_propagation_time = max_network_rtt * 1.5 + raft_overhead

// side-transport propagation takes 1 network hop, as there is no voting.
// However, it is delayed by the full side_transport_close_interval in
// the worst-case.
side_propagation_time = max_network_rtt * 0.5 + side_transport_close_interval

// put together, we get the following result
closed_ts_at_sender = now + max_offset + max(
	max_network_rtt * 1.5 + raft_overhead,
	max_network_rtt * 0.5 + side_transport_close_interval,
)
```

While writing this, I explored what it would take to use dynamic network latency
measurements in this calculation to complete #59680. The code for that wasn't
too bad, but brought up a number of questions, including how far into the tail
we care about and whether we place upper and lower bounds on this value. To
avoid needing to immediately answer these questions, the commit hardcodes a
maximum network RTT of 150ms, which should be an overestimate for almost any
cluster we expect to run on.

The commit also adds a new `kv.closed_timestamp.lead_for_global_reads_override`
cluster setting, which, if nonzero, overrides the lead time that global_read
ranges use to publish closed timestamps. The cluster setting is hidden, but
should provide an escape hatch for cases where we get the calculation
(especially when it becomes dynamic) wrong.

Release justification: needed for new functionality

61499: sql: Require FORCE to modify protected zone config fields r=otan a=ajstorm

With the introduction of the multi-region simplification in 21.1, there
are a set of fields in the zone configurations which are protected by the
system. These fields are transparently modified by the system when
certain multi-region abstractions are used (e.g. when a region is added
to the database, the constraints field is modified to add the new
region). Due the protected status of these field, we want to prevent
users from setting them if they're not aware of the impact in doing so
(that they could be overwritten by the system, and that they could
result in sub-optimal performance). To make this more explicit to users,
we block modifications to these fields and if the users wish to modify
them anyway, they must provide a FORCE argument along with the
modification statement. This impacts both the setting of the field in
the zone configuration, as well as any eventual multi-region statement
which follows and will result in over-writing the user's zone
configuration update.

Release justification: Prevent bad user experience with new feature.

Release note (sql change): Updates to certain fields in the zone
configurations are blocked for multi-region enabled databases. This
block can be overridden through the use of the FORCE keyword on the
blocked statement.

Resolves #60447 

61556: sql: read db descriptor from store when constructing mr zone configs r=arulajmani a=arulajmani

Previously, when constructing multi-region zone configs for a database
in the type schema changer, we were doing so using a leased version of
the database descriptor. This meant it could be the case that we were
constructing a stale zone configuration, which manifested itself in
some CI failures. This patch fixes that issue by always reading the
database descriptor from the store when constructing zone
configurations in the type schema changer.

Previously, this was failing consistently under stress in ~30s. I have
this thing running perfectly for the last 10 minutes.

Fixes: #61320

Release justification: bug fix to new functionality
Release note: None

Co-authored-by: Jordan Lewis <jordanthelewis@gmail.com>
Co-authored-by: Andrei Matei <andrei@cockroachlabs.com>
Co-authored-by: Nathan VanBenschoten <nvanbenschoten@gmail.com>
Co-authored-by: Adam Storm <storm@cockroachlabs.com>
Co-authored-by: arulajmani <arulajmani@gmail.com>

---
## [mikpe/otp@092584bb2e...](https://github.com/mikpe/otp/commit/092584bb2e0635bfbf73931c61c95d0b178caeb4)
##### 2021-03-06 16:40:14 by John Högberg

re: Document [:ascii:] character class deficiency

The regex library we use can work either in locale-specific mode,
or unicode mode. The locale-specific mode uses a pregenerated
table to tell which characters are printable, numeric, and so on.

For historical reasons, OTP has always used Latin-1 for this table,
so characters like `ö` are considered to be letters. This is fine,
but the library has two quirks that don't play well with each
other:

* The locale-specific table is always consulted for code points
  below 256 regardless of whether we're in unicode mode or not,
  and the `ucp` option only affects code points that aren't
  defined in this table (zeroed).
* The character class `[:ascii:]` matches characters that are
  defined in the above table.

This is fine when the regex library is built with its default ASCII
table: `[:ascii:]` only matches ASCII characters (by definition)
and the library documentation states that `ucp` is required to
match characters beyond that with `\w` and friends.

Unfortunately, we build the library with the Latin-1 table so
`[:ascii:]` matches Latin-1 characters instead, and we can't change
the table since we've documented that `\w` etc work fine with
Latin-1 characters, only requiring `ucp` for characters beyond
that.

At this point you might be thinking that this is a bug in how the
regex library handles `[:ascii:]`. Well, yes, POSIX says it should
match all code points between 0-127, but that's misleading since
it's only true for strict supersets of ASCII: should `[:ascii:]`
match 0x5C if the table is Shift-JIS? It would be just as wrong as
matching `ö`. :-(

Why not try to do the right thing and mark ASCII-compatibility for
each code point, since (for instance) 0x41 is `A` both in ASCII and
Shift-JIS? There's no way to ask a locale whether a code point
refers to the same character in ASCII, so the users would need to
manually go through the tables after generating them. Happy fun
times.

I've settled for documenting this mess since we can't fix this
on our end without breaking people's code, and there's not much
point in reporting this upstream since it'll either be misleading
or far too much work for the user, and PCRE-8.x is nearing the
very end of its life.

---
## [niraami/dotfiles@9a74536f97...](https://github.com/niraami/dotfiles/commit/9a74536f97c175e14256321a827686cb9c1fc2d3)
##### 2021-03-06 20:39:38 by niraami

Docker: fixed sudoers username

You have no idea what I went through to find this as this commit is
probaby a force push deleting the last 7 days of my life from Gits
history (~20 pushes).
This copy-paste error causes a error that, when googled, leads you down
a path of a recent ArchLinux image
[bug](https://bugs.archlinux.org/task/69563), that seems to be the
cause, but isn't.

I've also wrote this much of a DevOps Stackexchange question, before
realizing my mistake:

```
I've been trying to migrate my CI setup from Travis to GitHub actions as I need to run it in an Arch Linux environment. This means that I have to run it in a Docker container, and that just [refused to work][1] with Travis.

So I've looked over the GitHub [actions workflow documentation][2], and [their own guide][3] on how to run a docker container via actions. There is a [complication][4], that I think stems from this [bug][5], that I need to first install the *runc* package on the host machine - meaning I need to run scripts in both the host & the container.

  [1]: https://travis-ci.community/t/unable-to-access-file-structure-of-docker-container-when-running-in-travis/11229
  [2]: https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions
  [3]: https://docs.github.com/en/actions/creating-actions/dockerfile-support-for-github-actions
  [4]: https://github.com/niraami/dotfiles/runs/1995551118
  [5]: https://bugs.archlinux.org/task/69563
```

So yeah. Let this commit be a painful lesson...

---
## [rileyjshaw/rileyjshaw.github.io@95123ac307...](https://github.com/rileyjshaw/rileyjshaw.github.io/commit/95123ac3072065a821befd5e5f09531339a939c0)
##### 2021-03-06 21:19:40 by Riley Shaw

Feature: add a dark theme

Dark themes are something I’ve sought since my early days on a computer. I remember finding a way to apply a black background to Microsoft Word 2003, then being horrified when I accidentally printed the document. In uni I scripted my desktop to boot into [f.lux](https://justgetflux.com/)’s darkroom mode. One of my only lasting contributions to [Signal](https://rileyjshaw.com/blog/the-pool-on-the-roof-must-have-a-leak) was loudly advocating for dark mode on iOS and Desktop, not just Android. I even [made a browser extension in 2015](https://chrome.google.com/webstore/detail/dark-theme-everywhere/nibjplbnmmklkfnkpecgbffkifmdbjed) to apply a dark theme to the entire Internet.

It’s not the most pressing or exciting work, but I decided my site should have a dark theme of its own. I took a lot of inspiration from my former Khan Academy teammate [Josh W. Comeau’s dark mode post](https://www.joshwcomeau.com/react/dark-mode/), with a few differences.

UI-wise, I decided to go a different route than a binary toggle between dark and light. There were three motivations behind this. From most to least important:

• I wanted to include a “system” option. Theming is still a fresh concept for most web users, so I think it’s worthwhile to expose a way to control theme, motion, brightness etc from within the webpage. But [there should _always_ be a simple way to revert back to your system’s display preferences](https://kilianvalkhof.com/2020/design/your-dark-mode-toggle-is-broken).
• I may add more options later (greyscale? low-res? melty??) and this leaves my options open and unlimited.
• I liked the animated eyeball idea.

Speaking of the animated eyeball… I’m happy with how it turned out! It was quite a deep dive, since I didn’t want to include a heavy animation library like [react-spring](https://www.react-spring.io/) (>25kb) or [Framer Motion](https://www.framer.com/motion/) (>90kb). **Thankfully, the coolest thing I learned while working on this feature is that [SVG has a declarative animation specification called SMIL](https://css-tricks.com/guide-svg-animations-smil/)!** It didn’t take long to pick up, and it’s very easy to work with. I’m really happy to add it to my toolkit.

Animations were the _coolest_ deep dive, but they weren’t the deepest. Back when I started building this website, I split the header into Cyan, Magenta, and Yellow (CMY) channels. They [combined subtractively](https://rileyjshaw.com/blog/your-art-teacher-lied) to make a black-ish color, which I used across the site for text. I removed that feature in late 2019, but recently added it back.

With a single theme, that’s three combinations, for a total of 7 colors. With two themes… the combinations explode a bit.

I use [mix-blend-modes](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode) to combine colors, of which there are limited options. For my initial color palettes, I wanted to pick three pretty primary colors (light: CMY, dark: RGB) that would blend into three pretty secondary colors (light: RGB, dark: CMY), and all blend together into something with enough contrast from the background to use as body text. Tall order! [So I built a tool for that](https://github.com/rileyjshaw/palette-test-tool), and spent a few idle hours tweaking settings until I was happy.

And the initial palettes are… pretty good? I wish I was more thrilled with the result, but there are so many conflicting requirements that it’s impossible to get a result as good as if I’d hand-picked the colors independently. I’ve done an initial a11y pass of the colors, and there are some areas of the site where I want to improve the contrast. So I’ll probably end up with a palette split between the “true” colors, and their slightly modified, more attractive cousins.

I also needed to add a global settings provider in this commit. Now that I’ve done the work for that, look forward to more settings (reduce motion, contrast preference, block embeds… cheat codes??) coming soon!

I made a few minor changes while working on this commit:

• Update a bunch of the site doodles to fit either theme.
• Share theme colors between CSS-land and JS-land. No more mismatches!
• Keep the `<Layout>` component mounted between pages. Transitions and performance will be just _sliiightly_ smoother.
• Clarify the color variables a bit; `--cb` is now `--color-blue`.
• Add theme-dynamic color variables. For instance, `--color-p1` (“primary one”) maps to `--color-red` in dark mode and `--color-cyan` in light mode.
• Update some non-standard colors (eg. scaling faders demo) to fit the new palettes.
• Super simplify state-handling in the site nav (fixes a persistent console error).
• Standardize the handling of `localStorage` and `sessionStorage`.

Hope you enjoy!

---
## [Ankoki-Dev/SkJade@977280cab4...](https://github.com/Ankoki-Dev/SkJade/commit/977280cab4fa79992e31c05e8a06f138e1203cff)
##### 2021-03-06 22:20:20 by Ankoki-Dev

Gu-Gucci flip flops, fuck it, hit your bitch in my socks
This a big watch, diamond drippin' off of the clock
Pull the 6 out, wintertime, droppin' the top
Give it to they pussy ass, turn the shit up a notch
Gucci flip flops (fuck it), make it kick rocks (bust it)
This a big clock, check the wrist watch (check it)
Gucci flip flops, fuck it, hit your bitch in my socks (bust it)
This a big watch, diamond drippin' off of the clock (off the clock)
Bhad Bhabie got these bitches bustin' for cash (cash)
Do the dash, try to play me, bitch, I'm bustin' yo' ass (bustin' yo')
Lotta gun sounds, Rollie, bust down, know why these bitches mad
'Cause they trash and they fuckin' for cash (cash)
Too official, blow the whistle, bitch, I'm fly as a bird (brrr)
Take a picture, get ya' issue, bitch will die on my word (on my word)
Walk in the bank, fuck it up, pokin' that bitch with a shank, fuck it up (fuck it up)
I bought the lil' bitch a bag, make it double back and clear up her tab (yah)
Gu-Gucci flip flops, fuck it, hit your bitch in my socks
This a big watch, diamond drippin' off of the clock
Pull the 6 out, wintertime, droppin' the top
Give it to they pussy ass, turn the shit up a notch
Gucci flip flops (fuck it), make it kick rocks (bust it)
This a big clock, check the wrist watch (check it)
Gucci flip flops, fuck it, hit your bitch in my socks (bust it)
This a big watch (Lil Boat), diamond drippin' off of the clock (off of the clock)
I got big guap, pussy, yeah, I'm real rich (yeah)
Six cars, two houses and I'm still rich, uh (uh)
Think it's sweet? One call, hit the Killswitch (boom)
Boo, be cool, I ain't worried 'bout yo' lil bitch, n word
That lil' chain that you rockin', that's so little to me
Talkin' shit but want a verse? That's a riddle to me
Can't fuck the bitch if she got her virginity (whoo, yeah)
'Cause then she gon' really be into me (whoo, yeah)
.223 shots, I might run for the enemies (ah)
Put a few holes in his kidney (whoo, Lil Boat)
Gu-Gucci flip flops, fuck it, hit your bitch in my socks
This a big watch, diamond drippin' off of the clock
Pull the 6 out, wintertime, droppin' the top
Give it to they pussy ass, turn the shit up a notch
Gucci flip flops (fuck it), make it kick rocks (bust it)
This a big clock, check the wrist watch (check it)
Gucci flip flops, fuck it, hit your bitch in my socks (bust it)
This a big watch, diamond drippin' off of the clock (off of the clock)

---
## [Ankoki-Dev/SkJade@c574a3def3...](https://github.com/Ankoki-Dev/SkJade/commit/c574a3def3e661148eb52a872ae7ea9009f3ee95)
##### 2021-03-06 22:29:46 by Ankoki-Dev

I'm the shit with no makeup, don't have to curl my hair up
All this booty here, mine, I'm a dollar worth a dime
Real bosses stand up, ladies throw your hands up and say
"I know I'm cute, I know I'm fly"
You ask me why?
'Cause I'm the shit with no makeup, don't have to curl my hair up
All this booty here, mine, I'm a dollar worth a dime
Real bosses stand up, ladies throw your hands up and say
"I know I'm cute, I know I'm fly"
You ask me why? 'Cause I'm the shit
Beat 'em like they stole some, beat 'em like they stole some
All this booty here got 'em dreaming, lemme hold some
Let me, let me hear that boy, let me, let me wear that boy
Let me get the most expensive car, and let me steer that boy
Real big pretty titty, shut down every city
If you want the kid kitty, gotta get the key from me
All new everything, plus pay the rent for me
If we in the wilderness, n word pitch the tent for me
Tent for me, tent for me, get me bodied
Long hair, no makeup, doing pilates
Those n word don't step on my damn Zanottis
All them bitches my sons but who's the Daddy?
I graduate with honors, I ball, 'Nead O'Connor
I did a freestyle, then I got a shout out from Obama
Yes, yes, I am ill, I go in for the kill
Hoes is my sons, birth control, I am on the pill
What I gotta do? What I gotta do to 'em?
Step up in the club, everybody like who them?
Girls girls, me and my girls
What you done did? I need some referrals
Motherfuckers know I'm the shit, legit
And if a motherfucker don't, he can suck my dick
I tell 'em, "Everybody else is my opposite"
I put 'em on the game, give 'em five percent
I'm the shit with no makeup, don't have to curl my hair up
All this booty here, mine, I'm a dollar worth a dime
Real bosses stand up, ladies throw your hands up and say
"I know I'm cute, I know I'm fly"
You ask me why?
'Cause I'm the shit with no makeup, don't have to curl my hair up
All this booty here, mine, I'm a dollar worth a dime
Real bosses stand up, ladies throw your hands up and say
"I know I'm cute, I know I'm fly"
You ask me why? 'Cause I'm the shit
I'm like really famous, I got a famous anus
No, not Famous Amos, all this fame is heinous
Lemme, lemme hear that boy, lemme, lemme wear that boy
All this money coming in, but I never share that, boy
No lipstick, no lashes though
But I got a real big ol' ratchet, though
I said dude, yo dude, you packing dough
He said he want a good box like Pacquiao
I said, "Well, my name Nicki and it's nice to meet you"
If you really wanna know, I'll give you my procedure
Got a whole bunch of pretty gang in my clique
And we lookin' for some ballers, alopecia
I hate wack n word, I should really slap n word
These n word trippin' when I put 'em on the map n word
How you gon' break that? How you gon' fake that?
Ain't at no wedding but all my girls cake pops
Sleeping on me, no mattress though
I'm a burn the beat down, no matches though
No, they can't keep up? They molasses slow
I'm the greatest Queens bitch, with the cashes flow
Looking at me like it's my fault
Trying to take sneak pictures with they iPhone
I like independent bitches like July 4th
Now that's what young Harriet died for
I'm the shit with no makeup, don't have to curl my hair up
All this booty here, mine, I'm a dollar worth a dime
Real bosses stand up, ladies throw your hands up and say
"I know I'm cute, I know I'm fly"
You ask me why? 'Cause I'm the shit
I'm the shit with no makeup, don't have to curl my hair up
All this booty here, mine, I'm a dollar worth a dime
Real bosses stand up, ladies throw your hands up and say
"I know I'm cute, I know I'm fly"
You ask me why? 'Cause I'm the shit

---
## [CakHuri/godot-docs@b872229427...](https://github.com/CakHuri/godot-docs/commit/b872229427dddb9b749f46af597e85e25cf2955a)
##### 2021-03-06 22:52:04 by Rémi Verschelde

Remove controversial satirical piece 🔥

This piece was written back in 2014 before open sourcing Godot, and while its
intent is to be sarcastic, it leaves ample room for misinterpretation.

The intended meaning of this piece was, and always has been, the following:

Exploitative game mechanics suck. Games are a beautiful and artful medium
which can provide players with a wide range of experiences: entertainment,
enlightenment, joy, sadness... Games can be just for fun or they can bear
a message. They can connect people with each other or open the player's mind.

Make games worth your players' time and their money, and do your best to do so
while running a successful and respectful business. Hugs <3
