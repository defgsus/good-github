# [<](2021-04-05.md) 2021-04-06 [>](2021-04-07.md)

3,295,273 events, 1,712,399 push events, 2,708,816 commit messages, 196,685,538 characters


## [dermotduffy/hass-docs@5ddb6529c1...](https://github.com/dermotduffy/hass-docs/commit/5ddb6529c13dd4ba8f5aa364b2560740a77bf178)
##### 2021-04-06 04:27:51 by elyobelyob

I found that a 4pm or other non midnight required buffering. (#16182)

* Update history_stats.markdown

---
title: History Stats
description: Instructions about how to integrate historical statistics into Home Assistant.
ha_category:
  - Utility
  - Sensor
ha_iot_class: Local Polling
ha_release: 0.39
ha_quality_scale: internal
ha_domain: history_stats
---

The `history_stats` sensor platform provides quick statistics about another integration or platforms, using data from the [`history`](/integrations/history/) integration.

It can track how long the integration has been in a specific state, in a custom time period.

Examples of what you can track:

- How long you were at home this week
- How long the lights were ON yesterday
- How long you watched TV today

## Configuration

To enable the history statistics sensor, add the following lines to your `configuration.yaml`:

{% raw %}

```yaml
# Example configuration.yaml entry
sensor:
  - platform: history_stats
    name: Lamp ON today
    entity_id: light.my_lamp
    state: 'on'
    type: time
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now() }}'
```

{% endraw %}

{% configuration %}
entity_id:
  description: The entity you want to track.
  required: true
  type: string
state:
  description: The states you want to track.
  required: true
  type: [list, string]
name:
  description: Name displayed on the frontend. Note that it is used by Home Assistant to generate sensor's `object_id` so it is advisable to choose a unique one and change name for frontend using [customization](/docs/configuration/customizing-devices/#friendly_name) or via [Lovelace](/lovelace/entities/#name).
  required: false
  default: unnamed statistics
  type: string
type:
  description: "The type of sensor: `time`, `ratio`, or `count`."
  required: false
  default: time
  type: string
start:
  description: When to start the measure (timestamp or datetime).
  required: false
  type: template
end:
  description: When to stop the measure (timestamp or datetime).
  required: false
  type: template
duration:
  description: Duration of the measure.
  required: false
  type: time
{% endconfiguration %}

<div class='note'>

  You have to provide **exactly 2** of `start`, `end` and `duration`.
<br/>
  You can use [template extensions](/topics/templating/#home-assistant-template-extensions) such as `now()` or `as_timestamp()` to handle dynamic dates, as shown in the examples below.

</div>

## Sensor type

Depending on the sensor type you choose, the `history_stats` integration can show different values:

- **time**: The default value, which is the tracked time, in hours
- **ratio**: The tracked time divided by the length of your period, as a percentage
- **count**: How many times the integration you track was changed to the state you track

## Time periods

The `history_stats` integration will execute a measure within a precise time period. You should always provide 2 of the following :
- When the period starts (`start` variable)
- When the period ends (`end` variable)
- How long is the period (`duration` variable)

As `start` and `end` variables can be either datetimes or timestamps, you can configure almost any period you want.

### Duration

The duration variable is used when the time period is fixed. Different syntaxes for the duration are supported, as shown below.

```yaml
# 6 hours
duration: 06:00
```

```yaml
# 1 minute, 30 seconds
duration: 00:01:30
```

```yaml
# 2 hours and 30 minutes
duration:
  # supports seconds, minutes, hours, days
  hours: 2
  minutes: 30
```

<div class='note'>

  If the duration exceeds the number of days of history stored by the `recorder` component (`purge_keep_days`), the history statistics sensor will not have all the information it needs to look at the entire duration. For example, if `purge_keep_days` is set to 7, a history statistics sensor with a duration of 30 days will only report a value based on the last 7 days of history.

</div>

### Examples

Here are some examples of periods you could work with, and what to write in your `configuration.yaml`:

**Today**: starts at 00:00 of the current day and ends right now.

{% raw %}

```yaml
    start: '{{ now().replace(hour=0, minute=0, second=0) }}'
    end: '{{ now() }}'
```

{% endraw %}

**Yesterday**: ends today at 00:00, lasts 24 hours.

{% raw %}

```yaml
    end: '{{ now().replace(hour=0, minute=0, second=0) }}'
    duration:
      hours: 24
```

{% endraw %}

**This morning (6AM - 11AM)**: starts today at 6, lasts 5 hours.

{% raw %}

```yaml
    start: '{{ now().replace(hour=6, minute=0, second=0) }}'
    duration:
      hours: 5
```

{% endraw %}

**Current week**: starts last Monday at 00:00, ends right now.

Here, last Monday is _today_ as a timestamp, minus 86400 times the current weekday (86400 is the number of seconds in one day, the weekday is 0 on Monday, 6 on Sunday).

{% raw %}

```yaml
    start: '{{ as_timestamp( now().replace(hour=0, minute=0, second=0) ) - now().weekday() * 86400 }}'
    end: '{{ now() }}'
```

{% endraw %}

**Next 4pm **: ends today at 00:00, lasts 30 days. Easy one.

{% raw %}

```yaml
    end: '{{ now().replace(hour=0, minute=0, second=0) }}'
    duration:
      days: 30
```

{% endraw %}

**Last 30 days**: ends today at 00:00, lasts 30 days. Easy one.

{% raw %}

```yaml
    end: '{{ now().replace(hour=0, minute=0, second=0) }}'
    duration:
      days: 30
```

{% endraw %}


** 4PM always in the future**: ends in the future at 16:00, starts 24 hours before.

{% raw %}

```yaml
    end: '{{ (now().replace(minute=0,second=0) + timedelta(hours=8)).replace(hour=16) }}'
    duration:
      hours: 24
```

{% endraw %}

**All your history** starts at timestamp = 0, and ends right now.

{% raw %}

```yaml
    start: '{{ 0 }}'
    end: '{{ now() }}'
```

{% endraw %}

<div class='note'>

  The `/developer-tools/template` page of your Home Assistant UI can help you check if the values for `start`, `end` or `duration` are correct. If you want to check if your period is right, just click on your component, the `from` and `to` attributes will show the start and end of the period, nicely formatted.

</div>

* $pm - 4pm example implemented

* Tweak

* Update source/_integrations/history_stats.markdown

Very happy with this change ...

Co-authored-by: Franck Nijhof <frenck@frenck.nl>

* Update source/_integrations/history_stats.markdown

Co-authored-by: Franck Nijhof <frenck@frenck.nl>

---
## [liferay/liferay-frontend-projects@bc6ff83ceb...](https://github.com/liferay/liferay-frontend-projects/commit/bc6ff83ceb3f670195367a93665dc69459167b27)
##### 2021-04-06 09:38:42 by Greg Hurrell

feat(npm-scripts): check for TS artifact staleness during CI runs

Basically does what it says on the tin. If you have touched any paths
inside a TS project then we'll run our "types" subcommand to verify that
the committed TS artifacts are up-to-date.

I don't know whether "preflight" is a great _name_ for this phase but it
does seem to be the right _place_. Currently when you run "check" (which
is what CI runs) we will run:

1.  "preflight" checks; which consist of:

    a)  checking for banned config file names

    b)  checking for banned dependencies inside package.json files (note
        that we may and probably will add more package.json checks in
        the future)

    c)  checking that TS artifacts are up to date

2.  "format" (Prettier) checks

3.  "lint" (ESLint) checks

In other words, "preflight" means "everything that isn't handled by
Prettier and ESLint".

So, as noted in the commit, this will only have effect in CI, because
that's the only place where `LIFERAY_NPM_SCRIPTS_WORKING_BRANCH_NAME`
will be defined. At least for now, this check is plenty fast (only a few
seconds). We can worry about performance later on, and we probably have
a fair bit of time before that happens because TS adoption will likely
be quite a long and drawn-out affair.

Note that we want this to work on in CI in order to keep the local
development experience snappy. If you are working in
"frontend-js-react-web", you shouldn't have to wait for a global check
to run just because you ran "yarn run check"; instead, you should be
able to rely on CI to keep `master` in a good state, and know that all
the other projects are up-to-date and that you only need worry about
your own.

Test plan:

Copy this over to liferay-portal and see `yarn run check` fail like this
when you set `LIFERAY_NPM_SCRIPTS_WORKING_BRANCH_NAME` to `master` and
have stale artifacts. If the artifacts aren't stale, or you don't have
that environment variable, you don't see an error.

    Preflight check failed:
    checkTypeScriptTypeArtifacts() failed: Error: Type generation was successful but 2 projects were out of date. Please commit updated versions of the artifacts in the projects listed above.

---
## [liferay/liferay-frontend-projects@9866887ab6...](https://github.com/liferay/liferay-frontend-projects/commit/9866887ab66484472c582dabf15f4cf761a91258)
##### 2021-04-06 09:38:42 by Greg Hurrell

feat(npm-scripts): add `configureTypeScript()` to manage tsconfig.json

High-level overview:

- This function takes an existing `tsconfig.json` file and brings it
  up-to-date based on three inputs: (1) A base config that is bundled
  inside `npm-scripts` and is common across all projects; (2) An
  `@overrides` field that contains any, er, overrides, that a project
  might need to apply; and (3) Information about the TS dependency graph
  that is needed to set up project references between projects.

- The function returns `true` if everything is up-to-date and `false`
  otherwise, which means that we will be able to plug it in to the rest
  of the system to perform two operations: (1) Freshen the config (can
  also be used to generated a brand new one if you just do `touch
  tsconfig.json` first to identify the project as a TS one); or (2)
  Check that the config is up to date. So the plan is to plug (1) into
  the "build" subcommand and (2) into the "check" subcommand (in CI).

- In order to detect changes and prevent unintended manual edits,
  every config file has a `@generated` hash and clear `@readonly`
  warning to keep edits inside the `@overrides` section alone. There is
  also a `@see` file with a short-link to the following URL (which I
  haven't written yet, but will, and which will explain all of this):

      https://github.com/liferay/liferay-frontend-projects/blob/master/projects/npm-tools/packages/npm-scripts/src/typescript/README.md

- Note that the hash only cares about the values in the file, not the
  whitespace or formatting. This means that if you modify the file with
  Java SourceFormatter or Prettier the hash will remain the same. We
  already have a mess where those two tools fight with one another of
  what JSON should look like, so we do our best here to at least not
  make thing worse there. When we write JSON, we do so in a format which
  (I hope) matches what SourceFormatter wants, and we only write it when
  absolutely necessary (ie. because the values have changed).

There is one TODO noted inline, as well as the missing docs I mentioned
above. Finally, I need to test this in liferay-portal and actually
integrate it with the "build" and "check" subcommands, but I'll do that
in another commit.

Details:

- `configureTypeScript()` is a simple function that takes the dependency
  graph information (from `getTypeScriptDependencyGraph()`) and no other
  parameters; it configures the "tsconfig.json" file in current working
  directory. I did it this way in order to make it simple for callers,
  even though it makes writing the tests harder. Whatevs. The tests were
  going to be hard no matter what because you need a bunch of fixtures.

- Given those fixtures, we can copy them on every test (slow), or do
  some naughty writing in-place (ie. to the "tsconfig.json" files in the
  "__fixtures__" directories). I did the naughty thing because I don't
  want headaches with temporary files on Windows in CI. (Speaking of
  which, there are a few `path.join` type things that may require a good
  review/test on Windows.)

- Doing the naughty thing requires us to modify the `.gitignore`,
  because we don't want changes to these `tsconfig.json` files appearing
  in the `git diff` output. Note that while I was in there I stripped
  out the useless "node_modules" entry (already covered by the
  `.gitignore` in the repo root).

- We tell Jest to ignore the `__fixtures__` directory because otherwise
  a `yarn test --watch` run will infinite loop because every time you
  run the tests, you touch the file-system, which causes Jest to run
  again, which causes you to touch the file-system...

- Our base `tsconfig.json` that we use as a template is actually called
  `tsconfig-base.json` because I don't want `tsc` or any editor LSP
  picking it up and thinking that the containing `config/` folder is the
  root of a TS project.

- The tests have a few `sort-keys` lint suppressions in them for
  readability reasons (to make the precendence of the spread/merge
  operations clear).

Test plan: For now, just unit tests.

---
## [Spookerton/ss13_mirror_tgstation@7b52daef41...](https://github.com/Spookerton/ss13_mirror_tgstation/commit/7b52daef41ff7b771cc84aedcdebba82679e684e)
##### 2021-04-06 10:01:22 by LemonInTheDark

Makes stations more airtight (#57535)

I've gone through delta, meta, and icebox and added some choice windoors, changed some areas around, added some more doors, and changed some other miscellaneous things.

I'll list the full changes in drop downs, for both our sakes

Delta:
<details>
Splits the central hallway into fore and aft central hallways

Adds the spaces that jut out of medbay and sci into the central hallway, rather then having them be a part of
medbay and sci

Adds medbay access locked windoors to the back desk of the medbay reception area

Adds airlocks to both the upper and lower parts of the main hallway
</details>

Meta:
<details>
Gives the storage wing another set of firelocks, and two fire alarms. It didn't have any alarms in the first place, so hopefully this helps things

Adds the spaces that jut out of medbay and sci into the central hallway, rather then having them be a part of
medbay and sci

Replaces a small bit of the science area with nanite lab, to prevent a breach near xenobio causing fire alarms
at the front of sci

Adds a windoor in front of the ORM to block air

Adds a wall behind a smart fridge in chemistry
</details>

Icebox:
<details>
Added airlocks between arrivals and the port hallway, and the escape hallway and the starboard hallway

Added a windoor between the kitchen and the bar
</details>

## Why It's Good For The Game

Cuts delta's main hallway in half, with the goal of reducing fire alarm strain. Some thoughts on this would be nice, I don't want to make everything else that uses areas worse just because fire alarms are dumb, and I'm worried that's what I've ended up doing here.

I've also added the portions of medbay/sci that jut out into the main hallway into the main hallway, I think? I could make these into lobby areas, but I'm not sure if that's appropriate or not.

Adds a few windoors and airlocks to better section off portions of the station, this should reduce the amount of mass gas spreading that can occur.

My goal here is to reduce the amount of uninteresting gas movement and make firelocks less hellish when there's a breach

---
## [wincent/liferay-portal@b6dae724bf...](https://github.com/wincent/liferay-portal/commit/b6dae724bf003fcc63b2c293ee759364f4655d50)
##### 2021-04-06 10:21:19 by Greg Hurrell

LPS-129801 Port "render.es.js" to TS

Note this requires some horrible ugly casts for `Liferay`, because
globals are nasty and all that. Figuring out how to declare that as an
ambient type in some central location in the context of project
references is going to be complicated enough, based on my reading of:

    https://github.com/microsoft/TypeScript/issues/29002

that I am going to leave it for a separate commit.

There are a couple of `any` in here too, which I don't like (we've
mostly been able to get away without any `any` at all in
`frontend-js-react-web`) but I want to close up shop for the day so I am
going to commit this and push what I have.

---
## [Wawamama/codewars-kata@e60b239e8d...](https://github.com/Wawamama/codewars-kata/commit/e60b239e8d5845a3f8a011383f1c532bd52f84ea)
##### 2021-04-06 15:44:05 by Marion Saul

Create kyu7-paulsmisery.js

Paul is an excellent coder and sits high on the CW leaderboard. He solves kata like a banshee but would also like to lead a normal life, with other activities. But he just can't stop solving all the kata!!

Given an array (x) you need to calculate the Paul Misery Score. The values are worth the following points:

kata = 5
Petes kata = 10
life = 0
eating = 1
The Misery Score is the total points gained from the array. Once you have the total, return as follows:

<40 = 'Super happy!'
<70 >=40 = 'Happy!'
<100 >=70 = 'Sad!'
=100 = 'Miserable!'

---
## [saamerm/IslandLanding@82bce9862e...](https://github.com/saamerm/IslandLanding/commit/82bce9862eaae6e79e171266dbefab8494514dca)
##### 2021-04-06 19:04:22 by amira

Fixes

Fixes in PR
Dark mode force
Android : Hide the toolbar, you can keep the 3 buttons at the bottom, just make it have a background color of 36,36,36(part of change background color not done yet)
Force portrait mode

Dashboard Page
Change “LeaderBoard” to “Leaderboard”
Gamer tag page:
Center horizontally
Reword it to “Enter a gamer tag below:”
Add a placeholder “LeeroyJenkins”
Error message text should be “Gamer tag cannot be empty”
Switch gamer tag page
Center horizontally
Add a placeholder “LeeroyJenkins”
Error message text should be “Gamer tag cannot be empty”
Tutorial 1 :
“Hi ____, You are…” should be reworded to “…, you’re a passenger in a flight that is going to crash. As you are ready to jump from the plane, the pilot will provide with a time indicating when to launch your parachute.”
Tutorial 2:
Gets skipped
Tutorial 3
“Listen to the….” Should be reworded to “The time will disappear after you jump. You must launch your parachute within 1 second of the indicated time, so that you will land on the island and not get eaten up by the sharks”
Change “Next” to “Let’s Play” on the button
Game rules page
Rename “Game rules” to “Instructions”
Reword “click” to “tap” in all instances (x2)
“has elapsed.If” to “has elapsed. If”
“to next level” to “to the next level”
“Pass 10 levels” to “Pass 5 levels”
“..development.Background..” to “..development. Background..”
Change “.We help mers love, and we specialize” to “. We specialize in UI design and Mobile App Development, and we love collaborating with others. Background vectors created by pikisuperstar and music by Jorge Hernandez”
Game Page Popups:
Popup for Restart, Quit, or Win is too small on iPhone 8
Reword: After winning the popup shows “Next”, change it to “Next Level”
Message in win popup
Change the time “0.95 seconds” to total time like this “5.95 seconds”
If time difference >0.5/<-0.5, then say “5.95 seconds, you barely missed the sharks!”
If time difference <0.1/>-0.1, then say “5.05 seconds, your accuracy is amazing, you must be a skydiver!”
If time difference >0.1/<-0.1, then say “5.45 seconds, you made it on the island!”
Popups do not cover the entire screen on iPhone 8
There’s a bug where the app freezes if you don’t tap “Next Level” immediately(fixed by use parachute instead)
Feedback page:
Change “Please Enter all the field” to “Please fill out all the fields”
Win Page
If there’s a failure in the API call or if the API returns that the score was not enough, don’t show “You are now ranked NO.0”, show “Play again to sharpen your brain”
Rename “Main” to “Main Menu”
Change the Feedback popup to say “You’ve won the game. Did you enjoy playing it?” Instead of what it says right now
Lose page:
“Saamer You have landed” to “Saamer you have landed”
“..seconds,which..” to “..seconds, which..”
Update the logic:
“which is -1.30 seconds” should only show the time difference (5-1.30) “3.70 seconds”
And if time difference>0, then say “seconds too early”
And if time difference<0, then say “seconds too late”
Change “Main” button to “Dashboard”
Pasted Graphic 2.png

Leaderboard page:
If there’s no best time, the line should be hidden “Your best time is s”
If there’s an error in API, change the “Your best time..” text to say “Error connecting to global leaderboard”
“Your best time is 0.0700000001s” to “You best time is 0.07s”

---

# [<](2021-04-05.md) 2021-04-06 [>](2021-04-07.md)

