# [<](2023-01-06.md) 2023-01-07 [>](2023-01-08.md)

there were a lot of events recorded by [gharchive.org](https://www.gharchive.org/) of which 1,943,172 were push events containing 2,632,790 commit messages that amount to 162,736,016 characters filtered with [words.py@e23d022007...](https://github.com/defgsus/good-github/blob/e23d022007992279f9bcb3a9fd40126629d787e2/src/words.py) to these 27 messages:


## [13190-2022-23/13190PowerPlayFTCLib](https://github.com/13190-2022-23/13190PowerPlayFTCLib)@[9822629417...](https://github.com/13190-2022-23/13190PowerPlayFTCLib/commit/982262941743667fdb6aea275b9922cac9d33c33)
#### Saturday 2023-01-07 00:28:16 by RichardkimAXel

FUCKING BRAINLET FUCKED UP SLEEVE DETECTION FUCK YOU

---
## [OpenVZ/vzkernel](https://github.com/OpenVZ/vzkernel)@[573b0cbb9b...](https://github.com/OpenVZ/vzkernel/commit/573b0cbb9be4075574debabdf1ad4ad58783d0d8)
#### Saturday 2023-01-07 00:51:10 by Vladimir Davydov

mm: introduce transcendent file cache (tcache)

Transcendent file cache (tcache) is a simple driver for cleancache,
which stores reclaimed pages in memory unmodified. Its purpose it to
adopt pages evicted from a memory cgroup on local pressure, so that they
can be fetched back later without costly disk accesses. It works
similarly to shadow gangs from PCS6 except pages has to be copied on
eviction.

https://jira.sw.ru/browse/PSBM-31757

* Usage

 - Enable:
   # modprobe tcache # only if compiled as a module
   # echo Y > /sys/module/tcache/parameters/enabled

 - Disable:
   # echo N > /sys/module/tcache/parameters/enabled

 - Get number of pages cached:
   # cat /sys/module/tcache/parameters/nr_pages

* Implementation notes

 - Fetching/adding a page to tcache implies looking up a tcache pool
   (corresponds to a super block), tcache node in the pool (corresponds
   to an inode), and a page in the node. Pages of the same node are
   organized into a radix tree protected by a single spin lock,
   similarly to pages in an address_space. Nodes of the same pool are
   kept in several RB trees, each of which protected by its own spin
   lock. The number of RB trees is proportional to the number of CPUs,
   and nodes are distributed among the trees using a hash function. This
   is to minimize contention on the locks protecting the trees. Pools
   are kept in an IDR and looked up locklessly.

 - All tcache pages are linked in per NUMA node LRU lists and reclaimed
   on global pressure by a slab shrinker. Also, if we fail to allocate a
   new page for tcache, we will attempt to reclaim the oldest one
   immediately.

 - Once the tcache module is loaded, it is impossible to disable tcache
   completely due to cleancache limitations. "Disabling" it via the
   corresponding module parameter only forbids populating the cache with
   new pages. Lookups will proceed to tcache anyway.

 - Tcache pages are accounted as file pages.

* F.A.Q.

 - Does copying pages to and from tcache affect performance?

   Yes, it does. Fetching data from tcache advances roughly two times
   slower than from the page cache, because one has to copy data twice.
   Below are times of reading a 512M file from a memory cgroup:

   a) without limits:
      536870912 bytes (537 MB) copied, 0.481623 s, 1.1 GB/s
   b) with 100M limit and tcache enabled:
      536870912 bytes (537 MB) copied, 0.974815 s, 551 MB/s

   However, tcache exists not to allow containers whose working set does
   not fit in their RAM operate as fast as they would if there were no
   memory limits at all. Tcache exists to avoid costly disk operations
   whenever possible. For example, if there is a container which would
   normally thrash due to the memory limit and there is some unused
   memory on the host, it is better to allow the container to use the
   free memory to avoid thrashing, because otherwise it will generate
   disk pressure sensible by other containers.

 - Is there any memory overhead excluding the space used for storing
   data pages?

   Practically, no. All the information about pages is stored directly
   in struct page, and no additional handles are allocated per page.
   Per inode radix trees do consume some additional kernel memory per
   page, but its amount is negligible.

 - Does tcache generate memory pressure at the global level? If yes,
   does it affect containers?

   Yes, it generates global pressure and currently it does affect
   containers. This is similar to the issue we had had in PCS6 before
   shadow gangs and vmscan scheduling hacks were introduced, when there
   was the only LRU list for evicted pages (init_gang). We are planning
   to fix it by backporting low limits for memory cgroups. If a
   container is below its low limit, its memory will not be scanned on
   global pressure unless all containers are below their low limits
   (this is a kind of memory guarantee). We will set low limits for a
   container to be equal to an estimate of its working set size (this
   will be done by a user space daemon). Since tcache resides in the
   root memory cgroup, which does not have any memory guarantees (low
   limit equals 0), it will not press upon containers provided the
   system is properly configured.

 - Why cannot we use low limits instead of hard limits then?

   Low limits are unsafe by design. There is no guarantee that we will
   always be able to reclaim a cgroup back to its low limit. There are
   anonymous and kernel memory, which are sometimes really hard to
   reclaim. We could introduce a separate limit for them (anon+swap),
   but it will never get upstream (we tried).

 - Why is it better than what we have in PCS6?

   Primarily, because the idea of wiring sophisticated vmscan rules into
   the kernel, as we have done in PCS6 (vmscan scheduler) is dubious
   since it makes changing its behavior really painful. There are other
   points too:

   + The PCS6 memory management patch is really intrusive: it has
     sprouted its slimy tentacles all around the mm subsystem (rmap.c,
     memory.c, mlock.c, vmscan.c). We will hardly ever manage to push it
     upstream, so we will most likely have to carry it for good. This
     means each major rebase will turn into a torment. OTOH tcache code
     is isolated in a module and therefore can be easily ported back and
     forth.

   + Thanks to data copying, we can do funny things with the
     transcendent page cache in future, such as compression and
     deduplication. There were plans to implement compressed file cache
     upstream (zcache), but unfortunately it is still not there, and
     nobody seems to care about it. Nevertheless, sooner or later it
     will be introduced (may be, I'll facilitate this process), and we
     will be able to seamlessly switch to it from tcache. Tcache will be
     still useful for testing though.

 - In PCS6 there are per container shadow lists, while you have only the
   global LRU for all tcache pages. Is there any plans to introduce per
   super block or per memory cgroup LRUs?

   I am still unconvinced that we really need it, because it is not
   clear to me what policy we should apply per container on reclaim. It
   smells like one more heuristic, which I am desperately trying to
   avoid. Current design looks simple and sane: there are guarantees for
   containers provided by their limits, and they are competing fairly
   for the rest of the memory used for caches.

 - What about swap cache?

   There are plans to implement a similar driver for frontswap (tswap)
   or backport and use existing zswap. There may be problems with the
   latter though, because it currently does not support reclaim, and it
   will be tricky from the technical point of view to introduce it.

 - Any plans to push tcache upstream?

   No, because its use case looks too narrow to me to be included into
   the vanilla kernel. I am planning to concentrate on zcache instead.

Signed-off-by: Vladimir Davydov <vdavydov@parallels.com>

+++
mm/tcache: restore missing rcu_read_lock() in tcache_detach_page() #PSBM-120802

Looks like rcu_read_lock() was lost in "out:" path of tcache_detach_page()
when tcache was ported to VZ8. As a result, Syzkaller was able to hit
the following warning:

  WARNING: bad unlock balance detected!
  4.18.0-193.6.3.vz8.4.7.syz+debug #1 Tainted: G        W        ---------r-  -
  -------------------------------------
  vcmmd/926 is trying to release lock (rcu_read_lock) at:
  [<ffffffff848ed2e0>] tcache_detach_page+0x530/0x750
  but there are no more locks to release!

  other info that might help us debug this:
  2 locks held by vcmmd/926:
   #0: ffff888036331f30 (&mm->mmap_sem){++++}, at: __do_page_fault+0x157/0x550
   #1: ffff8880567295f8 (&ei->i_mmap_sem){++++}, at: ext4_filemap_fault+0x82/0xc0 [ext4]

  stack backtrace:
  CPU: 0 PID: 926 Comm: vcmmd ve: /
               Tainted: G        W        ---------r-  - 4.18.0-193.6.3.vz8.4.7.syz+debug #1 4.7
  Hardware name: Virtuozzo KVM, BIOS 1.11.0-2.vz7.2 04/01/2014
  Call Trace:
   dump_stack+0xd2/0x148
   print_unlock_imbalance_bug.cold.40+0xc8/0xd4
   lock_release+0x5e3/0x1360
   tcache_detach_page+0x559/0x750
   tcache_cleancache_get_page+0xe9/0x780
   __cleancache_get_page+0x212/0x320
   ext4_mpage_readpages+0x165d/0x1b90 [ext4]
   ext4_readpages+0xd6/0x110 [ext4]
   read_pages+0xff/0x5b0
   __do_page_cache_readahead+0x3fc/0x5b0
   filemap_fault+0x912/0x1b80
   ext4_filemap_fault+0x8a/0xc0 [ext4]
   __do_fault+0x110/0x410
   do_fault+0x622/0x1010
   __handle_mm_fault+0x980/0x1120
   handle_mm_fault+0x17f/0x610
   __do_page_fault+0x25d/0x550
   do_page_fault+0x38/0x290
   do_async_page_fault+0x5b/0xe0
   async_page_fault+0x1e/0x30

Let us restore rcu_read_lock().

https://jira.sw.ru/browse/PSBM-120802
Fix in vz7: 152239c6c3b2 ("mm/tcache: fix rcu_read_lock()/rcu_read_unlock()
imbalance")

Signed-off-by: Evgenii Shatokhin <eshatokhin@virtuozzo.com>
Reviewed-by: Andrey Ryabinin <aryabinin@virtuozzo.com>

vz9 rebase notes:
 * free_unref_page() new arg (page order) has been added - assumed it's
   always 0

(cherry picked from vz8 commit e0868a90331d9ab990f3d4ca802d068fecaa9457)
Signed-off-by: Konstantin Khorenko <khorenko@virtuozzo.com>
Feature: mm: transcendent file cache (tcache)

---
## [0x5066/DeClassified](https://github.com/0x5066/DeClassified)@[d07a8d2a5b...](https://github.com/0x5066/DeClassified/commit/d07a8d2a5b33f76bd7fcc9532f27f9ca53d4281f)
#### Saturday 2023-01-07 03:15:02 by Eris Lund

of course this occurs *now*

i fucking forgot to update the _noiso variant of eq_layers.m and i hate myself for that

---
## [lllgts/android_kernel_lge_msm8998](https://github.com/lllgts/android_kernel_lge_msm8998)@[75fa90e8b5...](https://github.com/lllgts/android_kernel_lge_msm8998/commit/75fa90e8b5d01ca2816ddc23a076961b15dad8a8)
#### Saturday 2023-01-07 03:53:03 by George Spelvin

lib/sort: make swap functions more generic

Patch series "lib/sort & lib/list_sort: faster and smaller", v2.

Because CONFIG_RETPOLINE has made indirect calls much more expensive, I
thought I'd try to reduce the number made by the library sort functions.

The first three patches apply to lib/sort.c.

Patch #1 is a simple optimization.  The built-in swap has special cases
for aligned 4- and 8-byte objects.  But those are almost never used;
most calls to sort() work on larger structures, which fall back to the
byte-at-a-time loop.  This generalizes them to aligned *multiples* of 4
and 8 bytes.  (If nothing else, it saves an awful lot of energy by not
thrashing the store buffers as much.)

Patch #2 grabs a juicy piece of low-hanging fruit.  I agree that nice
simple solid heapsort is preferable to more complex algorithms (sorry,
Andrey), but it's possible to implement heapsort with far fewer
comparisons (50% asymptotically, 25-40% reduction for realistic sizes)
than the way it's been done up to now.  And with some care, the code
ends up smaller, as well.  This is the "big win" patch.

Patch #3 adds the same sort of indirect call bypass that has been added
to the net code of late.  The great majority of the callers use the
builtin swap functions, so replace the indirect call to sort_func with a
(highly preditable) series of if() statements.  Rather surprisingly,
this decreased code size, as the swap functions were inlined and their
prologue & epilogue code eliminated.

lib/list_sort.c is a bit trickier, as merge sort is already close to
optimal, and we don't want to introduce triumphs of theory over
practicality like the Ford-Johnson merge-insertion sort.

Patch #4, without changing the algorithm, chops 32% off the code size
and removes the part[MAX_LIST_LENGTH+1] pointer array (and the
corresponding upper limit on efficiently sortable input size).

Patch #5 improves the algorithm.  The previous code is already optimal
for power-of-two (or slightly smaller) size inputs, but when the input
size is just over a power of 2, there's a very unbalanced final merge.

There are, in the literature, several algorithms which solve this, but
they all depend on the "breadth-first" merge order which was replaced by
commit 835cc0c8477f with a more cache-friendly "depth-first" order.
Some hard thinking came up with a depth-first algorithm which defers
merges as little as possible while avoiding bad merges.  This saves
0.2*n compares, averaged over all sizes.

The code size increase is minimal (64 bytes on x86-64, reducing the net
savings to 26%), but the comments expanded significantly to document the
clever algorithm.

TESTING NOTES: I have some ugly user-space benchmarking code which I
used for testing before moving this code into the kernel.  Shout if you
want a copy.

I'm running this code right now, with CONFIG_TEST_SORT and
CONFIG_TEST_LIST_SORT, but I confess I haven't rebooted since the last
round of minor edits to quell checkpatch.  I figure there will be at
least one round of comments and final testing.

This patch (of 5):

Rather than having special-case swap functions for 4- and 8-byte
objects, special-case aligned multiples of 4 or 8 bytes.  This speeds up
most users of sort() by avoiding fallback to the byte copy loop.

Despite what ca96ab859ab4 ("lib/sort: Add 64 bit swap function") claims,
very few users of sort() sort pointers (or pointer-sized objects); most
sort structures containing at least two words.  (E.g.
drivers/acpi/fan.c:acpi_fan_get_fps() sorts an array of 40-byte struct
acpi_fan_fps.)

The functions also got renamed to reflect the fact that they support
multiple words.  In the great tradition of bikeshedding, the names were
by far the most contentious issue during review of this patch series.

x86-64 code size 872 -> 886 bytes (+14)

With feedback from Andy Shevchenko, Rasmus Villemoes and Geert
Uytterhoeven.

Link: http://lkml.kernel.org/r/f24f932df3a7fa1973c1084154f1cea596bcf341.1552704200.git.lkml@sdf.org
Signed-off-by: George Spelvin <lkml@sdf.org>
Acked-by: Andrey Abramov <st5pub@yandex.ru>
Acked-by: Rasmus Villemoes <linux@rasmusvillemoes.dk>
Reviewed-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Cc: Rasmus Villemoes <linux@rasmusvillemoes.dk>
Cc: Geert Uytterhoeven <geert@linux-m68k.org>
Cc: Daniel Wagner <daniel.wagner@siemens.com>
Cc: Don Mullis <don.mullis@gmail.com>
Cc: Dave Chinner <dchinner@redhat.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
Signed-off-by: Yousef Algadri <yusufgadrie@gmail.com>
Signed-off-by: Panchajanya1999 <panchajanya@azure-dev.live>

---
## [jordanorelli/.dotfiles](https://github.com/jordanorelli/.dotfiles)@[1a31fcc29d...](https://github.com/jordanorelli/.dotfiles/commit/1a31fcc29d4e66827b665a35271ca2775fa33c37)
#### Saturday 2023-01-07 04:04:43 by Jordan Orelli

i dunno let's try some new shit

fuck it we're doing it in python

---
## [Skyrat-SS13/Skyrat-tg](https://github.com/Skyrat-SS13/Skyrat-tg)@[91d74cabf6...](https://github.com/Skyrat-SS13/Skyrat-tg/commit/91d74cabf652013e4c12158a7a33f3d5a8e30e66)
#### Saturday 2023-01-07 05:21:14 by SkyratBot

[MIRROR] Bodypart code cleanup, robotic limbs can actually be disabled through damage again. [MDB IGNORE] (#18093)

Bodypart code cleanup, robotic limbs can actually be disabled through damage again. (#71739)

<!-- Write **BELOW** The Headers and **ABOVE** The comments else it may
not be viewable. -->
<!-- You can view Contributing.MD for a detailed description of the pull
request process. -->

Cleans up various variables and code comments in bodypart code so that
it is easier to understand (hopefully) what the fuck is happening there.

Fixes a hilarious oversight. For what may have been an entire 2 year
span, robotic limbs were unable to be disabled whatsoever. Good stuff.

Lost all your limbs and now have only surplus prosthetics?
Congratulations! You're now more durable than even someone with proper
robotic limbs, as your arms do not contribute anything more than 10
damage (or 15 stamina) to your overall damage taken. Furthermore, taking
the maximum amount of damage is actually entirely meaningless to you.

Laugh as someone attempting to shoot your arms does almost no meaningful
damage once you hit the cap! It's all sunk cost! You can't have it blown
off anyway, because dismembering surplus limbs is gone!

Who knew getting into a horrible bluespace/goliath accident could have
such an impact on your combat prowess. Thanks Nanotrasen!

Anyway, these vars are ugly.

<!-- If your PR modifies aspects of the game that can be concretely
observed by players or admins you should add a changelog. If your change
does NOT meet this description, remove this section. Be sure to properly
mark your PRs to prevent unnecessary GBP loss. You can read up on GBP
and it's effects on PRs in the tgstation guides for contributors. Please
note that maintainers freely reserve the right to remove and add tags
should they deem it appropriate. You can attempt to finagle the system
all you want, but it's best to shoot for clear communication right off
the bat. -->

:cl:
code: Makes a lot of the bodypart variables clearer as to what they do.
Includes more detailed code comments.
fix: Robotic limbs are no longer immune to being disabled through
reaching maximum damage.
/:cl:

<!-- Both :cl:'s are required for the changelog to work! You can put
your name to the right of the first :cl: if you want to overwrite your
GitHub username as author ingame. -->
<!-- You can use multiple of the same prefix (they're only used for the
icon ingame) and delete the unneeded ones. Despite some of the tags,
changelogs should generally represent how a player might be affected by
the changes rather than a summary of the PR's contents. -->

Co-authored-by: necromanceranne <40847847+necromanceranne@users.noreply.github.com>

---
## [AndrewL97/mojave-sun-13](https://github.com/AndrewL97/mojave-sun-13)@[736422fac8...](https://github.com/AndrewL97/mojave-sun-13/commit/736422fac8d84c8e054853fd2b205cc993250c21)
#### Saturday 2023-01-07 05:56:47 by Technobug14

Field Transfusions & Fixes Sprites/Runtime (#2152)

* Working field transfusions

As far as I can tell, no runtimes or bugs. Should be good to go. Could maybe do with some polish? But otherwise it works great.

* Fixes energy weapon bugs

Fixes a runtime related to emptying cells from energy weapons, and fixes an overlay bug and inventory icon bug on the cells themselves.

* Bug fixes

read above, fixes a few bugs/errors

* Broken as hell

Supposed to add new IV bag sprites and overlays that would change as the bag gets emptier. Multiple bugs both with transfusion and the icon/overlay. Right now, the icon currently disappears once the object is on the ground and I can't tell why. Secondly, the overlay has the visual bugs and could probably do with a more thorough system to apply it? The bugs on transfusion are mostly due to a lack of sanity checks, where it will continue to be attached to someone from many tiles away when thrown/dropped, etc.

* Shit

HATE HATE HATE this sucks and it is buggy as hell

* Fix icon/overlay updates

* Mostly working

Still some broken stuff, you can attach IV bags if you're not next to someone and do it from inside containers, also fixes the world states for the police and military 10mm pistol

* Finishing touches

Couple of bug fixes, fixes 10mm police/military world sprite, etc etc. Should be good to go.

Co-authored-by: Koshenko <koshenko@pm.me>
Co-authored-by: Koshenko <53068134+Koshenko@users.noreply.github.com>

---
## [Skyrat-SS13/Skyrat-tg](https://github.com/Skyrat-SS13/Skyrat-tg)@[08291a6dbb...](https://github.com/Skyrat-SS13/Skyrat-tg/commit/08291a6dbb3249d9acbca4f539eb82900d299f26)
#### Saturday 2023-01-07 06:54:02 by SkyratBot

[MIRROR] Guards against uplink failsafe code being the same as unlock code [MDB IGNORE] (#18275)

* Guards against uplink failsafe code being the same as unlock code (#72113)

## About The Pull Request

There's probably a better way to do this to be honest, but I think it's
silly for both to potentially be the same and this should work alright.
## Why It's Good For The Game

Fixes #71446.

I don't think the Syndicate is that stupid.
## Changelog
:cl:
fix: After a recent mishap with a high-ranking Syndicate operative, the
uplink's unlock code and failsafe code (the one that makes it blow up if
you say it) should never turn out to be the same.
/:cl:

* Guards against uplink failsafe code being the same as unlock code

Co-authored-by: san7890 <the@san7890.com>

---
## [Skyrat-SS13/Skyrat-tg](https://github.com/Skyrat-SS13/Skyrat-tg)@[df737af4a0...](https://github.com/Skyrat-SS13/Skyrat-tg/commit/df737af4a02b18388b293005c340a7a46423236e)
#### Saturday 2023-01-07 06:56:59 by SkyratBot

[MIRROR] *hand, or That /One/ Emote You Always Felt Was Missing [MDB IGNORE] (#18200)

* *hand, or That /One/ Emote You Always Felt Was Missing (#71600)

## About The Pull Request
It's happened to me _repeatedly_ that I'd see someone down on the floor,
and wanted to just, give them a hand, so they could take it and get up
that way, without just, directly clicking on them, since that's a little
bland. I've also wanted to just, offer my hand to someone so they could
grab it, so that I could pull them alongside me, rather than just
targeting one of their arms and ctrl-clicking them.

I've had this idea for a _long_ time, and only just decided to do this
today.

Now, I know what you might say. "Golden, that's a lot of code for
something this simple!" You're not wrong. _However_. I decided to go
along and to give some more love to the `/datum/status_effect/offering`
status effect and the offering-related alerts, to make them a lot more
versatile and a lot less hardcoded. Hence the whole "refactoring" part
of this.

Of course, when I add something, I don't do it half-way. So, the way the
emote works is much like the `*slap` emote, except that:

- When you click on someone, it does the exact same as if you were
offering the item to them, except that it's targeted (much like
ctrl-shift-click).
- If there's nobody directly adjacent to you, it won't do anything.
- If there's at least one person lying down around you, you will offer
them your help to get up. Should they take your hand and let you help
them up, you will both receive a simple memory about being helped up (or
helping up), as well as a 45-seconds-long small mood buff, because it
feels nice to be on either end of such a friendly gesture. If they get
up, they automatically get disqualified from being offered some help
standing up, and likewise, if you lie down, that offer goes away as
well.
- If there's at least one person around you, you will instead extend
your hand in their direction, for them to grab onto it. Should they do
so, you will then grab them by their arms and pull them.

I reworked the offering status effect to no longer have a hardcoded
`can_hold_items()` check, so that kisses and the hand offering would no
longer need you to have free hands to complete. The logic here is that
you can still pull someone even with both hands filled, so I figured I'd
leave it this way.

Note: If anyone would like to give the item a better sprite, by all
means, go ahead, that'd be amazing. I'm just not really a great spriter
and couldn't be bothered to waste hours making a very _meh_ hand.

## Why It's Good For The Game
It's fluff, and nice fluff at that. It makes it easier for people to be
nice to one-another without having to necessarily spend so long writing
up an emote that the person on the floor will already have gotten back
up. I'm sure the MRP folks will like it, and I'm certain the HRP
downstreams will love it too ;)

## Changelog

:cl:
add: Added the *hand emote, which you can offer to someone standing up
in order to give them the possibility to grab onto your hand and let you
drag them away, or to someone lying down to help them back up, which
always makes everyone involved a little happier!
refactor: De-hardcoded and genericized a lot of the offering status
effect and alert code, to make it require a lot less copy-paste to
handle new cases.
fix: Offering a kiss no longer requires the receiver to have free hands
to accept said kiss!
/:cl:

* *hand, or That /One/ Emote You Always Felt Was Missing

Co-authored-by: GoldenAlpharex <58045821+GoldenAlpharex@users.noreply.github.com>

---
## [apljungquist/pilecap](https://github.com/apljungquist/pilecap)@[049d345fac...](https://github.com/apljungquist/pilecap/commit/049d345faceae34338f82dee2f54ffc282cde985)
#### Saturday 2023-01-07 08:49:53 by AP Ljungquist

Enable multiple, concurrent environments

There are no tests for this use case but the github actions workflow
has been updated to make use of it which gives it some test coverage.
Pilecap is first installed without deps to ensure we do not install
any unpinned packages that we could use accidentally.

Tox is dropped in CI because it is hard to get it to respect version
locks and it would create only one environment per container anyway.
Tox is kept locally because it makes it easy to iterate over python
versions but the normal steps to install deps and the package are
sidestepped so that pilecap can be bootstrapped and used to install
packages into the environment.

In the Makefile `touch $@` is removed because they were annoying;
I would find myself thinking that a check had passed because there was
no error but in reality the check just had not run.

Json is used to print the environment in the header mostly because it
is easy and somewhat human readable.

Canaria domestica is added as a dev dependency to
* ensure the correct dependencies are installed (I would have added it
  as a run or build dependency since these are more error prone but
  then users would not be able to install this package)
* demonstrate that dev requirements do not interact with shared
  constraints.

The update command is renamed compile to make it easier transitioning
between pilecap and pip-tools.

The --output-file option is added as a way to opt out of the custom
naming without reverting to the make workflow. Make can be used to
generate the same constraints but it is tricky to get both the make
file and the annotations in the constraints file both looking nice.

The compilation and gathering code is refactored to better separate
parts that need to deal with the file system from those that,
theoretically, do not. Functions in the compilation module now take
the destination path as an argument to make it easier getting an
overview of what files are created.

The Marker enum initially had the current_value as value but then
I remembered that deserializing command line arguments using the name
of enum variants couples the code to the interface I changed it and
added the property.

---
## [WinstonHartnett/bevy](https://github.com/WinstonHartnett/bevy)@[4847f7e3ad...](https://github.com/WinstonHartnett/bevy/commit/4847f7e3adc835053a8907dd578c342b4bd395e2)
#### Saturday 2023-01-07 09:30:49 by ira

Update codebase to use `IntoIterator` where possible. (#5269)

Remove unnecessary calls to `iter()`/`iter_mut()`.
Mainly updates the use of queries in our code, docs, and examples.

```rust
// From
for _ in list.iter() {
for _ in list.iter_mut() {

// To
for _ in &list {
for _ in &mut list {
```

We already enable the pedantic lint [clippy::explicit_iter_loop](https://rust-lang.github.io/rust-clippy/stable/) inside of Bevy. However, this only warns for a few known types from the standard library.

## Note for reviewers
As you can see the additions and deletions are exactly equal.
Maybe give it a quick skim to check I didn't sneak in a crypto miner, but you don't have to torture yourself by reading every line.
I already experienced enough pain making this PR :) 


Co-authored-by: devil-ira <justthecooldude@gmail.com>

---
## [shinotype/shino-qa-tool](https://github.com/shinotype/shino-qa-tool)@[7d5383d796...](https://github.com/shinotype/shino-qa-tool/commit/7d5383d7969a8980b50ba91b57790d5eb95da45f)
#### Saturday 2023-01-07 09:46:16 by shinotype

New issues

- fix docs crashing when searching for ?!, !?, ....
- after-effect
- badmouth
- blood curdling
- blood-stain / blood stain
- catch phrase / catch-phrase
- chit-chat / chit chat
- cold-hearted
- criss-cross
- cut and dried / cut and dry / cut-and-dry
- damndest
- day to day life
- dinner time
- face down
- face-down
- foul-mouthed
- glovebox
- good-will
- halfwit
- hard and fast
- life form / lifeform
- life-span / lifespan
- fix liquify copy regex
- lookalike
- mid-point
- mini-car
- non-confrontational
- off-duty
- over-extend
- over-familiar
- part timer
- phase -> faze?
- pipsqueak
- psych (word boundary for copy regex)
- rag-tag
- railgun
- rear view mirror / rear-view mirror
- re-categorize
- red faced
- round robin
- saw-like
- semi-translucent
- semi-transparent
- short-sighted
- simple-minded
- smack dab
- sun-tan
- t-shirt -> T-shirt
- time-worn
- tried and true
- unshakeable
- vice-like / vicelike
- week-long

---
## [Centrix14/eli](https://github.com/Centrix14/eli)@[26ff010999...](https://github.com/Centrix14/eli/commit/26ff010999065e13e5b2f33aa611ebf792032968)
#### Saturday 2023-01-07 09:47:41 by Centrix14

An imperative while, a notorious loop,
So dirty and old, but to live without you,
Is verbatim bullying, an awful insult
Say "thanks" to the while! It makes your life good.

It's a spanish shame, i know. Just added another test for parser.

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[c4e854cb11...](https://github.com/mrakgr/The-Spiral-Language/commit/c4e854cb113a6a723328be3c0ee5bee3d53c3ccf)
#### Saturday 2023-01-07 10:24:19 by Marko Grdinić

"https://unchartedterritories.tomaspueyo.com/p/transportation-tech-shaped-empires
> Even to this day, water transport costs a fraction of road transport. Imagine the difference when there were no roads! Transport over land was so expensive that most trade was simply impossible: The transport was more expensive than people were willing to pay.

I had no idea that the difference in transporation costs between land and sea were so huge.

https://archived.moe/lit/thread/20528580/#20528781
> Which genre is better, writers that could get pussy or writers that couldn’t get pussy? Personally I like the resentment that bitchless authors put in their work but my favorite authors are niggas that could fuck because there is some sort of power in their writings

10:25pm. Let me get dinner.

I get the sense this is not going to work. It is weird that the guy is passing me along to the sales team. I wonder if the company is struggling and does not have good software support despite what it claims. It is 2023 and Tenstorrent is still cagey. Maybe I should abandon faith in them and get focus on getting other skills.

1/7/2023

10:20am. I am up. No reply. I hate these companies. Let me read Fabinku and AyaTri, and then maybe I will upload the next chapter of HK on RR. That will be the last one. While I am determined to see the story to the end, that does not mean I have to entertain these guys for free. I am getting nothing from it. I do not want to make it so that they can just wait with the expectation that they will get everything eventually.

I'd rather write for myself and my single patron than a thousand freeloaders.

10:35am. I got a comment after a long while, but it a really crappy one.

> I miss read the title as Circumcised

Yeah, I am saying what I want and then leaving from the site. Let me upload the next chapter.

First come the images.

10:40am. Oh, I can delete that stupid comment. Great. It seems only two chapters are left in stock.

11am. Scheduled. The last RR chapter will be posted on the 25th of January.

Oh, right. Let me link to the PIM article in the Spiral docs.

Before that, let me just note the starts.

Views at 7,080. Avg at 144. Pages at 538. Followers at 32. Faves at 9. Ratings at 7.

I think this is as far as I get on RR. The avg is going up slowly, but I haven't gotten any new followers in a while. My dream of having the public sponsor my whims died last month.

Let me update the Spiral readme.

11:20am. Done.

Now forget things.

Let me write. When the last time I had a good writing session? Just forget all those people who are relentlessly ignoring your hard work and not giving you support. If I can't get the docs to the Tenstorrent hardware next week, I'll make it a policy to give these companies the middle finger until they come out with something usable. I'll establish writing as my hobby and look out for my own interests."

---
## [Skyrat-SS13/Skyrat-tg](https://github.com/Skyrat-SS13/Skyrat-tg)@[2b9eba0fe0...](https://github.com/Skyrat-SS13/Skyrat-tg/commit/2b9eba0fe06284c58a80303698784c7ccede75f4)
#### Saturday 2023-01-07 10:51:37 by SkyratBot

[MIRROR] Smoothing groups optimization, save 265ms with configs, more on production & w/ space ruins [MDB IGNORE] (#18189)

* Smoothing groups optimization, save 265ms with configs, more on production & w/ space ruins (#71989)

This one is fun.

On every /turf/Initialize and /atom/Initialize, we try to set
`smoothing_groups` and `canSmoothWith` to a cached list of bitfields. At
the type level, these are specified as lists of IDs, which are then
`Join`ed in Initialize, and retrieved from the cache (or built from
there).

The problem is that the cache only misses about 60 times, but the cache
hits more than a hundred thousand times. This means we eat the cost of
`Join` (which is very very slow, because strings + BYOND), as well as
the preliminary `length` checks, for every single atom.

Furthermore, as you might remember, if you have any list variable set on
a type, it'll create a hidden `(init)` proc to create the list. On
turfs, that costs us about 60ms.

This PR does a cool trick where we can completely eliminate the `Join`
*and* the lists at the cost of a little more work when building the
cache.

The trick is that we replace the current type definitions with this:

```patch
- smoothing_groups = list(SMOOTH_GROUP_TURF_OPEN, SMOOTH_GROUP_FLOOR_ASH)
- canSmoothWith = list(SMOOTH_GROUP_FLOOR_ASH, SMOOTH_GROUP_CLOSED_TURFS)
+ smoothing_groups = SMOOTH_GROUP_TURF_OPEN + SMOOTH_GROUP_FLOOR_ASH
+ canSmoothWith = SMOOTH_GROUP_FLOOR_ASH + SMOOTH_GROUP_CLOSED_TURFS
```

These defines, instead of being numbers, are now segments of a string,
delimited by commas.

For instance, if ASH used to be 13, and CLOSED_TURFS used to be 37, this
used to equal `list(13, 37)`. Now, it equals `"13,37,"`.

Then, when the cache misses, we take that string, and treat it as part
of a JSON list, and decode it from there. Meaning:

```java
// Starting value
"13,37,"

// We have a trailing comma, so add a dummy value
"13,37,0"

// Make it an array
"[13,37,0]"

// Decode
list(13, 37, 0)

// Chop off the dummy value
list(13, 37) // Done!
```

This on its own eliminates 265ms *without space ruins*, with the
combined savings of turf/Initialize, atom/Initialize, and the hidden
(init) procs that no longer exist.

Furthermore, there's some other fun stuff we gain from this approach
emergently.

We previously had a difference between `S_TURF` and `S_OBJ`. The idea is
that if you have any smoothing groups with `S_OBJ`, then you will gain
the `SMOOTH_OBJ` bitflag (though note to self, I need to check that the
cost of adding this is actually worth it). This is achieved by the fact
that `S_OBJ` simply takes the last turf, and adds onto that, meaning
that if the biggest value in the sorting groups is greater than that,
then we know we're going to be smoothing to objects.

This new method provides a limitation here. BYOND has no way of
converting a number to a string at compile time, meaning that we can't
evaluate `MAX_S_TURF + offset` into a string. Instead, in order to
preserve the nice UX, `S_OBJ` now instead opts to make the numbers
negative. This means that what used to be something like:

```dm
smoothing_groups = list(SMOOTH_GROUP_ALIEN_RESIN, SMOOTH_GROUP_ALIEN_WEEDS)
```

...which may have been represented as

```dm
smoothing_groups = list(15, MAX_S_TURF + 3)
```

...will now become, at compile time:

```dm
smoothing_groups = "15,-3,"
```

Except! Because we guarantee smoothing groups are sorted through unit
testing, this is actually going to look like:

```dm
smoothing_groups = "-3,15,"
```

Meaning that we can now check if we're smoothing with objects just by
checking if `smoothing_groups[1] == "-"`, as that's the only way that is
possible. Neat!

Furthermore, though much simpler, what used to be `if
(length(smoothing_groups))` (and canSmoothWith) on every single
atom/Initialize and turf/Initialize can now be `if (smoothing_groups)`,
since empty strings are falsy. `length` is about 15% slower than doing
nothing, so in procs as hot as this, this gives some nice gains just on
its own.

For developers, very little changes. Instead of using `list`, you now
use `+`. The order might change, as `S_OBJ` now needs to come first, but
unit tests will catch you if you mess up. Also, you will notice that all
`S_OBJ` have been increased by one. This is because we used to have
`S_TURF(0)` and `S_OBJ(0)`, but with this new trick, -0 == 0, and so
they conflicted and needed to be changed.

* Sorting how did I miss it

Co-authored-by: Mothblocks <35135081+Mothblocks@users.noreply.github.com>
Co-authored-by: Funce <funce.973@gmail.com>

---
## [PigeonofWar/LegacyGwent](https://github.com/PigeonofWar/LegacyGwent)@[52b3669c9b...](https://github.com/PigeonofWar/LegacyGwent/commit/52b3669c9b2fe4943aae8a44f8c71decfdae9d2b)
#### Saturday 2023-01-07 12:48:43 by PigeonofWar

Update en.json

Hi,

Not listing everything here, as some are self explanatory, but have included some where I just wanted to provide a bit of context to my proposed change. A lot of the changes are either minor corrections, consistency changes (to keep the wording same or similar throughout the game), or to further clarify what the card does.

I have used gwent.one as reference, as it contains a database of all beta Gwent cards as they appeared upon the last update, pulled directly from the game. I have of course taken the custom balance changes etc. into account, to keep their new functionality / stats.

This should cover the Neutral cards (Down to Dagon at 21001 / Line 880)

I hope at least some of this is useful. and want to thank you for bringing this project to life and giving me a healthy dose of nostalgia!

12004 Geralt of Rivia: Just to keep the word for the card effects / abilities the same throughout the game, for consistency. Old Gwent used ability, and can see it being used on some custom balance changes and cards as well.

12008 Villentretenmerth: Not sure if coded differently from how it originally worked, but if functioning the same as original Gwent, I added a bit of text to clarify when it happens and that it excludes himself (in case he is the highest or tied for). Please feel free to change to the below if you would want this to be worded exactly as old Gwent, I just think my edit reads a bit clearer. (Old Gwent: After 3 turns, destroy all the other Highest units on turn start. 3 Armor.)

12011 Dandelion: Vainglory: Original included Triss, not sure if just a typo, but may be worth checking if included in the code (sorry, I'm not sure how to do that).

12015 Zoltan: Scoundrel: Not sure if you changed the functionality of this one (which as how it was written, seems to be a nerf, unless Zoltan himself had an increase in Power by 4), but if functionality to old Gwent has not changed, then I updated the wording to match Old Gwent.

12018 Ihuarraquax: Fixed wording to indicate how it worked in Old Gwent, otherwise it indicate that it keeps damaging 3 enemy units by 7 at every turn end, when it only does it once. Might be worth checking code if coded to keep firing ability or only once.

12026 Triss: Telekinesis: Changed from current to starting, as that was how it was in Old Gwent. Not sure if coded as such or a custom change?

12027 Aguara: Again, not sure if custom change or not, but is random Elf in Old Gwent.

14007 Dimeritium Shackles: Was this function changed? It implies to only be able to lock cards, when in Old Gwent it could also unlock (toggling).

14013 Mardroeme: Seems two cards were named Spore, and this one was originally called Mardroeme, so fixed it.

---
## [Nukethem12/infoprog2023](https://github.com/Nukethem12/infoprog2023)@[a7957daac7...](https://github.com/Nukethem12/infoprog2023/commit/a7957daac77c94ca99b5c6cd08bec86c4f356693)
#### Saturday 2023-01-07 14:11:03 by Nukethem12

date parsing still not werk GOD FUCKING DAMNIT
added custom exceptions pog

---
## [LabRat404/I_miss_u](https://github.com/LabRat404/I_miss_u)@[a9a1d6e5ef...](https://github.com/LabRat404/I_miss_u/commit/a9a1d6e5ef149ec34c35143cff0baec826b237ce)
#### Saturday 2023-01-07 15:11:42 by LabRat404

Hope can win your heart back tomorrow.

This is the most hard working month of my life. I really am sorry about the past and I really liked you. I like you being who you are, I love u the whole and thats why Im trying so hard right now, to earn your trust back QAQ. I really do miss u, and love u.

---
## [mrakgr/The-Spiral-Language](https://github.com/mrakgr/The-Spiral-Language)@[911c245cc4...](https://github.com/mrakgr/The-Spiral-Language/commit/911c245cc4c10c0c0e4350267d025b3e3061b2e6)
#### Saturday 2023-01-07 16:53:37 by Marko Grdinić

"12:30pm. https://vadimkravcenko.com/shorts/things-they-didnt-teach-you/

Yeah, I need to forget about coding. Forget about coding and think about social skills. My programming skills are not the problem in getting a job. The thing he says about domain skills here is key. That is what I am missing in order to be a true senior.

12:35pm. Let me go back to writing.

1pm. 41.2k. About 0.9k written. The next couple of scenes will be intense.

This is not a bad pace. Let me have breakfast here.

2:20pm. Done with chores. I think that maybe at a small startup I could get my programming fix and less meetings.

Let me read the Hero King raws and then I will resume.

2:25pm. There are all sorts of programming jobs out there. I should look for something that both pays well and involves a lot of programming. The less I am standing around, and the more I am creating and solving problems, the happier I will be.

2:35pm. Yeah, a slow pace is right here.

I should prepare myself for a programming gauntlet. I need to know my strengths and weaknesses.

One person might be a great conman and might be able to get a 200k job purely on his social specs and the ability to do easy problems.

But I am not a Fang Yuan style of person.

If I should get a job, that would be for the sake of programming itself.

I've done all I can with my own projects, but since they are not successful, and I am out of ideas, why not fulfil other people's wishes? In 2022 I studied art and did writing, but now that that is out of the way, what better do I have to do other than get back into programming?

3:10pm. https://rawkuma.com/manga/infinite-dendrogram/

I had no idea Dendro had raws on this site. Anyway, let me start. In the future I will program hard, so let me write hard now so that there are no regrets.

I do not want to start intense programming work only to leave Heaven's Key lingering. Who knows if I will ever get the chance to create an original work like this again.

The computers are not helping me move forward in life. I love them, but they aren't loving me back.

So let me write. I can afford to spend a few months.

https://youtu.be/Lx31BlNGTtE?list=PLQHmK8j6zHB6_Q7IwGOPWbBQcRs7Cpilq
220 Stolen love

This tune really feels right.

5:15pm. 42.7k. So far I've written about 2.5k words. This is a good session. I am starting to feel the strain though.

5:40pm. 43.05k. I had enough for one day. Let me close here. I think I'll move to updating the Episteme tier every few days. Every day is too much effort for me.

Let me just first get back into the swing of things."

---
## [Huffie56/cmss13](https://github.com/Huffie56/cmss13)@[7f1e80ca3d...](https://github.com/Huffie56/cmss13/commit/7f1e80ca3dd4800f54b5ff4dc3663dd1f804c28c)
#### Saturday 2023-01-07 16:55:31 by carlarctg

MIDIs are now either 'Meme' or 'Atmospheric', players can toggle each option (#1939)

<!-- Write **BELOW** The Headers and **ABOVE** The comments else it may
not be viewable. -->

# About the pull request

<!-- Remove this text and explain what the purpose of your PR is.

Mention if you have tested your changes. If you changed a map, make sure
you used the mapmerge tool.
If this is an Issue Correction, you can type "Fixes Issue #169420" to
link the PR to the corresponding Issue number #169420.

Remember: something that is self-evident to you might not be to others.
Explain your rationale fully, even if you feel it goes without saying.
-->

Updated savefile number from 19 to 20. Meme and atmospheric preferences
are enabled by default.

Admin sounds now need a selection between 'Meme' or 'Atmospheric' type.
Ideally, this would let players decide if they want to listen to hijack
or first drop songs without needing to listen to GOOD HITS or whatnot.

I am uncertain about the savefile bit of code. I don't fully understand
it.

As stated I don't care about GBP, so if the tags are teechnicallly
incorrect go ahead and change them or whatever.

# Explain why it's good for the game

<!-- Please add a short description of why you think these changes would
benefit the game. If you can't justify it in words, it might not be
worth adding, and may discourage maintainers from reviewing or merging
your PR. This section is not strictly required for (non-controversial)
fix PRs or backend PRs. -->

> Admin sounds now need a selection between 'Meme' or 'Atmospheric'
type. Ideally, this would let players decide if they want to listen to
hijack or first drop songs without needing to listen to GOOD HITS or
whatnot.

As it says. Lots of people hate the memes and just want to listen to the
cool atmosphere. This is of course dependant on staff selecting the
right option, which is sometimes up to opinion, but I fully trust staff
will be able to handle this subjective affair correctly.

# Testing Photographs and Procedure
<!-- Include any screenshots/videos/debugging steps of the modified code
functioning successfully, ideally including edge cases. -->
<details>
<summary>Screenshots & Videos</summary>

Put screenshots and videos here with an empty line between the
screenshots and the `<details>` tags.

</details>


# Changelog

<!-- If your PR modifies aspects of the game that can be concretely
observed by players or admins you should add a changelog. If your change
does NOT meet this description, remove this section. Be sure to properly
mark your PRs to prevent unnecessary GBP loss. Please note that
maintainers freely reserve the right to remove and add tags should they
deem it appropriate. You can attempt to finagle the system all you want,
but it's best to shoot for clear communication right off the bat. -->
<!-- If you add a name after the ':cl', that name will be used in the
changelog. You must add your CKEY after the CL if your GitHub name
doesn't match. Be sure to properly mark your PRs to prevent unnecessary
GBP loss. Maintainers freely reserve the right to remove and add tags
should they deem it appropriate. -->

:cl:
refactor: Updated savefile number from 18 to 19. Meme and atmospheric
preferences are enabled by default.
admin: Admin sounds now need a selection between 'Meme' or 'Atmospheric'
type. Ideally, this would let players decide if they want to listen to
hijack or first drop songs without needing to listen to GOOD HITS or
whatnot.
/:cl:

<!-- Both :cl:'s are required for the changelog to work! -->

Co-authored-by: Stan_Albatross <66756236+stanalbatross@users.noreply.github.com>

---
## [Shad0vvs/cmss13](https://github.com/Shad0vvs/cmss13)@[68ba844196...](https://github.com/Shad0vvs/cmss13/commit/68ba84419624366956ae5f9bde67f1e33287301a)
#### Saturday 2023-01-07 18:02:04 by RenaRenaRe

Cross-ciphering fix (#1879)

<!-- Write **BELOW** The Headers and **ABOVE** The comments else it may
not be viewable. -->

# About the pull request
Fixes the cross-ciphering property so it actually works instead of
producing a never ending stream of runtime errors and a broken larva
that never develops. I'm deliberately being vague about what it does
because I think it's supposed to be a secret, the wiki tells you to
"find out in game!", but you can just read the code since it isn't
complicated.
This is my first time using github so sorry if I've fucked something up.

<!-- Remove this text and explain what the purpose of your PR is.

Mention if you have tested your changes. If you changed a map, make sure
you used the mapmerge tool.
If this is an Issue Correction, you can type "Fixes Issue #169420" to
link the PR to the corresponding Issue number #169420.

Remember: something that is self-evident to you might not be to others.
Explain your rationale fully, even if you feel it goes without saying.
-->

# Explain why it's good for the game
Things should function the way they're supposed to.
Cross-ciphering is an extremely hard to get property that I'm not sure
if anyone has ever actually made in game, now on the incredibly rare
occasion that somebody actually makes it it should work correctly.
<!-- Please add a short description of why you think these changes would
benefit the game. If you can't justify it in words, it might not be
worth adding, and may discourage maintainers from reviewing or merging
your PR. This section is not strictly required for (non-controversial)
fix PRs or backend PRs. -->


# Testing Photographs and Procedure
<!-- Include any screenshots/videos/debugging steps of the modified code
functioning successfully, ideally including edge cases. -->
<details>
<summary>Screenshots & Videos</summary>

Put screenshots and videos here with an empty line between the
screenshots and the `<details>` tags.

</details>


# Changelog
<!-- If your PR modifies aspects of the game that can be concretely
observed by players or admins you should add a changelog. If your change
does NOT meet this description, remove this section. Be sure to properly
mark your PRs to prevent unnecessary GBP loss. Please note that
maintainers freely reserve the right to remove and add tags should they
deem it appropriate. You can attempt to finagle the system all you want,
but it's best to shoot for clear communication right off the bat. -->
<!-- If you add a name after the ':cl', that name will be used in the
changelog. You must add your CKEY after the CL if your GitHub name
doesn't match. Be sure to properly mark your PRs to prevent unnecessary
GBP loss. Maintainers freely reserve the right to remove and add tags
should they deem it appropriate. -->

:cl:
fix: Cross-ciphering now works correctly
/:cl:

<!-- Both :cl:'s are required for the changelog to work! -->

---
## [QuacksQ/TESTING](https://github.com/QuacksQ/TESTING)@[5252418df0...](https://github.com/QuacksQ/TESTING/commit/5252418df0ed4726c5bf2a9599f95befd0aca086)
#### Saturday 2023-01-07 18:24:33 by Mothblocks

Create a guide for atomization that includes a new allowance to pull requests that might add dead code (#71429)

@tgstation/commit-access 

I'm proposing a new use for the Atomic tag that we currently virtually
never use.

We have countless pull requests over time, and plenty of which open now,
that are enormous refactors over tens of files with thousands of
additions. We are historically pretty slow to review and merge these,
and it definitely scares a lot of maintainers off. I think part of the
reason is that we do not like dead code being added, which is completely
reasonable at our scale.

However, I propose that, for refactors/purely code stuff, we ease up on
this a lot, and encourage (not require) people to make smaller pull
requests, even to the extent that it creates APIs we do not use yet.

As an example, https://github.com/tgstation/tgstation/pull/71421 does a
massive refactor to carp. It also does some balance changes, which I
think we could agree could be split off if it was enough of a pain.
However, there's a bunch of other stuff that could have been individual
pull requests here with this new allowance.

- The new basic AI behaviors
- The regenerator component
- Pet commands component

These are things that:

- Would not be used until the transition from simple to basic, but are
easily reviewable on their own
- Are easy to REMOVE if the OP does not follow up
- Are easy to FINISH if the OP does not follow up

(I suspect even, for instance, that there are parts of Wallening we
could be merging right now, that's probably gonna be hundreds or
thousands of files long...)

Pros:
- PRs are more often easily reviewable
- PRs are quicker to merge, since we don't have conflicts from editing
one of the 70 files they changed
- Cleanups can be more easily finished by other people. I don't suspect
this will be likely, but it's not easily possible today

Cons:
- We have to mark the PRs as atomic
- Someone needs to look through every so often (I'm thinking like, once
a month or something) to see if the code ended up being used, or if the
committer still plans to use it
- If the PR is adding a complex enough API that isn't modular, it might
be very hard to remove. I suspect for PRs like this that we ask them to
have an implementer before merging.

NL voice would love your thoughts on this

---
## [pdx-tools/pdx-tools](https://github.com/pdx-tools/pdx-tools)@[faf34db0e2...](https://github.com/pdx-tools/pdx-tools/commit/faf34db0e2b2a27f3d3dd240622f9cf4d46fcb37)
#### Saturday 2023-01-07 18:25:35 by Nick Babcock

Timelapse video switch from MediaRecorder to VideoEncoder

The current video output from timelapses can be a little janky:

 - The starting map may be incorrect
 - Recording may skip years if user's computer can't keep up with the
   selected frame rate.
 - Recording timelapse can only proceed at the selected framerate

The fundamental issue is that timelapse recordings worked by literally
recording the screen. And it improved impossible to coax the correct map
rendering at the correct time. We got it pretty good, but only through
lots of hacks (like continually rendering a start and end frame until we
data was encoded)

This commit changes the video paradigm drastically. Now a video is
directly created by individual frames where we can control the content,
timestamp, and duration of the frame.

Unfortunately, the required [`VideoEncoder`][0] has limited browser
support with only Chrome, Edge, and Opera really supporting the feature.
This represents 75% of pdx tools users.

Using a `VideoEncoder` required an additional library in order to mux it
into WebM and then ffmpeg is still required for an mp4 transcode.
Annoying, but at least the library is lightweight.

Of note: I tried using a vp9 codec, and even though Chrome supports vp9
for a `MediaRecorder`, it does not support it for `VideoEncoder`. I
can't say why.

[0]: https://caniuse.com/mdn-api_videoencoder

---
## [mudlord/wtfweg](https://github.com/mudlord/wtfweg)@[3159ba0024...](https://github.com/mudlord/wtfweg/commit/3159ba00245b509c79e926bc80642e110b0d750a)
#### Saturday 2023-01-07 21:27:51 by mudlord

Tried mgba again with a demo from Shitfaced Clowns.
Works pretty fucking well. At the same time started to clean up the dialogs before delving into callback bullshit.

---
## [tgstation/tgstation](https://github.com/tgstation/tgstation)@[6200bc2360...](https://github.com/tgstation/tgstation/commit/6200bc23602dc058da7a552d8a0c2d2b67f29e60)
#### Saturday 2023-01-07 21:36:31 by Jacquerel

Basic Mob Carp IX: Carp Rifts & Migration (#72265)

## About The Pull Request

The almost-final part of the much larger PR I tried to make a month ago
(there's actually one more thing but I'm waiting on a dog PR to get
merged first).
This adds _new_ behaviour and abilities to carp.

Now when a Carp Migration occurs, all of the space carp who are spawned
are given a path through the station.
Specifically, each carp which shares a z level will try to path to a
specific station area, then back out into space.

https://www.youtube.com/watch?v=0KtTI4_7a0c
Here in this video we follow one carp and its friends as it attempts to
navigate "Kilo Station" in order to return to its ancestral spawning
grounds, via the dormitories.
Why are there walls underneath those windows? That's a question nature
has no answer for.

In order to ensure that they don't destroy Arrivals, Departures, and
anywhere else with windows in the process of trying to get inside they
have also gained a new "Lesser Carp Rift" ability.
This allows carp to teleport a short distance once per minute, leaving a
rift at their exit point. Any other mob can enter the rift to travel to
a similar location to the space carp (within the same 3x3 area).


https://user-images.githubusercontent.com/7483112/209584254-afb5839b-a1cd-4c5a-b701-dbb47a024272.mp4

Teleporting puts their attack on a one second cooldown so you won't be
_immediately_ bitten for 20 damage out of nowhere.

Their AI has been updated appropriately and they will use these
abilities:
- If they're trying to migrate through the station and encounter an
obstacle.
- If they're trying to atack something and encounter an obstacle.
- If they're trying to run away, as soon as possible.


https://user-images.githubusercontent.com/7483112/209584287-4402bf5b-3c41-4603-9205-5c4da8b4cd1c.mp4

That last point includes the HoS's pet Lia, who is an occasional target
of traitor objectives, which can either work in your favour (scaring her
to a less secure location) or against it (wait, where did she go?).

Also this fixes an embarassing bug where space carp weren't spaceproof
but I am going to pull that out into its own PR so it can be merged
without also needing to review this.

## Why It's Good For The Game

Carp are an iconic space animal but also quite boring, which this
hopefully remedies.

In the current game the Carp Migration event announces itself to the
crew and usually advertises to ghosts that a cool shark mob has spawned
and this changes essentially nothing about the round, the only people
Carp will usually attack are people who go out to set up the solars, and
the occasional wandering curator or lone operative.
This should make the announcement mean something, as suddenly it means a
belligerent animal might unexpectedly try to pass through your
workplace.

Non-magical space carp are weak enough that even an unarmed spaceman can
take on one or two at a time (and even being mildly armed with makeshift
weapons you have around makes them fairly non-threatening) but it can
give you a bit of excitement.

The ability for Carp to teleport allows them to do this without causing
_too much_ property damage or breaching the station, in my tests they
will _generally_ find a way in which doesn't involve them busting
windows open en masse. Also it just makes them a bit more interesting.
Traitors with dehydrated carp are not much able to make use of the Carp
Rift ability as there isn't any way to get them to do it on demand, but
you could spawn one which is not allied to you and then try to scare it
in an appropriate direction which I think is a fun use of the item.

This undoubtedly will make Space Dragon player-controlled carp more
dangerous in a way which is difficult to predict, but it also makes
playing as them more fun and might encourage some guerilla tactics and
cooperation which wasn't previously possible.

## Changelog

:cl:
add: Space Carp seem to have begun associating the station with food and
attempting to enter from the outside, rather than simply congregating
around solar panels. Employees are advised that these are wild animals,
and should not be fed.
add: Space Carp can intermittently teleport short distances, leaving a
short lived rift which other nearby carp will be attracted to follow
them through.
/:cl:

Co-authored-by: Fikou <23585223+Fikou@users.noreply.github.com>

---
## [DesmontTiney/tgstation](https://github.com/DesmontTiney/tgstation)@[5da871e271...](https://github.com/DesmontTiney/tgstation/commit/5da871e2719fb7aac04fb1ec4c85ea7a09a83b36)
#### Saturday 2023-01-07 22:47:13 by RikuTheKiller

Made geysers easier to find (#71608)

## About The Pull Request

This PR raises the geyser spawn rate from 0.1 to 0.15 and increases the
weight of wittel geysers to 10 which is the same as every other special
geyser. (previously 6)

Wittel shouldn't be any less difficult to find than other geysers as all
of the special geysers are equally powerful. Hyper-plasmium oxide can be
used to make extremely powerful explosives that can go beyond maxcaps
and hollow water + protozine can create an infinite amount of strange
reagent.

I've subjected myself to going out of my way to visit lavaland/icemoon
several times to get wittel and each time finding a single geyser takes
about 5 minutes of my time. This, coupled with the fact you really don't
have a lot of time to be wasting on looking for the geysers results in
an unfun experience.

I understand geysers are sort of a necessary evil, however, they
shouldn't be THIS difficult to find. Out of the 10 or so geysers I've
found, only 1 has had wittel in it and it was next to a whelp portal
which ended both me and my miner escort.

I've also hunted the entirety of lavaland with no luck. (Horrendous
experience.)

I've dedicated entire rounds to this, by the way.
## Why It's Good For The Game

If you go out of your way to waste ages hunting for geysers, there
should at least be a reward. That is, in the same round, not after 3 or
more rounds as even megafauna gear isn't gatekept THAT hard.

You shouldn't have to waste this much of a miner's time (who is also
going for megafauna gear) to get something that is arguably less
powerful than what they get for less effort. Megafauna gear is also
available every round and is attained via predictable methods.

This PR will also likely make geyser scanning a more comparable method
of point gain to just mining.

Oh and not to mention that penthrite is available almost roundstart via
luxpens. (It's a wittel chem.)
## Changelog
:cl:
balance: Geysers now spawn more often, especially wittel geysers.
/:cl:

---
## [DesmontTiney/tgstation](https://github.com/DesmontTiney/tgstation)@[2425531eb2...](https://github.com/DesmontTiney/tgstation/commit/2425531eb2dab84fb27ed864e4c52470bfff6918)
#### Saturday 2023-01-07 22:47:13 by John Willard

Removes tablets (not PDAs) entirely. (#71507)

## About The Pull Request

**Comes with an UpdatePaths!**

Removes the tablet subtype, PDAs now replaces them entirely.

Nukie and Silicon tablets are now subtypes of the PDA instead, while
contractor ones were removed entirely as they didn't do anything and
were unused (though it wouldn't be hard to re-add).

Nukie PDAs are now the only type of PDA that uses modular_tablets.dmi,
which is just larger icons of modular_pda. Each application requires an
icon state in both of these, for 2 different sizes, which makes it
annoying to make new applications, especially if it can also run on
computers/laptops.

### Icons

Because Silicon tablets are now a subtype of PDA, they use PDA icons
instead of tablet ones. Luckily for us, they already exist in code.

![image](https://user-images.githubusercontent.com/53777086/203876575-56eb1593-774c-47c6-8e7d-491a7805f28c.png)

AI's don't use a tablet icon though, so they aren't affected.

## Why It's Good For The Game

There's very little difference between tablets and PDAs, PDAs overshadow
them in every single way, so at this point I don't see why we should
have both of these, and if you compare the two in usefulness and actual
in-game use by players, it's a no-brainer than the item all players get
roundstart and comes with a messenger should be the one we go with.

Also as said in the about section, when making an app you would need to
make icon states for the program running for all hardware it can run on,
which is Computer, Laptop, PDA, and Tablet.

Laptop is just a smaller computer icon
PDA is just a smaller tablet icon

However, you can't simply shrink the size of the icon, instead you have
to completely resprite the same app icon FOUR TIMES for it to not
bluescreen on all these different devices.

<details>
<summary>
Here's examples of it
</summary>
Computer (NOTE: *They share the same icon file as regular computers*)
<img
src="https://user-images.githubusercontent.com/53777086/203876801-486a8054-489a-4983-bdad-a2599b4dc379.png"/>
Laptop
<img
src="https://user-images.githubusercontent.com/53777086/203876333-58e5d135-f4c6-4a02-8948-1df771e294a4.png"/>
Tablet
<img
src="https://user-images.githubusercontent.com/53777086/203876352-816c7fb1-c681-40b9-99e0-052f49632c7f.png"/>
PDA
<img
src="https://user-images.githubusercontent.com/53777086/203876358-1cf7253d-3c6a-456a-8133-ebf7f0351637.png"/>
</details>

If we wish to help in simplifying this, we should remove tablet icons
entirely, which means 1 less icon to worry about. To do this, we'd need
to resprite nukie PDAs, however I am very much not a spriter and never
tried GAGS, so I'll leave it to someone else to do.

## Changelog

:cl:
del: Tablets are now removed, PDAs are now the base 'tablet'. Silicon
and nukie tablets are now PDAs.
/:cl:

---

# [<](2023-01-06.md) 2023-01-07 [>](2023-01-08.md)

